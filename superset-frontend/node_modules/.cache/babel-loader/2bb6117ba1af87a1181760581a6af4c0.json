{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n* Licensed to the Apache Software Foundation (ASF) under one\n* or more contributor license agreements.  See the NOTICE file\n* distributed with this work for additional information\n* regarding copyright ownership.  The ASF licenses this file\n* to you under the Apache License, Version 2.0 (the\n* \"License\"); you may not use this file except in compliance\n* with the License.  You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing,\n* software distributed under the License is distributed on an\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n* KIND, either express or implied.  See the License for the\n* specific language governing permissions and limitations\n* under the License.\n*/\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport { t } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\nimport { TABS_TYPE, ROW_TYPE } from 'src/dashboard/util/componentTypes';\nimport {\nDASHBOARD_ROOT_ID,\nNEW_COMPONENTS_SOURCE_ID,\nDASHBOARD_HEADER_ID } from\n'src/dashboard/util/constants';\nimport dropOverflowsParent from 'src/dashboard/util/dropOverflowsParent';\nimport findParentId from 'src/dashboard/util/findParentId';\nimport isInDifferentFilterScopes from 'src/dashboard/util/isInDifferentFilterScopes';\nimport { updateLayoutComponents } from './dashboardFilters';\nimport { setUnsavedChanges } from './dashboardState';\n\n// Component CRUD -------------------------------------------------------------\nexport const UPDATE_COMPONENTS = 'UPDATE_COMPONENTS';\n\n// this is a helper that takes an action as input and dispatches\n// an additional setUnsavedChanges(true) action after the dispatch in the case\n// that dashboardState.hasUnsavedChanges is false.\nfunction setUnsavedChangesAfterAction(action) {\n  return (...args) => (dispatch, getState) => {\n    const result = action(...args);\n    if (typeof result === 'function') {\n      dispatch(result(dispatch, getState));\n    } else {\n      dispatch(result);\n    }\n\n    const isComponentLevelEvent =\n    result.type === UPDATE_COMPONENTS &&\n    result.payload &&\n    result.payload.nextComponents;\n    // trigger dashboardFilters state update if dashboard layout is changed.\n    if (!isComponentLevelEvent) {\n      const components = getState().dashboardLayout.present;\n      dispatch(updateLayoutComponents(components));\n    }\n\n    if (!getState().dashboardState.hasUnsavedChanges) {\n      dispatch(setUnsavedChanges(true));\n    }\n  };\n}\n\nexport const updateComponents = setUnsavedChangesAfterAction(\n(nextComponents) => ({\n  type: UPDATE_COMPONENTS,\n  payload: {\n    nextComponents } }));\n\n\n\n\nexport function updateDashboardTitle(text) {\n  return (dispatch, getState) => {\n    const { dashboardLayout } = getState();\n    dispatch(\n    updateComponents({\n      [DASHBOARD_HEADER_ID]: {\n        ...dashboardLayout.present[DASHBOARD_HEADER_ID],\n        meta: {\n          text } } }));\n\n\n\n\n  };\n}\n\nexport const DASHBOARD_TITLE_CHANGED = 'DASHBOARD_TITLE_CHANGED';\n\n// call this one when it's not an undo-able action\nexport function dashboardTitleChanged(text) {\n  return {\n    type: DASHBOARD_TITLE_CHANGED,\n    text };\n\n}\n\nexport const DELETE_COMPONENT = 'DELETE_COMPONENT';\nexport const deleteComponent = setUnsavedChangesAfterAction((id, parentId) => ({\n  type: DELETE_COMPONENT,\n  payload: {\n    id,\n    parentId } }));\n\n\n\nexport const CREATE_COMPONENT = 'CREATE_COMPONENT';\nexport const createComponent = setUnsavedChangesAfterAction((dropResult) => ({\n  type: CREATE_COMPONENT,\n  payload: {\n    dropResult } }));\n\n\n\n// Tabs -----------------------------------------------------------------------\nexport const CREATE_TOP_LEVEL_TABS = 'CREATE_TOP_LEVEL_TABS';\nexport const createTopLevelTabs = setUnsavedChangesAfterAction((dropResult) => ({\n  type: CREATE_TOP_LEVEL_TABS,\n  payload: {\n    dropResult } }));\n\n\n\nexport const DELETE_TOP_LEVEL_TABS = 'DELETE_TOP_LEVEL_TABS';\nexport const deleteTopLevelTabs = setUnsavedChangesAfterAction(() => ({\n  type: DELETE_TOP_LEVEL_TABS,\n  payload: {} }));\n\n\n// Resize ---------------------------------------------------------------------\nexport const RESIZE_COMPONENT = 'RESIZE_COMPONENT';\nexport function resizeComponent({ id, width, height }) {\n  return (dispatch, getState) => {\n    const { dashboardLayout: undoableLayout } = getState();\n    const { present: dashboard } = undoableLayout;\n    const component = dashboard[id];\n    const widthChanged = width && component.meta.width !== width;\n    const heightChanged = height && component.meta.height !== height;\n    if (component && (widthChanged || heightChanged)) {\n      // update the size of this component\n      const updatedComponents = {\n        [id]: {\n          ...component,\n          meta: {\n            ...component.meta,\n            width: width || component.meta.width,\n            height: height || component.meta.height } } };\n\n\n\n\n      dispatch(updateComponents(updatedComponents));\n    }\n  };\n}\n\n// Drag and drop --------------------------------------------------------------\nexport const MOVE_COMPONENT = 'MOVE_COMPONENT';\nconst moveComponent = setUnsavedChangesAfterAction((dropResult) => ({\n  type: MOVE_COMPONENT,\n  payload: {\n    dropResult } }));\n\n\n\nexport const HANDLE_COMPONENT_DROP = 'HANDLE_COMPONENT_DROP';\nexport function handleComponentDrop(dropResult) {\n  return (dispatch, getState) => {\n    const overflowsParent = dropOverflowsParent(\n    dropResult,\n    getState().dashboardLayout.present);\n\n\n    if (overflowsParent) {\n      return dispatch(\n      addWarningToast(\n      t(\n      `There is not enough space for this component. Try decreasing its width, or increasing the destination width.`)));\n\n\n\n    }\n\n    const { source, destination } = dropResult;\n    const droppedOnRoot = destination && destination.id === DASHBOARD_ROOT_ID;\n    const isNewComponent = source.id === NEW_COMPONENTS_SOURCE_ID;\n    const dashboardRoot = getState().dashboardLayout.present[DASHBOARD_ROOT_ID];\n    const rootChildId =\n    dashboardRoot && dashboardRoot.children ? dashboardRoot.children[0] : '';\n\n    if (droppedOnRoot) {\n      dispatch(createTopLevelTabs(dropResult));\n    } else if (destination && isNewComponent) {\n      dispatch(createComponent(dropResult));\n    } else if (\n    // Add additional allow-to-drop logic for tag/tags source.\n    // We only allow\n    // - top-level tab => top-level tab: rearrange top-level tab order\n    // - nested tab => top-level tab: allow row tab become top-level tab\n    // Dashboard does not allow top-level tab become nested tab, to avoid\n    // nested tab inside nested tab.\n    source.type === TABS_TYPE &&\n    destination.type === TABS_TYPE &&\n    source.id === rootChildId &&\n    destination.id !== rootChildId)\n    {\n      return dispatch(\n      addWarningToast(t(`Can not move top level tab into nested tabs`)));\n\n    } else if (\n    destination &&\n    source &&\n    !(\n\n    destination.id === source.id && destination.index === source.index))\n\n    {\n      dispatch(moveComponent(dropResult));\n    }\n\n    // call getState() again down here in case redux state is stale after\n    // previous dispatch(es)\n    const { dashboardFilters, dashboardLayout: undoableLayout } = getState();\n\n    // if we moved a child from a Tab or Row parent and it was the only child, delete the parent.\n    if (!isNewComponent) {\n      const { present: layout } = undoableLayout;\n      const sourceComponent = layout[source.id] || {};\n      const destinationComponent = layout[destination.id] || {};\n      if (\n      (sourceComponent.type === TABS_TYPE ||\n      sourceComponent.type === ROW_TYPE) &&\n      sourceComponent.children &&\n      sourceComponent.children.length === 0)\n      {\n        const parentId = findParentId({\n          childId: source.id,\n          layout });\n\n        dispatch(deleteComponent(source.id, parentId));\n      }\n\n      // show warning if item has been moved between different scope\n      if (\n      isInDifferentFilterScopes({\n        dashboardFilters,\n        source: (sourceComponent.parents || []).concat(source.id),\n        destination: (destinationComponent.parents || []).concat(\n        destination.id) }))\n\n\n      {\n        dispatch(\n        addWarningToast(\n        t('This chart has been moved to a different filter scope.')));\n\n\n      }\n    }\n\n    return null;\n  };\n}\n\n// Undo redo ------------------------------------------------------------------\nexport function undoLayoutAction() {\n  return (dispatch, getState) => {\n    dispatch(UndoActionCreators.undo());\n\n    const { dashboardLayout, dashboardState } = getState();\n\n    if (\n    dashboardLayout.past.length === 0 &&\n    !dashboardState.maxUndoHistoryExceeded &&\n    !dashboardState.updatedColorScheme)\n    {\n      dispatch(setUnsavedChanges(false));\n    }\n  };\n}\n\nexport const redoLayoutAction = setUnsavedChangesAfterAction(\nUndoActionCreators.redo);\n\n\n// Update component parents list ----------------------------------------------\nexport const UPDATE_COMPONENTS_PARENTS_LIST = 'UPDATE_COMPONENTS_PARENTS_LIST';;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(UPDATE_COMPONENTS, \"UPDATE_COMPONENTS\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(setUnsavedChangesAfterAction, \"setUnsavedChangesAfterAction\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(updateComponents, \"updateComponents\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(updateDashboardTitle, \"updateDashboardTitle\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(DASHBOARD_TITLE_CHANGED, \"DASHBOARD_TITLE_CHANGED\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(dashboardTitleChanged, \"dashboardTitleChanged\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(DELETE_COMPONENT, \"DELETE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(deleteComponent, \"deleteComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(CREATE_COMPONENT, \"CREATE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(createComponent, \"createComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(CREATE_TOP_LEVEL_TABS, \"CREATE_TOP_LEVEL_TABS\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(createTopLevelTabs, \"createTopLevelTabs\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(DELETE_TOP_LEVEL_TABS, \"DELETE_TOP_LEVEL_TABS\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(deleteTopLevelTabs, \"deleteTopLevelTabs\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(RESIZE_COMPONENT, \"RESIZE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(resizeComponent, \"resizeComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(MOVE_COMPONENT, \"MOVE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(moveComponent, \"moveComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(HANDLE_COMPONENT_DROP, \"HANDLE_COMPONENT_DROP\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(handleComponentDrop, \"handleComponentDrop\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(undoLayoutAction, \"undoLayoutAction\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(redoLayoutAction, \"redoLayoutAction\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(UPDATE_COMPONENTS_PARENTS_LIST, \"UPDATE_COMPONENTS_PARENTS_LIST\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(__signature__, \"__signature__\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(UPDATE_COMPONENTS, \"UPDATE_COMPONENTS\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(setUnsavedChangesAfterAction, \"setUnsavedChangesAfterAction\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(updateComponents, \"updateComponents\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(updateDashboardTitle, \"updateDashboardTitle\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(DASHBOARD_TITLE_CHANGED, \"DASHBOARD_TITLE_CHANGED\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(dashboardTitleChanged, \"dashboardTitleChanged\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(DELETE_COMPONENT, \"DELETE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(deleteComponent, \"deleteComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(CREATE_COMPONENT, \"CREATE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(createComponent, \"createComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(CREATE_TOP_LEVEL_TABS, \"CREATE_TOP_LEVEL_TABS\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(createTopLevelTabs, \"createTopLevelTabs\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(DELETE_TOP_LEVEL_TABS, \"DELETE_TOP_LEVEL_TABS\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(deleteTopLevelTabs, \"deleteTopLevelTabs\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(RESIZE_COMPONENT, \"RESIZE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(resizeComponent, \"resizeComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(MOVE_COMPONENT, \"MOVE_COMPONENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(moveComponent, \"moveComponent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(HANDLE_COMPONENT_DROP, \"HANDLE_COMPONENT_DROP\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(handleComponentDrop, \"handleComponentDrop\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(undoLayoutAction, \"undoLayoutAction\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(redoLayoutAction, \"redoLayoutAction\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");reactHotLoader.register(UPDATE_COMPONENTS_PARENTS_LIST, \"UPDATE_COMPONENTS_PARENTS_LIST\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/actions/dashboardLayout.js"],"names":["ActionCreators","UPDATE_COMPONENTS","setUnsavedChangesAfterAction","result","action","dispatch","isComponentLevelEvent","components","getState","updateLayoutComponents","setUnsavedChanges","updateComponents","type","payload","updateDashboardTitle","dashboardLayout","meta","DASHBOARD_TITLE_CHANGED","dashboardTitleChanged","DELETE_COMPONENT","deleteComponent","CREATE_COMPONENT","createComponent","CREATE_TOP_LEVEL_TABS","createTopLevelTabs","DELETE_TOP_LEVEL_TABS","deleteTopLevelTabs","RESIZE_COMPONENT","resizeComponent","present","component","dashboard","widthChanged","width","heightChanged","height","updatedComponents","MOVE_COMPONENT","moveComponent","HANDLE_COMPONENT_DROP","handleComponentDrop","overflowsParent","dropOverflowsParent","addWarningToast","t","droppedOnRoot","destination","isNewComponent","source","dashboardRoot","rootChildId","sourceComponent","layout","destinationComponent","parentId","findParentId","childId","isInDifferentFilterScopes","undoLayoutAction","UndoActionCreators","dashboardState","redoLayoutAction","UPDATE_COMPONENTS_PARENTS_LIST"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ActionCreators as UndoActionCreators } from 'redux-undo';\nimport { t } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\nimport { TABS_TYPE, ROW_TYPE } from 'src/dashboard/util/componentTypes';\nimport {\n  DASHBOARD_ROOT_ID,\n  NEW_COMPONENTS_SOURCE_ID,\n  DASHBOARD_HEADER_ID,\n} from 'src/dashboard/util/constants';\nimport dropOverflowsParent from 'src/dashboard/util/dropOverflowsParent';\nimport findParentId from 'src/dashboard/util/findParentId';\nimport isInDifferentFilterScopes from 'src/dashboard/util/isInDifferentFilterScopes';\nimport { updateLayoutComponents } from './dashboardFilters';\nimport { setUnsavedChanges } from './dashboardState';\n\n// Component CRUD -------------------------------------------------------------\nexport const UPDATE_COMPONENTS = 'UPDATE_COMPONENTS';\n\n// this is a helper that takes an action as input and dispatches\n// an additional setUnsavedChanges(true) action after the dispatch in the case\n// that dashboardState.hasUnsavedChanges is false.\nfunction setUnsavedChangesAfterAction(action) {\n  return (...args) => (dispatch, getState) => {\n    const result = action(...args);\n    if (typeof result === 'function') {\n      dispatch(result(dispatch, getState));\n    } else {\n      dispatch(result);\n    }\n\n    const isComponentLevelEvent =\n      result.type === UPDATE_COMPONENTS &&\n      result.payload &&\n      result.payload.nextComponents;\n    // trigger dashboardFilters state update if dashboard layout is changed.\n    if (!isComponentLevelEvent) {\n      const components = getState().dashboardLayout.present;\n      dispatch(updateLayoutComponents(components));\n    }\n\n    if (!getState().dashboardState.hasUnsavedChanges) {\n      dispatch(setUnsavedChanges(true));\n    }\n  };\n}\n\nexport const updateComponents = setUnsavedChangesAfterAction(\n  nextComponents => ({\n    type: UPDATE_COMPONENTS,\n    payload: {\n      nextComponents,\n    },\n  }),\n);\n\nexport function updateDashboardTitle(text) {\n  return (dispatch, getState) => {\n    const { dashboardLayout } = getState();\n    dispatch(\n      updateComponents({\n        [DASHBOARD_HEADER_ID]: {\n          ...dashboardLayout.present[DASHBOARD_HEADER_ID],\n          meta: {\n            text,\n          },\n        },\n      }),\n    );\n  };\n}\n\nexport const DASHBOARD_TITLE_CHANGED = 'DASHBOARD_TITLE_CHANGED';\n\n// call this one when it's not an undo-able action\nexport function dashboardTitleChanged(text) {\n  return {\n    type: DASHBOARD_TITLE_CHANGED,\n    text,\n  };\n}\n\nexport const DELETE_COMPONENT = 'DELETE_COMPONENT';\nexport const deleteComponent = setUnsavedChangesAfterAction((id, parentId) => ({\n  type: DELETE_COMPONENT,\n  payload: {\n    id,\n    parentId,\n  },\n}));\n\nexport const CREATE_COMPONENT = 'CREATE_COMPONENT';\nexport const createComponent = setUnsavedChangesAfterAction(dropResult => ({\n  type: CREATE_COMPONENT,\n  payload: {\n    dropResult,\n  },\n}));\n\n// Tabs -----------------------------------------------------------------------\nexport const CREATE_TOP_LEVEL_TABS = 'CREATE_TOP_LEVEL_TABS';\nexport const createTopLevelTabs = setUnsavedChangesAfterAction(dropResult => ({\n  type: CREATE_TOP_LEVEL_TABS,\n  payload: {\n    dropResult,\n  },\n}));\n\nexport const DELETE_TOP_LEVEL_TABS = 'DELETE_TOP_LEVEL_TABS';\nexport const deleteTopLevelTabs = setUnsavedChangesAfterAction(() => ({\n  type: DELETE_TOP_LEVEL_TABS,\n  payload: {},\n}));\n\n// Resize ---------------------------------------------------------------------\nexport const RESIZE_COMPONENT = 'RESIZE_COMPONENT';\nexport function resizeComponent({ id, width, height }) {\n  return (dispatch, getState) => {\n    const { dashboardLayout: undoableLayout } = getState();\n    const { present: dashboard } = undoableLayout;\n    const component = dashboard[id];\n    const widthChanged = width && component.meta.width !== width;\n    const heightChanged = height && component.meta.height !== height;\n    if (component && (widthChanged || heightChanged)) {\n      // update the size of this component\n      const updatedComponents = {\n        [id]: {\n          ...component,\n          meta: {\n            ...component.meta,\n            width: width || component.meta.width,\n            height: height || component.meta.height,\n          },\n        },\n      };\n\n      dispatch(updateComponents(updatedComponents));\n    }\n  };\n}\n\n// Drag and drop --------------------------------------------------------------\nexport const MOVE_COMPONENT = 'MOVE_COMPONENT';\nconst moveComponent = setUnsavedChangesAfterAction(dropResult => ({\n  type: MOVE_COMPONENT,\n  payload: {\n    dropResult,\n  },\n}));\n\nexport const HANDLE_COMPONENT_DROP = 'HANDLE_COMPONENT_DROP';\nexport function handleComponentDrop(dropResult) {\n  return (dispatch, getState) => {\n    const overflowsParent = dropOverflowsParent(\n      dropResult,\n      getState().dashboardLayout.present,\n    );\n\n    if (overflowsParent) {\n      return dispatch(\n        addWarningToast(\n          t(\n            `There is not enough space for this component. Try decreasing its width, or increasing the destination width.`,\n          ),\n        ),\n      );\n    }\n\n    const { source, destination } = dropResult;\n    const droppedOnRoot = destination && destination.id === DASHBOARD_ROOT_ID;\n    const isNewComponent = source.id === NEW_COMPONENTS_SOURCE_ID;\n    const dashboardRoot = getState().dashboardLayout.present[DASHBOARD_ROOT_ID];\n    const rootChildId =\n      dashboardRoot && dashboardRoot.children ? dashboardRoot.children[0] : '';\n\n    if (droppedOnRoot) {\n      dispatch(createTopLevelTabs(dropResult));\n    } else if (destination && isNewComponent) {\n      dispatch(createComponent(dropResult));\n    } else if (\n      // Add additional allow-to-drop logic for tag/tags source.\n      // We only allow\n      // - top-level tab => top-level tab: rearrange top-level tab order\n      // - nested tab => top-level tab: allow row tab become top-level tab\n      // Dashboard does not allow top-level tab become nested tab, to avoid\n      // nested tab inside nested tab.\n      source.type === TABS_TYPE &&\n      destination.type === TABS_TYPE &&\n      source.id === rootChildId &&\n      destination.id !== rootChildId\n    ) {\n      return dispatch(\n        addWarningToast(t(`Can not move top level tab into nested tabs`)),\n      );\n    } else if (\n      destination &&\n      source &&\n      !(\n        // ensure it has moved\n        (destination.id === source.id && destination.index === source.index)\n      )\n    ) {\n      dispatch(moveComponent(dropResult));\n    }\n\n    // call getState() again down here in case redux state is stale after\n    // previous dispatch(es)\n    const { dashboardFilters, dashboardLayout: undoableLayout } = getState();\n\n    // if we moved a child from a Tab or Row parent and it was the only child, delete the parent.\n    if (!isNewComponent) {\n      const { present: layout } = undoableLayout;\n      const sourceComponent = layout[source.id] || {};\n      const destinationComponent = layout[destination.id] || {};\n      if (\n        (sourceComponent.type === TABS_TYPE ||\n          sourceComponent.type === ROW_TYPE) &&\n        sourceComponent.children &&\n        sourceComponent.children.length === 0\n      ) {\n        const parentId = findParentId({\n          childId: source.id,\n          layout,\n        });\n        dispatch(deleteComponent(source.id, parentId));\n      }\n\n      // show warning if item has been moved between different scope\n      if (\n        isInDifferentFilterScopes({\n          dashboardFilters,\n          source: (sourceComponent.parents || []).concat(source.id),\n          destination: (destinationComponent.parents || []).concat(\n            destination.id,\n          ),\n        })\n      ) {\n        dispatch(\n          addWarningToast(\n            t('This chart has been moved to a different filter scope.'),\n          ),\n        );\n      }\n    }\n\n    return null;\n  };\n}\n\n// Undo redo ------------------------------------------------------------------\nexport function undoLayoutAction() {\n  return (dispatch, getState) => {\n    dispatch(UndoActionCreators.undo());\n\n    const { dashboardLayout, dashboardState } = getState();\n\n    if (\n      dashboardLayout.past.length === 0 &&\n      !dashboardState.maxUndoHistoryExceeded &&\n      !dashboardState.updatedColorScheme\n    ) {\n      dispatch(setUnsavedChanges(false));\n    }\n  };\n}\n\nexport const redoLayoutAction = setUnsavedChangesAfterAction(\n  UndoActionCreators.redo,\n);\n\n// Update component parents list ----------------------------------------------\nexport const UPDATE_COMPONENTS_PARENTS_LIST = 'UPDATE_COMPONENTS_PARENTS_LIST';\n"]},"metadata":{},"sourceType":"module"}