{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { styled, SupersetClient, useTheme } from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport ChartContainer from 'src/chart/ChartContainer';\nimport {\ngetFromLocalStorage,\nsetInLocalStorage } from\n'src/utils/localStorageHelpers';\nimport ConnectedExploreChartHeader from './ExploreChartHeader';\nimport { DataTablesPane } from './DataTablesPane';\nimport { buildV1ChartDataPayload } from '../exploreUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  addHistory: PropTypes.func,\n  onQuery: PropTypes.func,\n  can_overwrite: PropTypes.bool.isRequired,\n  can_download: PropTypes.bool.isRequired,\n  datasource: PropTypes.object,\n  dashboardId: PropTypes.number,\n  column_formats: PropTypes.object,\n  containerId: PropTypes.string.isRequired,\n  height: PropTypes.string.isRequired,\n  width: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  table_name: PropTypes.string,\n  vizType: PropTypes.string.isRequired,\n  form_data: PropTypes.object,\n  ownState: PropTypes.object,\n  standalone: PropTypes.number,\n  timeout: PropTypes.number,\n  refreshOverlayVisible: PropTypes.bool,\n  chart: chartPropShape,\n  errorMessage: PropTypes.node,\n  triggerRender: PropTypes.bool };\n\n\nconst GUTTER_SIZE_FACTOR = 1.25;\n\nconst CHART_PANEL_PADDING_HORIZ = 30;\nconst CHART_PANEL_PADDING_VERTICAL = 15;\nconst HEADER_PADDING = 15;\n\nconst STORAGE_KEYS = {\n  sizes: 'chart_split_sizes' };\n\n\nconst INITIAL_SIZES = [90, 10];\nconst MIN_SIZES = [300, 50];\nconst DEFAULT_SOUTH_PANE_HEIGHT_PERCENT = 40;\n\nconst Styles = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  align-content: stretch;\n  overflow: auto;\n  box-shadow: none;\n  height: 100%;\n\n  & > div:last-of-type {\n    flex-basis: 100%;\n  }\n\n  .gutter {\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    width: ${({ theme }) => theme.gridUnit * 9}px;\n    margin: ${({ theme }) => theme.gridUnit * GUTTER_SIZE_FACTOR}px auto;\n  }\n\n  .gutter.gutter-vertical {\n    cursor: row-resize;\n  }\n\n  .ant-collapse {\n    .ant-tabs {\n      height: 100%;\n      .ant-tabs-nav {\n        padding-left: ${({ theme }) => theme.gridUnit * 5}px;\n        margin: 0;\n      }\n      .ant-tabs-content-holder {\n        overflow: hidden;\n        .ant-tabs-content {\n          height: 100%;\n        }\n      }\n    }\n  }\n`;\n\nconst ExploreChartPanel = (props) => {\n  const theme = useTheme();\n  const gutterMargin = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const gutterHeight = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const { height: hHeight, ref: headerRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300 });\n\n  const { width: chartPanelWidth, ref: chartPanelRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300 });\n\n  const [splitSizes, setSplitSizes] = useState(\n  getFromLocalStorage(STORAGE_KEYS.sizes, INITIAL_SIZES));\n\n  const { slice } = props;\n  const updateQueryContext = useCallback(\n  async function fetchChartData() {\n    if (slice && slice.query_context === null) {\n      const queryContext = buildV1ChartDataPayload({\n        formData: slice.form_data,\n        force: false,\n        resultFormat: 'json',\n        resultType: 'full',\n        setDataMask: null,\n        ownState: null });\n\n\n      await SupersetClient.put({\n        endpoint: `/api/v1/chart/${slice.slice_id}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          query_context: JSON.stringify(queryContext),\n          query_context_generation: true }) });\n\n\n    }\n  },\n  [slice]);\n\n\n  useEffect(() => {\n    updateQueryContext();\n  }, [updateQueryContext]);\n\n  const calcSectionHeight = useCallback(\n  (percent) => {\n    let headerHeight;\n    if (props.standalone) {\n      headerHeight = 0;\n    } else if (hHeight) {\n      headerHeight = hHeight + HEADER_PADDING;\n    } else {\n      headerHeight = 50;\n    }\n    const containerHeight = parseInt(props.height, 10) - headerHeight;\n    return (\n      containerHeight * percent / 100 - (gutterHeight / 2 + gutterMargin));\n\n  },\n  [gutterHeight, gutterMargin, props.height, props.standalone, hHeight]);\n\n\n  const [tableSectionHeight, setTableSectionHeight] = useState(\n  calcSectionHeight(INITIAL_SIZES[1]));\n\n\n  const recalcPanelSizes = useCallback(\n  ([, southPercent]) => {\n    setTableSectionHeight(calcSectionHeight(southPercent));\n  },\n  [calcSectionHeight]);\n\n\n  useEffect(() => {\n    recalcPanelSizes(splitSizes);\n  }, [recalcPanelSizes, splitSizes]);\n\n  useEffect(() => {\n    setInLocalStorage(STORAGE_KEYS.sizes, splitSizes);\n  }, [splitSizes]);\n\n  const onDragEnd = (sizes) => {\n    setSplitSizes(sizes);\n  };\n\n  const onCollapseChange = (openPanelName) => {\n    let splitSizes;\n    if (!openPanelName) {\n      splitSizes = INITIAL_SIZES;\n    } else {\n      splitSizes = [\n      100 - DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n      DEFAULT_SOUTH_PANE_HEIGHT_PERCENT];\n\n    }\n    setSplitSizes(splitSizes);\n  };\n  const renderChart = useCallback(() => {\n    const { chart, vizType } = props;\n    const newHeight =\n    vizType === 'filter_box' ?\n    calcSectionHeight(100) - CHART_PANEL_PADDING_VERTICAL :\n    calcSectionHeight(splitSizes[0]) - CHART_PANEL_PADDING_VERTICAL;\n    const chartWidth = chartPanelWidth - CHART_PANEL_PADDING_HORIZ;\n    return (\n      chartWidth > 0 &&\n      ___EmotionJSX(ChartContainer, {\n        width: Math.floor(chartWidth),\n        height: newHeight,\n        ownState: props.ownState,\n        annotationData: chart.annotationData,\n        chartAlert: chart.chartAlert,\n        chartStackTrace: chart.chartStackTrace,\n        chartId: chart.id,\n        chartStatus: chart.chartStatus,\n        triggerRender: props.triggerRender,\n        datasource: props.datasource,\n        errorMessage: props.errorMessage,\n        formData: props.form_data,\n        onQuery: props.onQuery,\n        queriesResponse: chart.queriesResponse,\n        refreshOverlayVisible: props.refreshOverlayVisible,\n        setControlValue: props.actions.setControlValue,\n        timeout: props.timeout,\n        triggerQuery: chart.triggerQuery,\n        vizType: props.vizType, __self: this, __source: { fileName: _jsxFileName, lineNumber: 223, columnNumber: 9 } }));\n\n\n\n  }, [calcSectionHeight, chartPanelWidth, props, splitSizes]);\n\n  const panelBody = useMemo(\n  () =>\n  ___EmotionJSX(\"div\", { className: \"panel-body\", ref: chartPanelRef, __self: this, __source: { fileName: _jsxFileName, lineNumber: 250, columnNumber: 7 } },\n  renderChart()),\n\n\n  [chartPanelRef, renderChart]);\n\n\n  const standaloneChartBody = useMemo(\n  () => ___EmotionJSX(\"div\", { ref: chartPanelRef, __self: this, __source: { fileName: _jsxFileName, lineNumber: 258, columnNumber: 11 } }, renderChart()),\n  [chartPanelRef, renderChart]);\n\n\n  const [queryFormData, setQueryFormData] = useState(\n  props.chart.latestQueryFormData);\n\n\n  useEffect(() => {\n    // only update when `latestQueryFormData` changes AND `triggerRender`\n    // is false. No update should be done when only `triggerRender` changes,\n    // as this can trigger a query downstream based on incomplete form data.\n    // (`latestQueryFormData` is only updated when a a valid request has been\n    // triggered).\n    if (!props.triggerRender) {\n      setQueryFormData(props.chart.latestQueryFormData);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.chart.latestQueryFormData]);\n\n  if (props.standalone) {\n    // dom manipulation hack to get rid of the boostrap theme's body background\n    const standaloneClass = 'background-transparent';\n    const bodyClasses = document.body.className.split(' ');\n    if (!bodyClasses.includes(standaloneClass)) {\n      document.body.className += ` ${standaloneClass}`;\n    }\n    return standaloneChartBody;\n  }\n\n  const header =\n  ___EmotionJSX(ConnectedExploreChartHeader, {\n    ownState: props.ownState,\n    actions: props.actions,\n    addHistory: props.addHistory,\n    can_overwrite: props.can_overwrite,\n    can_download: props.can_download,\n    dashboardId: props.dashboardId,\n    isStarred: props.isStarred,\n    slice: props.slice,\n    sliceName: props.sliceName,\n    table_name: props.table_name,\n    form_data: props.form_data,\n    timeout: props.timeout,\n    chart: props.chart,\n    user: props.user,\n    reports: props.reports, __self: this, __source: { fileName: _jsxFileName, lineNumber: 289, columnNumber: 5 } });\n\n\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${gutterSize + gutterMargin}px)` });\n\n\n  return (\n    ___EmotionJSX(Styles, { className: \"panel panel-default chart-container\", ref: chartPanelRef, __self: this, __source: { fileName: _jsxFileName, lineNumber: 313, columnNumber: 5 } },\n    ___EmotionJSX(\"div\", { className: \"panel-heading\", ref: headerRef, __self: this, __source: { fileName: _jsxFileName, lineNumber: 314, columnNumber: 7 } },\n    header),\n\n    props.vizType === 'filter_box' ?\n    panelBody :\n\n    ___EmotionJSX(Split, {\n      sizes: splitSizes,\n      minSize: MIN_SIZES,\n      direction: \"vertical\",\n      gutterSize: gutterHeight,\n      onDragEnd: onDragEnd,\n      elementStyle: elementStyle, __self: this, __source: { fileName: _jsxFileName, lineNumber: 320, columnNumber: 9 } },\n\n    panelBody,\n    ___EmotionJSX(DataTablesPane, {\n      ownState: props.ownState,\n      queryFormData: queryFormData,\n      tableSectionHeight: tableSectionHeight,\n      onCollapseChange: onCollapseChange,\n      chartStatus: props.chart.chartStatus,\n      errorMessage: props.errorMessage,\n      queriesResponse: props.chart.queriesResponse, __self: this, __source: { fileName: _jsxFileName, lineNumber: 329, columnNumber: 11 } }))));\n\n\n\n\n\n};__signature__(ExploreChartPanel, \"useTheme{theme}\\nuseResizeDetector{{ height: hHeight, ref: headerRef }}\\nuseResizeDetector{{ width: chartPanelWidth, ref: chartPanelRef }}\\nuseState{[splitSizes, setSplitSizes](getFromLocalStorage(STORAGE_KEYS.sizes, INITIAL_SIZES))}\\nuseCallback{updateQueryContext}\\nuseEffect{}\\nuseCallback{calcSectionHeight}\\nuseState{[tableSectionHeight, setTableSectionHeight](calcSectionHeight(INITIAL_SIZES[1]))}\\nuseCallback{recalcPanelSizes}\\nuseEffect{}\\nuseEffect{}\\nuseCallback{renderChart}\\nuseMemo{panelBody}\\nuseMemo{standaloneChartBody}\\nuseState{[queryFormData, setQueryFormData](props.chart.latestQueryFormData)}\\nuseEffect{}\", () => [useTheme, useResizeDetector, useResizeDetector]);\n\nExploreChartPanel.propTypes = propTypes;const _default =\n\nExploreChartPanel;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(GUTTER_SIZE_FACTOR, \"GUTTER_SIZE_FACTOR\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(CHART_PANEL_PADDING_HORIZ, \"CHART_PANEL_PADDING_HORIZ\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(CHART_PANEL_PADDING_VERTICAL, \"CHART_PANEL_PADDING_VERTICAL\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(HEADER_PADDING, \"HEADER_PADDING\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(STORAGE_KEYS, \"STORAGE_KEYS\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(INITIAL_SIZES, \"INITIAL_SIZES\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(MIN_SIZES, \"MIN_SIZES\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(DEFAULT_SOUTH_PANE_HEIGHT_PERCENT, \"DEFAULT_SOUTH_PANE_HEIGHT_PERCENT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(ExploreChartPanel, \"ExploreChartPanel\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");reactHotLoader.register(_default, \"default\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreChartPanel.jsx"],"names":["React","useState","useEffect","useCallback","useMemo","PropTypes","Split","styled","SupersetClient","useTheme","useResizeDetector","chartPropShape","ChartContainer","getFromLocalStorage","setInLocalStorage","ConnectedExploreChartHeader","DataTablesPane","buildV1ChartDataPayload","propTypes","actions","object","isRequired","addHistory","func","onQuery","can_overwrite","bool","can_download","datasource","dashboardId","number","column_formats","containerId","string","height","width","isStarred","slice","sliceName","table_name","vizType","form_data","ownState","standalone","timeout","refreshOverlayVisible","chart","errorMessage","node","triggerRender","GUTTER_SIZE_FACTOR","CHART_PANEL_PADDING_HORIZ","CHART_PANEL_PADDING_VERTICAL","HEADER_PADDING","STORAGE_KEYS","sizes","INITIAL_SIZES","MIN_SIZES","DEFAULT_SOUTH_PANE_HEIGHT_PERCENT","Styles","div","theme","colors","grayscale","light2","gridUnit","ExploreChartPanel","props","gutterMargin","gutterHeight","hHeight","ref","headerRef","refreshMode","refreshRate","chartPanelWidth","chartPanelRef","splitSizes","setSplitSizes","updateQueryContext","fetchChartData","query_context","queryContext","formData","force","resultFormat","resultType","setDataMask","put","endpoint","slice_id","headers","body","JSON","stringify","query_context_generation","calcSectionHeight","percent","headerHeight","containerHeight","parseInt","tableSectionHeight","setTableSectionHeight","recalcPanelSizes","southPercent","onDragEnd","onCollapseChange","openPanelName","renderChart","newHeight","chartWidth","Math","floor","annotationData","chartAlert","chartStackTrace","id","chartStatus","queriesResponse","setControlValue","triggerQuery","panelBody","standaloneChartBody","queryFormData","setQueryFormData","latestQueryFormData","standaloneClass","bodyClasses","document","className","split","includes","header","user","reports","elementStyle","dimension","elementSize","gutterSize"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useCallback, useMemo } from 'react';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport { styled, SupersetClient, useTheme } from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport ChartContainer from 'src/chart/ChartContainer';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport ConnectedExploreChartHeader from './ExploreChartHeader';\nimport { DataTablesPane } from './DataTablesPane';\nimport { buildV1ChartDataPayload } from '../exploreUtils';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  addHistory: PropTypes.func,\n  onQuery: PropTypes.func,\n  can_overwrite: PropTypes.bool.isRequired,\n  can_download: PropTypes.bool.isRequired,\n  datasource: PropTypes.object,\n  dashboardId: PropTypes.number,\n  column_formats: PropTypes.object,\n  containerId: PropTypes.string.isRequired,\n  height: PropTypes.string.isRequired,\n  width: PropTypes.string.isRequired,\n  isStarred: PropTypes.bool.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  table_name: PropTypes.string,\n  vizType: PropTypes.string.isRequired,\n  form_data: PropTypes.object,\n  ownState: PropTypes.object,\n  standalone: PropTypes.number,\n  timeout: PropTypes.number,\n  refreshOverlayVisible: PropTypes.bool,\n  chart: chartPropShape,\n  errorMessage: PropTypes.node,\n  triggerRender: PropTypes.bool,\n};\n\nconst GUTTER_SIZE_FACTOR = 1.25;\n\nconst CHART_PANEL_PADDING_HORIZ = 30;\nconst CHART_PANEL_PADDING_VERTICAL = 15;\nconst HEADER_PADDING = 15;\n\nconst STORAGE_KEYS = {\n  sizes: 'chart_split_sizes',\n};\n\nconst INITIAL_SIZES = [90, 10];\nconst MIN_SIZES = [300, 50];\nconst DEFAULT_SOUTH_PANE_HEIGHT_PERCENT = 40;\n\nconst Styles = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: stretch;\n  align-content: stretch;\n  overflow: auto;\n  box-shadow: none;\n  height: 100%;\n\n  & > div:last-of-type {\n    flex-basis: 100%;\n  }\n\n  .gutter {\n    border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    width: ${({ theme }) => theme.gridUnit * 9}px;\n    margin: ${({ theme }) => theme.gridUnit * GUTTER_SIZE_FACTOR}px auto;\n  }\n\n  .gutter.gutter-vertical {\n    cursor: row-resize;\n  }\n\n  .ant-collapse {\n    .ant-tabs {\n      height: 100%;\n      .ant-tabs-nav {\n        padding-left: ${({ theme }) => theme.gridUnit * 5}px;\n        margin: 0;\n      }\n      .ant-tabs-content-holder {\n        overflow: hidden;\n        .ant-tabs-content {\n          height: 100%;\n        }\n      }\n    }\n  }\n`;\n\nconst ExploreChartPanel = props => {\n  const theme = useTheme();\n  const gutterMargin = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const gutterHeight = theme.gridUnit * GUTTER_SIZE_FACTOR;\n  const { height: hHeight, ref: headerRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300,\n  });\n  const { width: chartPanelWidth, ref: chartPanelRef } = useResizeDetector({\n    refreshMode: 'debounce',\n    refreshRate: 300,\n  });\n  const [splitSizes, setSplitSizes] = useState(\n    getFromLocalStorage(STORAGE_KEYS.sizes, INITIAL_SIZES),\n  );\n  const { slice } = props;\n  const updateQueryContext = useCallback(\n    async function fetchChartData() {\n      if (slice && slice.query_context === null) {\n        const queryContext = buildV1ChartDataPayload({\n          formData: slice.form_data,\n          force: false,\n          resultFormat: 'json',\n          resultType: 'full',\n          setDataMask: null,\n          ownState: null,\n        });\n\n        await SupersetClient.put({\n          endpoint: `/api/v1/chart/${slice.slice_id}`,\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            query_context: JSON.stringify(queryContext),\n            query_context_generation: true,\n          }),\n        });\n      }\n    },\n    [slice],\n  );\n\n  useEffect(() => {\n    updateQueryContext();\n  }, [updateQueryContext]);\n\n  const calcSectionHeight = useCallback(\n    percent => {\n      let headerHeight;\n      if (props.standalone) {\n        headerHeight = 0;\n      } else if (hHeight) {\n        headerHeight = hHeight + HEADER_PADDING;\n      } else {\n        headerHeight = 50;\n      }\n      const containerHeight = parseInt(props.height, 10) - headerHeight;\n      return (\n        (containerHeight * percent) / 100 - (gutterHeight / 2 + gutterMargin)\n      );\n    },\n    [gutterHeight, gutterMargin, props.height, props.standalone, hHeight],\n  );\n\n  const [tableSectionHeight, setTableSectionHeight] = useState(\n    calcSectionHeight(INITIAL_SIZES[1]),\n  );\n\n  const recalcPanelSizes = useCallback(\n    ([, southPercent]) => {\n      setTableSectionHeight(calcSectionHeight(southPercent));\n    },\n    [calcSectionHeight],\n  );\n\n  useEffect(() => {\n    recalcPanelSizes(splitSizes);\n  }, [recalcPanelSizes, splitSizes]);\n\n  useEffect(() => {\n    setInLocalStorage(STORAGE_KEYS.sizes, splitSizes);\n  }, [splitSizes]);\n\n  const onDragEnd = sizes => {\n    setSplitSizes(sizes);\n  };\n\n  const onCollapseChange = openPanelName => {\n    let splitSizes;\n    if (!openPanelName) {\n      splitSizes = INITIAL_SIZES;\n    } else {\n      splitSizes = [\n        100 - DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n        DEFAULT_SOUTH_PANE_HEIGHT_PERCENT,\n      ];\n    }\n    setSplitSizes(splitSizes);\n  };\n  const renderChart = useCallback(() => {\n    const { chart, vizType } = props;\n    const newHeight =\n      vizType === 'filter_box'\n        ? calcSectionHeight(100) - CHART_PANEL_PADDING_VERTICAL\n        : calcSectionHeight(splitSizes[0]) - CHART_PANEL_PADDING_VERTICAL;\n    const chartWidth = chartPanelWidth - CHART_PANEL_PADDING_HORIZ;\n    return (\n      chartWidth > 0 && (\n        <ChartContainer\n          width={Math.floor(chartWidth)}\n          height={newHeight}\n          ownState={props.ownState}\n          annotationData={chart.annotationData}\n          chartAlert={chart.chartAlert}\n          chartStackTrace={chart.chartStackTrace}\n          chartId={chart.id}\n          chartStatus={chart.chartStatus}\n          triggerRender={props.triggerRender}\n          datasource={props.datasource}\n          errorMessage={props.errorMessage}\n          formData={props.form_data}\n          onQuery={props.onQuery}\n          queriesResponse={chart.queriesResponse}\n          refreshOverlayVisible={props.refreshOverlayVisible}\n          setControlValue={props.actions.setControlValue}\n          timeout={props.timeout}\n          triggerQuery={chart.triggerQuery}\n          vizType={props.vizType}\n        />\n      )\n    );\n  }, [calcSectionHeight, chartPanelWidth, props, splitSizes]);\n\n  const panelBody = useMemo(\n    () => (\n      <div className=\"panel-body\" ref={chartPanelRef}>\n        {renderChart()}\n      </div>\n    ),\n    [chartPanelRef, renderChart],\n  );\n\n  const standaloneChartBody = useMemo(\n    () => <div ref={chartPanelRef}>{renderChart()}</div>,\n    [chartPanelRef, renderChart],\n  );\n\n  const [queryFormData, setQueryFormData] = useState(\n    props.chart.latestQueryFormData,\n  );\n\n  useEffect(() => {\n    // only update when `latestQueryFormData` changes AND `triggerRender`\n    // is false. No update should be done when only `triggerRender` changes,\n    // as this can trigger a query downstream based on incomplete form data.\n    // (`latestQueryFormData` is only updated when a a valid request has been\n    // triggered).\n    if (!props.triggerRender) {\n      setQueryFormData(props.chart.latestQueryFormData);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.chart.latestQueryFormData]);\n\n  if (props.standalone) {\n    // dom manipulation hack to get rid of the boostrap theme's body background\n    const standaloneClass = 'background-transparent';\n    const bodyClasses = document.body.className.split(' ');\n    if (!bodyClasses.includes(standaloneClass)) {\n      document.body.className += ` ${standaloneClass}`;\n    }\n    return standaloneChartBody;\n  }\n\n  const header = (\n    <ConnectedExploreChartHeader\n      ownState={props.ownState}\n      actions={props.actions}\n      addHistory={props.addHistory}\n      can_overwrite={props.can_overwrite}\n      can_download={props.can_download}\n      dashboardId={props.dashboardId}\n      isStarred={props.isStarred}\n      slice={props.slice}\n      sliceName={props.sliceName}\n      table_name={props.table_name}\n      form_data={props.form_data}\n      timeout={props.timeout}\n      chart={props.chart}\n      user={props.user}\n      reports={props.reports}\n    />\n  );\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${gutterSize + gutterMargin}px)`,\n  });\n\n  return (\n    <Styles className=\"panel panel-default chart-container\" ref={chartPanelRef}>\n      <div className=\"panel-heading\" ref={headerRef}>\n        {header}\n      </div>\n      {props.vizType === 'filter_box' ? (\n        panelBody\n      ) : (\n        <Split\n          sizes={splitSizes}\n          minSize={MIN_SIZES}\n          direction=\"vertical\"\n          gutterSize={gutterHeight}\n          onDragEnd={onDragEnd}\n          elementStyle={elementStyle}\n        >\n          {panelBody}\n          <DataTablesPane\n            ownState={props.ownState}\n            queryFormData={queryFormData}\n            tableSectionHeight={tableSectionHeight}\n            onCollapseChange={onCollapseChange}\n            chartStatus={props.chart.chartStatus}\n            errorMessage={props.errorMessage}\n            queriesResponse={props.chart.queriesResponse}\n          />\n        </Split>\n      )}\n    </Styles>\n  );\n};\n\nExploreChartPanel.propTypes = propTypes;\n\nexport default ExploreChartPanel;\n"]},"metadata":{},"sourceType":"module"}