{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport cx from 'classnames';\nimport React, { useCallback, useMemo } from 'react';\nimport { styled, css } from '@superset-ui/core';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport BuilderComponentPane from 'src/dashboard/components/BuilderComponentPane';\nimport DashboardHeader from 'src/dashboard/containers/DashboardHeader';\nimport Icons from 'src/components/Icons';\nimport IconButton from 'src/dashboard/components/IconButton';\nimport DragDroppable from 'src/dashboard/components/dnd/DragDroppable';\nimport DashboardComponent from 'src/dashboard/containers/DashboardComponent';\nimport WithPopoverMenu from 'src/dashboard/components/menu/WithPopoverMenu';\nimport getDirectPathToTabIndex from 'src/dashboard/util/getDirectPathToTabIndex';\nimport { URL_PARAMS } from 'src/constants';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { setDirectPathToChild } from 'src/dashboard/actions/dashboardState';\nimport { useElementOnScreen } from 'src/common/hooks/useElementOnScreen';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { deleteTopLevelTabs, handleComponentDrop } from 'src/dashboard/actions/dashboardLayout';\nimport { DASHBOARD_GRID_ID, DASHBOARD_ROOT_ID, DASHBOARD_ROOT_DEPTH, DashboardStandaloneMode } from 'src/dashboard/util/constants';\nimport FilterBar from 'src/dashboard/components/nativeFilters/FilterBar';\nimport Loading from 'src/components/Loading';\nimport { Global } from '@emotion/react';\nimport { shouldFocusTabs, getRootLevelTabsComponent } from './utils';\nimport DashboardContainer from './DashboardContainer';\nimport { useNativeFilters } from './state';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst MAIN_HEADER_HEIGHT = 53;\nconst TABS_HEIGHT = 50;\nconst HEADER_HEIGHT = 72;\nconst CLOSED_FILTER_BAR_WIDTH = 32;\nconst OPEN_FILTER_BAR_WIDTH = 260;\nconst FILTER_BAR_HEADER_HEIGHT = 80;\nconst FILTER_BAR_TABS_HEIGHT = 46;\nconst StyledDiv = styled.div`\n  display: grid;\n  grid-template-columns: auto 1fr;\n  grid-template-rows: auto 1fr;\n  flex: 1;\n`;\n// @z-index-above-dashboard-charts + 1 = 11\nconst FiltersPanel = styled.div`\n  grid-column: 1;\n  grid-row: 1 / span 2;\n  z-index: 11;\n`;\nconst StickyPanel = styled.div`\n  position: sticky;\n  top: -1px;\n  width: ${({ width }) => width}px;\n  flex: 0 0 ${({ width }) => width}px;\n`;\n// @z-index-above-dashboard-popovers (99) + 1 = 100\nconst StyledHeader = styled.div`\n  grid-column: 2;\n  grid-row: 1;\n  position: sticky;\n  top: 0px;\n  z-index: 100;\n`;\nconst StyledContent = styled.div`\n  grid-column: 2;\n  grid-row: 2;\n  // @z-index-above-dashboard-header (100) + 1 = 101\n  ${({ fullSizeChartId }) => fullSizeChartId && `z-index: 101;`}\n`;\nconst StyledDashboardContent = styled.div`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  height: auto;\n  flex: 1;\n\n  .grid-container .dashboard-component-tabs {\n    box-shadow: none;\n    padding-left: 0;\n  }\n\n  .grid-container {\n    /* without this, the grid will not get smaller upon toggling the builder panel on */\n    width: 0px;\n    flex: 1;\n    position: relative;\n    margin-top: ${({ theme }) => theme.gridUnit * 6}px;\n    margin-right: ${({ theme }) => theme.gridUnit * 8}px;\n    margin-bottom: ${({ theme }) => theme.gridUnit * 6}px;\n    margin-left: ${({ theme, dashboardFiltersOpen, editMode }) => {\n  if (!dashboardFiltersOpen && !editMode) {\n    return 0;\n  }\n  return theme.gridUnit * 8;\n}}px;\n  }\n\n  .dashboard-component-chart-holder {\n    // transitionable traits to show filter relevance\n    transition: opacity ${({ theme }) => theme.transitionTiming}s,\n      border-color ${({ theme }) => theme.transitionTiming}s,\n      box-shadow ${({ theme }) => theme.transitionTiming}s;\n    border: 0 solid transparent;\n  }\n`;\nconst DashboardBuilder = () => {\n  const dispatch = useDispatch();\n  const dashboardLayout = useSelector((state) => state.dashboardLayout.present);\n  const editMode = useSelector((state) => state.dashboardState.editMode);\n  const directPathToChild = useSelector((state) => state.dashboardState.directPathToChild);\n  const fullSizeChartId = useSelector((state) => state.dashboardState.fullSizeChartId);\n  const handleChangeTab = useCallback(({ pathToTabIndex }) => {\n    dispatch(setDirectPathToChild(pathToTabIndex));\n  }, [dispatch]);\n  const handleDeleteTopLevelTabs = useCallback(() => {\n    dispatch(deleteTopLevelTabs());\n    const firstTab = getDirectPathToTabIndex(getRootLevelTabsComponent(dashboardLayout), 0);\n    dispatch(setDirectPathToChild(firstTab));\n  }, [dashboardLayout, dispatch]);\n  const handleDrop = useCallback((dropResult) => dispatch(handleComponentDrop(dropResult)), [dispatch]);\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot.children[0];\n  const topLevelTabs = rootChildId !== DASHBOARD_GRID_ID ?\n  dashboardLayout[rootChildId] :\n  undefined;\n  const StandaloneMode = getUrlParam(URL_PARAMS.standalone);\n  const isReport = StandaloneMode === DashboardStandaloneMode.REPORT;\n  const hideDashboardHeader = StandaloneMode === DashboardStandaloneMode.HIDE_NAV_AND_TITLE || isReport;\n  const barTopOffset = (hideDashboardHeader ? 0 : HEADER_HEIGHT) + (\n  topLevelTabs ? TABS_HEIGHT : 0);\n  const { showDashboard, dashboardFiltersOpen, toggleDashboardFiltersOpen, nativeFiltersEnabled } = useNativeFilters();\n  const filterBarWidth = dashboardFiltersOpen ?\n  OPEN_FILTER_BAR_WIDTH :\n  CLOSED_FILTER_BAR_WIDTH;\n  const [containerRef, isSticky] = useElementOnScreen({\n    threshold: [1] });\n\n  const filterSetEnabled = isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET);\n  const offset = FILTER_BAR_HEADER_HEIGHT + (\n  isSticky || StandaloneMode ? 0 : MAIN_HEADER_HEIGHT) + (\n  filterSetEnabled ? FILTER_BAR_TABS_HEIGHT : 0);\n  const filterBarHeight = `calc(100vh - ${offset}px)`;\n  const filterBarOffset = dashboardFiltersOpen ? 0 : barTopOffset + 20;\n  const draggableStyle = useMemo(() => ({\n    marginLeft: dashboardFiltersOpen || editMode ? 0 : -32 }),\n  [dashboardFiltersOpen, editMode]);\n  const renderDraggableContent = useCallback(({ dropIndicatorProps }) => ___EmotionJSX(\"div\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 162, columnNumber: 77 } },\n  !hideDashboardHeader && ___EmotionJSX(DashboardHeader, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 163, columnNumber: 34 } }),\n  dropIndicatorProps && ___EmotionJSX(\"div\", _extends({}, dropIndicatorProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 164, columnNumber: 32 } })),\n  !isReport && topLevelTabs && ___EmotionJSX(WithPopoverMenu, { shouldFocus: shouldFocusTabs, menuItems: [\n    ___EmotionJSX(IconButton, { icon: ___EmotionJSX(Icons.FallOutlined, { iconSize: \"xl\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 166, columnNumber: 35 } }), label: \"Collapse tab content\", onClick: handleDeleteTopLevelTabs, __self: this, __source: { fileName: _jsxFileName, lineNumber: 166, columnNumber: 17 } })],\n    editMode: editMode, __self: this, __source: { fileName: _jsxFileName, lineNumber: 165, columnNumber: 40 } },\n\n  ___EmotionJSX(DashboardComponent, { id: topLevelTabs == null ? void 0 : topLevelTabs.id, parentId: DASHBOARD_ROOT_ID, depth: DASHBOARD_ROOT_DEPTH + 1, index: 0, renderTabContent: false, renderHoverMenu: false, onChangeTab: handleChangeTab, __self: this, __source: { fileName: _jsxFileName, lineNumber: 169, columnNumber: 13 } }))),\n\n  [\n  editMode,\n  handleChangeTab,\n  handleDeleteTopLevelTabs,\n  hideDashboardHeader,\n  isReport,\n  topLevelTabs]);\n\n  return ___EmotionJSX(StyledDiv, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 179, columnNumber: 13 } },\n  nativeFiltersEnabled && !editMode && ___EmotionJSX(FiltersPanel, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 180, columnNumber: 46 } },\n  ___EmotionJSX(StickyPanel, { ref: containerRef, width: filterBarWidth, __self: this, __source: { fileName: _jsxFileName, lineNumber: 181, columnNumber: 11 } },\n  ___EmotionJSX(ErrorBoundary, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 182, columnNumber: 13 } },\n  ___EmotionJSX(FilterBar, { filtersOpen: dashboardFiltersOpen, toggleFiltersBar: toggleDashboardFiltersOpen, directPathToChild: directPathToChild, width: filterBarWidth, height: filterBarHeight, offset: filterBarOffset, __self: this, __source: { fileName: _jsxFileName, lineNumber: 183, columnNumber: 15 } })))),\n\n\n\n  ___EmotionJSX(StyledHeader, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 187, columnNumber: 7 } },\n\n  ___EmotionJSX(DragDroppable, { \"data-test\": \"top-level-tabs\", component: dashboardRoot, parentComponent: null, depth: DASHBOARD_ROOT_DEPTH, index: 0, orientation: \"column\", onDrop: handleDrop, editMode: editMode\n    // you cannot drop on/displace tabs if they already exist\n    , disableDragDrop: !!topLevelTabs, style: draggableStyle, __self: this, __source: { fileName: _jsxFileName, lineNumber: 189, columnNumber: 9 } },\n  renderDraggableContent)),\n\n\n  ___EmotionJSX(StyledContent, { fullSizeChartId: fullSizeChartId, __self: this, __source: { fileName: _jsxFileName, lineNumber: 195, columnNumber: 7 } },\n  ___EmotionJSX(Global, { styles: css`\n            // @z-index-above-dashboard-header (100) + 1 = 101\n            ${fullSizeChartId &&\n    `div > .filterStatusPopover.ant-popover{z-index: 101}`}\n          `, __self: this, __source: { fileName: _jsxFileName, lineNumber: 196, columnNumber: 9 } }),\n  ___EmotionJSX(\"div\", { \"data-test\": \"dashboard-content\", className: cx('dashboard', editMode && 'dashboard--editing'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 201, columnNumber: 9 } },\n  ___EmotionJSX(StyledDashboardContent, { className: \"dashboard-content\", dashboardFiltersOpen: dashboardFiltersOpen, editMode: editMode, __self: this, __source: { fileName: _jsxFileName, lineNumber: 202, columnNumber: 11 } },\n  showDashboard ? ___EmotionJSX(DashboardContainer, { topLevelTabs: topLevelTabs, __self: this, __source: { fileName: _jsxFileName, lineNumber: 203, columnNumber: 31 } }) : ___EmotionJSX(Loading, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 203, columnNumber: 85 } }),\n  editMode && ___EmotionJSX(BuilderComponentPane, { topOffset: barTopOffset, __self: this, __source: { fileName: _jsxFileName, lineNumber: 204, columnNumber: 26 } })))));\n\n\n\n\n};__signature__(DashboardBuilder, \"useDispatch{dispatch}\\nuseSelector{dashboardLayout}\\nuseSelector{editMode}\\nuseSelector{directPathToChild}\\nuseSelector{fullSizeChartId}\\nuseCallback{handleChangeTab}\\nuseCallback{handleDeleteTopLevelTabs}\\nuseCallback{handleDrop}\\nuseNativeFilters{{ showDashboard, dashboardFiltersOpen, toggleDashboardFiltersOpen, nativeFiltersEnabled, }}\\nuseElementOnScreen{[containerRef, isSticky]}\\nuseMemo{draggableStyle}\\nuseCallback{renderDraggableContent}\", () => [useDispatch, useSelector, useSelector, useSelector, useSelector, useNativeFilters, useElementOnScreen]);const _default =\nDashboardBuilder;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(MAIN_HEADER_HEIGHT, \"MAIN_HEADER_HEIGHT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(TABS_HEIGHT, \"TABS_HEIGHT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(HEADER_HEIGHT, \"HEADER_HEIGHT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(CLOSED_FILTER_BAR_WIDTH, \"CLOSED_FILTER_BAR_WIDTH\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(OPEN_FILTER_BAR_WIDTH, \"OPEN_FILTER_BAR_WIDTH\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(FILTER_BAR_HEADER_HEIGHT, \"FILTER_BAR_HEADER_HEIGHT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(FILTER_BAR_TABS_HEIGHT, \"FILTER_BAR_TABS_HEIGHT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StyledDiv, \"StyledDiv\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(FiltersPanel, \"FiltersPanel\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StickyPanel, \"StickyPanel\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StyledHeader, \"StyledHeader\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StyledContent, \"StyledContent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StyledDashboardContent, \"StyledDashboardContent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(DashboardBuilder, \"DashboardBuilder\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(_default, \"default\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport cx from 'classnames';\nimport React, { FC, useCallback, useMemo } from 'react';\nimport { JsonObject, styled, css } from '@superset-ui/core';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport BuilderComponentPane from 'src/dashboard/components/BuilderComponentPane';\nimport DashboardHeader from 'src/dashboard/containers/DashboardHeader';\nimport Icons from 'src/components/Icons';\nimport IconButton from 'src/dashboard/components/IconButton';\nimport DragDroppable from 'src/dashboard/components/dnd/DragDroppable';\nimport DashboardComponent from 'src/dashboard/containers/DashboardComponent';\nimport WithPopoverMenu from 'src/dashboard/components/menu/WithPopoverMenu';\nimport getDirectPathToTabIndex from 'src/dashboard/util/getDirectPathToTabIndex';\nimport { URL_PARAMS } from 'src/constants';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { DashboardLayout, RootState } from 'src/dashboard/types';\nimport { setDirectPathToChild } from 'src/dashboard/actions/dashboardState';\nimport { useElementOnScreen } from 'src/common/hooks/useElementOnScreen';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport {\n  deleteTopLevelTabs,\n  handleComponentDrop,\n} from 'src/dashboard/actions/dashboardLayout';\nimport {\n  DASHBOARD_GRID_ID,\n  DASHBOARD_ROOT_ID,\n  DASHBOARD_ROOT_DEPTH,\n  DashboardStandaloneMode,\n} from 'src/dashboard/util/constants';\nimport FilterBar from 'src/dashboard/components/nativeFilters/FilterBar';\nimport Loading from 'src/components/Loading';\nimport { Global } from '@emotion/react';\nimport { shouldFocusTabs, getRootLevelTabsComponent } from './utils';\nimport DashboardContainer from './DashboardContainer';\nimport { useNativeFilters } from './state';\n\nconst MAIN_HEADER_HEIGHT = 53;\nconst TABS_HEIGHT = 50;\nconst HEADER_HEIGHT = 72;\nconst CLOSED_FILTER_BAR_WIDTH = 32;\nconst OPEN_FILTER_BAR_WIDTH = 260;\nconst FILTER_BAR_HEADER_HEIGHT = 80;\nconst FILTER_BAR_TABS_HEIGHT = 46;\n\ntype DashboardBuilderProps = {};\n\nconst StyledDiv = styled.div`\n  display: grid;\n  grid-template-columns: auto 1fr;\n  grid-template-rows: auto 1fr;\n  flex: 1;\n`;\n\n// @z-index-above-dashboard-charts + 1 = 11\nconst FiltersPanel = styled.div`\n  grid-column: 1;\n  grid-row: 1 / span 2;\n  z-index: 11;\n`;\n\nconst StickyPanel = styled.div<{ width: number }>`\n  position: sticky;\n  top: -1px;\n  width: ${({ width }) => width}px;\n  flex: 0 0 ${({ width }) => width}px;\n`;\n\n// @z-index-above-dashboard-popovers (99) + 1 = 100\nconst StyledHeader = styled.div`\n  grid-column: 2;\n  grid-row: 1;\n  position: sticky;\n  top: 0px;\n  z-index: 100;\n`;\n\nconst StyledContent = styled.div<{\n  fullSizeChartId: number | null;\n}>`\n  grid-column: 2;\n  grid-row: 2;\n  // @z-index-above-dashboard-header (100) + 1 = 101\n  ${({ fullSizeChartId }) => fullSizeChartId && `z-index: 101;`}\n`;\n\nconst StyledDashboardContent = styled.div<{\n  dashboardFiltersOpen: boolean;\n  editMode: boolean;\n}>`\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  height: auto;\n  flex: 1;\n\n  .grid-container .dashboard-component-tabs {\n    box-shadow: none;\n    padding-left: 0;\n  }\n\n  .grid-container {\n    /* without this, the grid will not get smaller upon toggling the builder panel on */\n    width: 0px;\n    flex: 1;\n    position: relative;\n    margin-top: ${({ theme }) => theme.gridUnit * 6}px;\n    margin-right: ${({ theme }) => theme.gridUnit * 8}px;\n    margin-bottom: ${({ theme }) => theme.gridUnit * 6}px;\n    margin-left: ${({ theme, dashboardFiltersOpen, editMode }) => {\n      if (!dashboardFiltersOpen && !editMode) {\n        return 0;\n      }\n      return theme.gridUnit * 8;\n    }}px;\n  }\n\n  .dashboard-component-chart-holder {\n    // transitionable traits to show filter relevance\n    transition: opacity ${({ theme }) => theme.transitionTiming}s,\n      border-color ${({ theme }) => theme.transitionTiming}s,\n      box-shadow ${({ theme }) => theme.transitionTiming}s;\n    border: 0 solid transparent;\n  }\n`;\n\nconst DashboardBuilder: FC<DashboardBuilderProps> = () => {\n  const dispatch = useDispatch();\n  const dashboardLayout = useSelector<RootState, DashboardLayout>(\n    state => state.dashboardLayout.present,\n  );\n  const editMode = useSelector<RootState, boolean>(\n    state => state.dashboardState.editMode,\n  );\n  const directPathToChild = useSelector<RootState, string[]>(\n    state => state.dashboardState.directPathToChild,\n  );\n  const fullSizeChartId = useSelector<RootState, number | null>(\n    state => state.dashboardState.fullSizeChartId,\n  );\n\n  const handleChangeTab = useCallback(\n    ({ pathToTabIndex }: { pathToTabIndex: string[] }) => {\n      dispatch(setDirectPathToChild(pathToTabIndex));\n    },\n    [dispatch],\n  );\n\n  const handleDeleteTopLevelTabs = useCallback(() => {\n    dispatch(deleteTopLevelTabs());\n\n    const firstTab = getDirectPathToTabIndex(\n      getRootLevelTabsComponent(dashboardLayout),\n      0,\n    );\n    dispatch(setDirectPathToChild(firstTab));\n  }, [dashboardLayout, dispatch]);\n\n  const handleDrop = useCallback(\n    dropResult => dispatch(handleComponentDrop(dropResult)),\n    [dispatch],\n  );\n\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot.children[0];\n  const topLevelTabs =\n    rootChildId !== DASHBOARD_GRID_ID\n      ? dashboardLayout[rootChildId]\n      : undefined;\n  const StandaloneMode = getUrlParam(URL_PARAMS.standalone);\n  const isReport = StandaloneMode === DashboardStandaloneMode.REPORT;\n  const hideDashboardHeader =\n    StandaloneMode === DashboardStandaloneMode.HIDE_NAV_AND_TITLE || isReport;\n\n  const barTopOffset =\n    (hideDashboardHeader ? 0 : HEADER_HEIGHT) +\n    (topLevelTabs ? TABS_HEIGHT : 0);\n\n  const {\n    showDashboard,\n    dashboardFiltersOpen,\n    toggleDashboardFiltersOpen,\n    nativeFiltersEnabled,\n  } = useNativeFilters();\n\n  const filterBarWidth = dashboardFiltersOpen\n    ? OPEN_FILTER_BAR_WIDTH\n    : CLOSED_FILTER_BAR_WIDTH;\n\n  const [containerRef, isSticky] = useElementOnScreen<HTMLDivElement>({\n    threshold: [1],\n  });\n\n  const filterSetEnabled = isFeatureEnabled(\n    FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET,\n  );\n\n  const offset =\n    FILTER_BAR_HEADER_HEIGHT +\n    (isSticky || StandaloneMode ? 0 : MAIN_HEADER_HEIGHT) +\n    (filterSetEnabled ? FILTER_BAR_TABS_HEIGHT : 0);\n\n  const filterBarHeight = `calc(100vh - ${offset}px)`;\n  const filterBarOffset = dashboardFiltersOpen ? 0 : barTopOffset + 20;\n\n  const draggableStyle = useMemo(\n    () => ({\n      marginLeft: dashboardFiltersOpen || editMode ? 0 : -32,\n    }),\n    [dashboardFiltersOpen, editMode],\n  );\n\n  const renderDraggableContent = useCallback(\n    ({ dropIndicatorProps }: { dropIndicatorProps: JsonObject }) => (\n      <div>\n        {!hideDashboardHeader && <DashboardHeader />}\n        {dropIndicatorProps && <div {...dropIndicatorProps} />}\n        {!isReport && topLevelTabs && (\n          <WithPopoverMenu\n            shouldFocus={shouldFocusTabs}\n            menuItems={[\n              <IconButton\n                icon={<Icons.FallOutlined iconSize=\"xl\" />}\n                label=\"Collapse tab content\"\n                onClick={handleDeleteTopLevelTabs}\n              />,\n            ]}\n            editMode={editMode}\n          >\n            {/* @ts-ignore */}\n            <DashboardComponent\n              id={topLevelTabs?.id}\n              parentId={DASHBOARD_ROOT_ID}\n              depth={DASHBOARD_ROOT_DEPTH + 1}\n              index={0}\n              renderTabContent={false}\n              renderHoverMenu={false}\n              onChangeTab={handleChangeTab}\n            />\n          </WithPopoverMenu>\n        )}\n      </div>\n    ),\n    [\n      editMode,\n      handleChangeTab,\n      handleDeleteTopLevelTabs,\n      hideDashboardHeader,\n      isReport,\n      topLevelTabs,\n    ],\n  );\n\n  return (\n    <StyledDiv>\n      {nativeFiltersEnabled && !editMode && (\n        <FiltersPanel>\n          <StickyPanel ref={containerRef} width={filterBarWidth}>\n            <ErrorBoundary>\n              <FilterBar\n                filtersOpen={dashboardFiltersOpen}\n                toggleFiltersBar={toggleDashboardFiltersOpen}\n                directPathToChild={directPathToChild}\n                width={filterBarWidth}\n                height={filterBarHeight}\n                offset={filterBarOffset}\n              />\n            </ErrorBoundary>\n          </StickyPanel>\n        </FiltersPanel>\n      )}\n      <StyledHeader>\n        {/* @ts-ignore */}\n        <DragDroppable\n          data-test=\"top-level-tabs\"\n          component={dashboardRoot}\n          parentComponent={null}\n          depth={DASHBOARD_ROOT_DEPTH}\n          index={0}\n          orientation=\"column\"\n          onDrop={handleDrop}\n          editMode={editMode}\n          // you cannot drop on/displace tabs if they already exist\n          disableDragDrop={!!topLevelTabs}\n          style={draggableStyle}\n        >\n          {renderDraggableContent}\n        </DragDroppable>\n      </StyledHeader>\n      <StyledContent fullSizeChartId={fullSizeChartId}>\n        <Global\n          styles={css`\n            // @z-index-above-dashboard-header (100) + 1 = 101\n            ${fullSizeChartId &&\n            `div > .filterStatusPopover.ant-popover{z-index: 101}`}\n          `}\n        />\n        <div\n          data-test=\"dashboard-content\"\n          className={cx('dashboard', editMode && 'dashboard--editing')}\n        >\n          <StyledDashboardContent\n            className=\"dashboard-content\"\n            dashboardFiltersOpen={dashboardFiltersOpen}\n            editMode={editMode}\n          >\n            {showDashboard ? (\n              <DashboardContainer topLevelTabs={topLevelTabs} />\n            ) : (\n              <Loading />\n            )}\n            {editMode && <BuilderComponentPane topOffset={barTopOffset} />}\n          </StyledDashboardContent>\n        </div>\n      </StyledContent>\n    </StyledDiv>\n  );\n};\n\nexport default DashboardBuilder;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}