{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, SupersetClient, logging, styled, css } from '@superset-ui/core';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport SupersetText from 'src/utils/textUtils';\nconst createFetchResourceMethod = (method) => (resource, relation, handleError, user) => async (filterValue = '', page, pageSize) => {var _json$result;\n  const resourceEndpoint = `/api/v1/${resource}/${method}/${relation}`;\n  const queryParams = rison.encode({\n    filter: filterValue,\n    page,\n    page_size: pageSize });\n\n  const { json = {} } = await SupersetClient.get({\n    endpoint: `${resourceEndpoint}?q=${queryParams}` });\n\n  let fetchedLoggedUser = false;\n  const loggedUser = user ?\n  {\n    label: `${user.firstName} ${user.lastName}`,\n    value: user.userId } :\n\n  undefined;\n  const data = [];\n  json == null ? void 0 : (_json$result = json.result) == null ? void 0 : _json$result.forEach(({ text, value }) => {\n    if (loggedUser &&\n    value === loggedUser.value &&\n    text === loggedUser.label) {\n      fetchedLoggedUser = true;\n    } else\n    {\n      data.push({\n        label: text,\n        value });\n\n    }\n  });\n  if (loggedUser && (!filterValue || fetchedLoggedUser)) {\n    data.unshift(loggedUser);\n  }\n  return {\n    data,\n    totalCount: json == null ? void 0 : json.count };\n\n};\nexport const PAGE_SIZE = 5;\nconst getParams = (filters) => {\n  const params = {\n    order_column: 'changed_on_delta_humanized',\n    order_direction: 'desc',\n    page: 0,\n    page_size: PAGE_SIZE,\n    filters };\n\n  if (!filters)\n  delete params.filters;\n  return rison.encode(params);\n};\nexport const getEditedObjects = (userId) => {\n  const filters = {\n    edited: [\n    {\n      col: 'changed_by',\n      opr: 'rel_o_m',\n      value: `${userId}` }] };\n\n\n\n  const batch = [\n  SupersetClient.get({\n    endpoint: `/api/v1/dashboard/?q=${getParams(filters.edited)}` }),\n\n  SupersetClient.get({\n    endpoint: `/api/v1/chart/?q=${getParams(filters.edited)}` })];\n\n\n  return Promise.all(batch).\n  then(([editedCharts, editedDashboards]) => {var _editedDashboards$jso, _editedCharts$json;\n    const res = {\n      editedDash: (_editedDashboards$jso = editedDashboards.json) == null ? void 0 : _editedDashboards$jso.result.slice(0, 3),\n      editedChart: (_editedCharts$json = editedCharts.json) == null ? void 0 : _editedCharts$json.result.slice(0, 3) };\n\n    return res;\n  }).\n  catch((err) => err);\n};\nexport const getUserOwnedObjects = (userId, resource) => {\n  const filters = {\n    created: [\n    {\n      col: 'created_by',\n      opr: 'rel_o_m',\n      value: `${userId}` }] };\n\n\n\n  return SupersetClient.get({\n    endpoint: `/api/v1/${resource}/?q=${getParams(filters.created)}` }).\n  then((res) => {var _res$json;return (_res$json = res.json) == null ? void 0 : _res$json.result;});\n};\nexport const getRecentAcitivtyObjs = (userId, recent, addDangerToast) => SupersetClient.get({ endpoint: recent }).then((recentsRes) => {\n  const res = {};\n  const filters = [\n  {\n    col: 'created_by',\n    opr: 'rel_o_m',\n    value: 0 }];\n\n\n  const newBatch = [\n  SupersetClient.get({\n    endpoint: `/api/v1/chart/?q=${getParams(filters)}` }),\n\n  SupersetClient.get({\n    endpoint: `/api/v1/dashboard/?q=${getParams(filters)}` })];\n\n\n  return Promise.all(newBatch).\n  then(([chartRes, dashboardRes]) => {\n    res.examples = [...chartRes.json.result, ...dashboardRes.json.result];\n    res.viewed = recentsRes.json;\n    return res;\n  }).\n  catch((errMsg) => addDangerToast(t('There was an error fetching your recent activity:'), errMsg));\n});\nexport const createFetchRelated = createFetchResourceMethod('related');\nexport const createFetchDistinct = createFetchResourceMethod('distinct');\nexport function createErrorHandler(handleErrorFunc) {\n  return async (e) => {\n    const parsedError = await getClientErrorObject(e);\n    // Taking the first error returned from the API\n    // @ts-ignore\n    const errorsArray = parsedError == null ? void 0 : parsedError.errors;\n    const config = await SupersetText;\n    if (errorsArray &&\n    errorsArray.length &&\n    config &&\n    config.ERRORS &&\n    errorsArray[0].error_type in config.ERRORS) {\n      parsedError.message = config.ERRORS[errorsArray[0].error_type];\n    }\n    logging.error(e);\n    handleErrorFunc(parsedError.message || parsedError.error);\n  };\n}\nexport function handleChartDelete({ id, slice_name: sliceName }, addSuccessToast, addDangerToast, refreshData, chartFilter, userId) {\n  const filters = {\n    pageIndex: 0,\n    pageSize: PAGE_SIZE,\n    sortBy: [\n    {\n      id: 'changed_on_delta_humanized',\n      desc: true }],\n\n\n    filters: [\n    {\n      id: 'created_by',\n      operator: 'rel_o_m',\n      value: `${userId}` }] };\n\n\n\n  SupersetClient.delete({\n    endpoint: `/api/v1/chart/${id}` }).\n  then(() => {\n    if (chartFilter === 'Mine')\n    refreshData(filters);else\n\n    refreshData();\n    addSuccessToast(t('Deleted: %s', sliceName));\n  }, () => {\n    addDangerToast(t('There was an issue deleting: %s', sliceName));\n  });\n}\nexport function handleDashboardDelete({ id, dashboard_title: dashboardTitle }, refreshData, addSuccessToast, addDangerToast, dashboardFilter, userId) {\n  return SupersetClient.delete({\n    endpoint: `/api/v1/dashboard/${id}` }).\n  then(() => {\n    const filters = {\n      pageIndex: 0,\n      pageSize: PAGE_SIZE,\n      sortBy: [\n      {\n        id: 'changed_on_delta_humanized',\n        desc: true }],\n\n\n      filters: [\n      {\n        id: 'owners',\n        operator: 'rel_m_m',\n        value: `${userId}` }] };\n\n\n\n    if (dashboardFilter === 'Mine')\n    refreshData(filters);else\n\n    refreshData();\n    addSuccessToast(t('Deleted: %s', dashboardTitle));\n  }, createErrorHandler((errMsg) => addDangerToast(t('There was an issue deleting %s: %s', dashboardTitle, errMsg))));\n}\nexport function shortenSQL(sql, maxLines) {\n  let lines = sql.split('\\n');\n  if (lines.length >= maxLines) {\n    lines = lines.slice(0, maxLines);\n    lines.push('...');\n  }\n  return lines.join('\\n');\n}\n// loading card count for homepage\nexport const loadingCardCount = 5;\nconst breakpoints = [576, 768, 992, 1200];\nexport const mq = breakpoints.map((bp) => `@media (max-width: ${bp}px)`);\nexport const CardContainer = styled.div`\n  ${({ showThumbnails, theme }) => `\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${theme.gridUnit * 12}px ${theme.gridUnit * 4}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${showThumbnails ? '314' : '148'}px;\n    margin-top: ${theme.gridUnit * -6}px;\n    padding: ${showThumbnails ?\n`${theme.gridUnit * 8 + 3}px ${theme.gridUnit * 9}px` :\n`${theme.gridUnit * 8 + 1}px ${theme.gridUnit * 9}px`};\n  `}\n`;\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n  .ant-card-cover > div {\n    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */\n    height: 168px;\n  }\n`;\nexport const StyledIcon = (theme) => css`\n  margin: auto ${theme.gridUnit * 2}px auto 0;\n  color: ${theme.colors.grayscale.base};\n`;\nexport /* eslint-disable no-underscore-dangle */const isNeedsPassword = (payload) => typeof payload === 'object' &&\nArray.isArray(payload._schema) &&\npayload._schema.length === 1 &&\npayload._schema[0] === 'Must provide a password for the database';\nexport const isAlreadyExists = (payload) => typeof payload === 'string' &&\npayload.includes('already exists and `overwrite=true` was not passed');\nexport const getPasswordsNeeded = (errors) => errors.\nmap((error) => Object.entries(error.extra).\nfilter(([, payload]) => isNeedsPassword(payload)).\nmap(([fileName]) => fileName)).\nflat();\nexport const getAlreadyExists = (errors) => errors.\nmap((error) => Object.entries(error.extra).\nfilter(([, payload]) => isAlreadyExists(payload)).\nmap(([fileName]) => fileName)).\nflat();\nexport const hasTerminalValidation = (errors) => errors.some((error) => !Object.values(error.extra).some((payload) => isNeedsPassword(payload) || isAlreadyExists(payload)));;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(createFetchResourceMethod, \"createFetchResourceMethod\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(PAGE_SIZE, \"PAGE_SIZE\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(getParams, \"getParams\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(getEditedObjects, \"getEditedObjects\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(getUserOwnedObjects, \"getUserOwnedObjects\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(getRecentAcitivtyObjs, \"getRecentAcitivtyObjs\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(createFetchRelated, \"createFetchRelated\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(createFetchDistinct, \"createFetchDistinct\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(createErrorHandler, \"createErrorHandler\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(handleChartDelete, \"handleChartDelete\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(handleDashboardDelete, \"handleDashboardDelete\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(shortenSQL, \"shortenSQL\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(loadingCardCount, \"loadingCardCount\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(breakpoints, \"breakpoints\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(mq, \"mq\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(CardContainer, \"CardContainer\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(CardStyles, \"CardStyles\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(StyledIcon, \"StyledIcon\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(isNeedsPassword, \"isNeedsPassword\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(isAlreadyExists, \"isAlreadyExists\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(getPasswordsNeeded, \"getPasswordsNeeded\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(getAlreadyExists, \"getAlreadyExists\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");reactHotLoader.register(hasTerminalValidation, \"hasTerminalValidation\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/utils.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  t,\n  SupersetClient,\n  SupersetClientResponse,\n  logging,\n  styled,\n  SupersetTheme,\n  css,\n} from '@superset-ui/core';\nimport Chart from 'src/types/Chart';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FetchDataConfig } from 'src/components/ListView';\nimport SupersetText from 'src/utils/textUtils';\nimport { Dashboard, Filters } from './types';\n\nconst createFetchResourceMethod = (method: string) => (\n  resource: string,\n  relation: string,\n  handleError: (error: Response) => void,\n  user?: { userId: string | number; firstName: string; lastName: string },\n) => async (filterValue = '', page: number, pageSize: number) => {\n  const resourceEndpoint = `/api/v1/${resource}/${method}/${relation}`;\n  const queryParams = rison.encode({\n    filter: filterValue,\n    page,\n    page_size: pageSize,\n  });\n  const { json = {} } = await SupersetClient.get({\n    endpoint: `${resourceEndpoint}?q=${queryParams}`,\n  });\n\n  let fetchedLoggedUser = false;\n  const loggedUser = user\n    ? {\n        label: `${user.firstName} ${user.lastName}`,\n        value: user.userId,\n      }\n    : undefined;\n\n  const data: { label: string; value: string | number }[] = [];\n  json?.result?.forEach(\n    ({ text, value }: { text: string; value: string | number }) => {\n      if (\n        loggedUser &&\n        value === loggedUser.value &&\n        text === loggedUser.label\n      ) {\n        fetchedLoggedUser = true;\n      } else {\n        data.push({\n          label: text,\n          value,\n        });\n      }\n    },\n  );\n\n  if (loggedUser && (!filterValue || fetchedLoggedUser)) {\n    data.unshift(loggedUser);\n  }\n\n  return {\n    data,\n    totalCount: json?.count,\n  };\n};\n\nexport const PAGE_SIZE = 5;\nconst getParams = (filters?: Array<Filters>) => {\n  const params = {\n    order_column: 'changed_on_delta_humanized',\n    order_direction: 'desc',\n    page: 0,\n    page_size: PAGE_SIZE,\n    filters,\n  };\n  if (!filters) delete params.filters;\n  return rison.encode(params);\n};\n\nexport const getEditedObjects = (userId: string | number) => {\n  const filters = {\n    edited: [\n      {\n        col: 'changed_by',\n        opr: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  const batch = [\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/?q=${getParams(filters.edited)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${getParams(filters.edited)}`,\n    }),\n  ];\n  return Promise.all(batch)\n    .then(([editedCharts, editedDashboards]) => {\n      const res = {\n        editedDash: editedDashboards.json?.result.slice(0, 3),\n        editedChart: editedCharts.json?.result.slice(0, 3),\n      };\n      return res;\n    })\n    .catch(err => err);\n};\n\nexport const getUserOwnedObjects = (\n  userId: string | number,\n  resource: string,\n) => {\n  const filters = {\n    created: [\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  return SupersetClient.get({\n    endpoint: `/api/v1/${resource}/?q=${getParams(filters.created)}`,\n  }).then(res => res.json?.result);\n};\n\nexport const getRecentAcitivtyObjs = (\n  userId: string | number,\n  recent: string,\n  addDangerToast: (arg1: string, arg2: any) => any,\n) =>\n  SupersetClient.get({ endpoint: recent }).then(recentsRes => {\n    const res: any = {};\n    const filters = [\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: 0,\n      },\n    ];\n    const newBatch = [\n      SupersetClient.get({\n        endpoint: `/api/v1/chart/?q=${getParams(filters)}`,\n      }),\n      SupersetClient.get({\n        endpoint: `/api/v1/dashboard/?q=${getParams(filters)}`,\n      }),\n    ];\n    return Promise.all(newBatch)\n      .then(([chartRes, dashboardRes]) => {\n        res.examples = [...chartRes.json.result, ...dashboardRes.json.result];\n        res.viewed = recentsRes.json;\n        return res;\n      })\n      .catch(errMsg =>\n        addDangerToast(\n          t('There was an error fetching your recent activity:'),\n          errMsg,\n        ),\n      );\n  });\n\nexport const createFetchRelated = createFetchResourceMethod('related');\nexport const createFetchDistinct = createFetchResourceMethod('distinct');\n\nexport function createErrorHandler(\n  handleErrorFunc: (\n    errMsg?: string | Record<string, string[] | string>,\n  ) => void,\n) {\n  return async (e: SupersetClientResponse | string) => {\n    const parsedError = await getClientErrorObject(e);\n    // Taking the first error returned from the API\n    // @ts-ignore\n    const errorsArray = parsedError?.errors;\n    const config = await SupersetText;\n    if (\n      errorsArray &&\n      errorsArray.length &&\n      config &&\n      config.ERRORS &&\n      errorsArray[0].error_type in config.ERRORS\n    ) {\n      parsedError.message = config.ERRORS[errorsArray[0].error_type];\n    }\n    logging.error(e);\n    handleErrorFunc(parsedError.message || parsedError.error);\n  };\n}\n\nexport function handleChartDelete(\n  { id, slice_name: sliceName }: Chart,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  refreshData: (arg0?: FetchDataConfig | null) => void,\n  chartFilter?: string,\n  userId?: number,\n) {\n  const filters = {\n    pageIndex: 0,\n    pageSize: PAGE_SIZE,\n    sortBy: [\n      {\n        id: 'changed_on_delta_humanized',\n        desc: true,\n      },\n    ],\n    filters: [\n      {\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  SupersetClient.delete({\n    endpoint: `/api/v1/chart/${id}`,\n  }).then(\n    () => {\n      if (chartFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', sliceName));\n    },\n    () => {\n      addDangerToast(t('There was an issue deleting: %s', sliceName));\n    },\n  );\n}\n\nexport function handleDashboardDelete(\n  { id, dashboard_title: dashboardTitle }: Dashboard,\n  refreshData: (config?: FetchDataConfig | null) => void,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  dashboardFilter?: string,\n  userId?: number,\n) {\n  return SupersetClient.delete({\n    endpoint: `/api/v1/dashboard/${id}`,\n  }).then(\n    () => {\n      const filters = {\n        pageIndex: 0,\n        pageSize: PAGE_SIZE,\n        sortBy: [\n          {\n            id: 'changed_on_delta_humanized',\n            desc: true,\n          },\n        ],\n        filters: [\n          {\n            id: 'owners',\n            operator: 'rel_m_m',\n            value: `${userId}`,\n          },\n        ],\n      };\n      if (dashboardFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', dashboardTitle));\n    },\n    createErrorHandler(errMsg =>\n      addDangerToast(\n        t('There was an issue deleting %s: %s', dashboardTitle, errMsg),\n      ),\n    ),\n  );\n}\n\nexport function shortenSQL(sql: string, maxLines: number) {\n  let lines: string[] = sql.split('\\n');\n  if (lines.length >= maxLines) {\n    lines = lines.slice(0, maxLines);\n    lines.push('...');\n  }\n  return lines.join('\\n');\n}\n\n// loading card count for homepage\nexport const loadingCardCount = 5;\n\nconst breakpoints = [576, 768, 992, 1200];\nexport const mq = breakpoints.map(bp => `@media (max-width: ${bp}px)`);\n\nexport const CardContainer = styled.div<{\n  showThumbnails?: boolean | undefined;\n}>`\n  ${({ showThumbnails, theme }) => `\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${theme.gridUnit * 12}px ${theme.gridUnit * 4}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${showThumbnails ? '314' : '148'}px;\n    margin-top: ${theme.gridUnit * -6}px;\n    padding: ${\n      showThumbnails\n        ? `${theme.gridUnit * 8 + 3}px ${theme.gridUnit * 9}px`\n        : `${theme.gridUnit * 8 + 1}px ${theme.gridUnit * 9}px`\n    };\n  `}\n`;\n\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n  .ant-card-cover > div {\n    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */\n    height: 168px;\n  }\n`;\n\nexport const StyledIcon = (theme: SupersetTheme) => css`\n  margin: auto ${theme.gridUnit * 2}px auto 0;\n  color: ${theme.colors.grayscale.base};\n`;\n\nexport /* eslint-disable no-underscore-dangle */\nconst isNeedsPassword = (payload: any) =>\n  typeof payload === 'object' &&\n  Array.isArray(payload._schema) &&\n  payload._schema.length === 1 &&\n  payload._schema[0] === 'Must provide a password for the database';\n\nexport const isAlreadyExists = (payload: any) =>\n  typeof payload === 'string' &&\n  payload.includes('already exists and `overwrite=true` was not passed');\n\nexport const getPasswordsNeeded = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isNeedsPassword(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const getAlreadyExists = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isAlreadyExists(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const hasTerminalValidation = (errors: Record<string, any>[]) =>\n  errors.some(\n    error =>\n      !Object.values(error.extra).some(\n        payload => isNeedsPassword(payload) || isAlreadyExists(payload),\n      ),\n  );\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}