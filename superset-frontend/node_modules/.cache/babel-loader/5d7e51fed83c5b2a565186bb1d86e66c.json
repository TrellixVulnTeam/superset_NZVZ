{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nimport Popover from 'src/components/Popover';\nimport FormRow from 'src/components/FormRow';\nimport { Select } from 'src/components';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport { FILTER_CONFIG_ATTRIBUTES } from 'src/explore/constants';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst INTEGRAL_TYPES = new Set([\n'TINYINT',\n'SMALLINT',\n'INT',\n'INTEGER',\n'BIGINT',\n'LONG']);\n\nconst DECIMAL_TYPES = new Set([\n'FLOAT',\n'DOUBLE',\n'REAL',\n'NUMERIC',\n'DECIMAL',\n'MONEY']);\n\n\nconst propTypes = {\n  datasource: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  asc: PropTypes.bool,\n  clearable: PropTypes.bool,\n  multiple: PropTypes.bool,\n  column: PropTypes.string,\n  label: PropTypes.string,\n  metric: PropTypes.string,\n  searchAllOptions: PropTypes.bool,\n  defaultValue: PropTypes.string };\n\n\nconst defaultProps = {\n  onChange: () => {},\n  asc: true,\n  clearable: true,\n  multiple: true,\n  searchAllOptions: false };\n\n\nconst STYLE_WIDTH = { width: 350 };\n\nexport default class FilterBoxItemControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const {\n      column,\n      metric,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      label,\n      defaultValue } =\n    props;\n    this.state = {\n      column,\n      metric,\n      label,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      defaultValue };\n\n    this.onChange = this.onChange.bind(this);\n    this.onControlChange = this.onControlChange.bind(this);\n  }\n\n  onChange() {\n    this.props.onChange(this.state);\n  }\n\n  onControlChange(attr, value) {\n    let typedValue = value;\n    const { column: selectedColumnName, multiple } = this.state;\n    if (value && !multiple && attr === FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE) {\n      // if single value filter_box,\n      // convert input value string to the column's data type\n      const { datasource } = this.props;\n      const selectedColumn = datasource.columns.find(\n      (col) => col.column_name === selectedColumnName);\n\n\n      if (selectedColumn && selectedColumn.type) {\n        const type = selectedColumn.type.toUpperCase();\n        if (type === 'BOOLEAN') {\n          typedValue = value === 'true';\n        } else if (INTEGRAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseInt(value, 10);\n        } else if (DECIMAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseFloat(value);\n        }\n      }\n    }\n    this.setState({ [attr]: typedValue }, this.onChange);\n  }\n\n  setType() {}\n\n  textSummary() {\n    return this.state.column || 'N/A';\n  }\n\n  renderForm() {\n    return (\n      ___EmotionJSX(\"div\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 135, columnNumber: 7 } },\n      ___EmotionJSX(FormRow, {\n        label: t('Column'),\n        control:\n        ___EmotionJSX(Select, {\n          ariaLabel: t('Column'),\n          value: this.state.column,\n          name: \"column\",\n          options: this.props.datasource.columns.\n          filter((col) => col.column_name !== this.state.column).\n          map((col) => ({\n            value: col.column_name,\n            label: col.column_name })).\n\n          concat([\n          { value: this.state.column, label: this.state.column }]),\n\n          onChange: (v) => this.onControlChange('column', v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 139, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 136, columnNumber: 9 } }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Label'),\n        control:\n        ___EmotionJSX(TextControl, {\n          value: this.state.label,\n          name: \"label\",\n          onChange: (v) => this.onControlChange('label', v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 159, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 156, columnNumber: 9 } }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Default'),\n        tooltip: t(\n        '(optional) default value for the filter, when using ' +\n        'the multiple option, you can use a semicolon-delimited list ' +\n        'of options.'),\n\n        control:\n        ___EmotionJSX(TextControl, {\n          value: this.state.defaultValue,\n          name: \"defaultValue\",\n          onChange: (v) =>\n          this.onControlChange(FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE, v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 174, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 166, columnNumber: 9 } }),\n\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Sort metric'),\n        tooltip: t('Metric to sort the results by'),\n        control:\n        ___EmotionJSX(Select, {\n          ariaLabel: t('Sort metric'),\n          value: this.state.metric,\n          name: \"column\",\n          options: this.props.datasource.metrics.\n          filter((m) => m.metric_name !== this.state.metric).\n          map((m) => ({\n            value: m.metric_name,\n            label: m.metric_name })).\n\n          concat([\n          { value: this.state.metric, label: this.state.metric }]),\n\n          onChange: (v) => this.onControlChange('metric', v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 187, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 183, columnNumber: 9 } }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Sort ascending'),\n        tooltip: t('Check for sorting ascending'),\n        isCheckbox: true,\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: this.state.asc,\n          onChange: (v) => this.onControlChange('asc', v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 209, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 204, columnNumber: 9 } }),\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Allow multiple selections'),\n        isCheckbox: true,\n        tooltip: t(\n        'Multiple selections allowed, otherwise filter ' +\n        'is limited to a single value'),\n\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: this.state.multiple,\n          onChange: (v) =>\n          this.onControlChange(FILTER_CONFIG_ATTRIBUTES.MULTIPLE, v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 223, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 215, columnNumber: 9 } }),\n\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Search all filter options'),\n        tooltip: t(\n        'By default, each filter loads at most 1000 choices at the initial page load. ' +\n        'Check this box if you have more than 1000 filter values and want to enable dynamically ' +\n        'searching that loads filter values as users type (may add stress to your database).'),\n\n        isCheckbox: true,\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: this.state.searchAllOptions,\n          onChange: (v) =>\n          this.onControlChange(\n          FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS,\n          v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 240, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 231, columnNumber: 9 } }),\n\n\n\n\n\n      ___EmotionJSX(FormRow, {\n        label: t('Required'),\n        tooltip: t('User must select a value for this filter'),\n        isCheckbox: true,\n        control:\n        ___EmotionJSX(CheckboxControl, {\n          value: !this.state.clearable,\n          onChange: (v) => this.onControlChange('clearable', !v), __self: this, __source: { fileName: _jsxFileName, lineNumber: 256, columnNumber: 13 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 251, columnNumber: 9 } })));\n\n\n\n\n\n  }\n\n  renderPopover() {\n    return (\n      ___EmotionJSX(\"div\", { id: \"ts-col-popo\", style: STYLE_WIDTH, __self: this, __source: { fileName: _jsxFileName, lineNumber: 268, columnNumber: 7 } },\n      this.renderForm()));\n\n\n  }\n\n  render() {\n    return (\n      ___EmotionJSX(\"span\", { \"data-test\": \"FilterBoxItemControl\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 276, columnNumber: 7 } },\n      this.textSummary(), ' ',\n      ___EmotionJSX(Popover, {\n        trigger: \"click\",\n        placement: \"right\",\n        content: this.renderPopover(),\n        title: t('Filter configuration'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 278, columnNumber: 9 } },\n\n      ___EmotionJSX(InfoTooltipWithTrigger, {\n        icon: \"edit\",\n        className: \"text-primary\",\n        label: \"edit-ts-column\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 284, columnNumber: 11 } }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nFilterBoxItemControl.propTypes = propTypes;\nFilterBoxItemControl.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(INTEGRAL_TYPES, \"INTEGRAL_TYPES\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(DECIMAL_TYPES, \"DECIMAL_TYPES\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(STYLE_WIDTH, \"STYLE_WIDTH\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");reactHotLoader.register(FilterBoxItemControl, \"FilterBoxItemControl\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterBoxItemControl/index.jsx"],"names":["React","PropTypes","t","InfoTooltipWithTrigger","Popover","FormRow","Select","CheckboxControl","TextControl","FILTER_CONFIG_ATTRIBUTES","INTEGRAL_TYPES","Set","DECIMAL_TYPES","propTypes","datasource","object","isRequired","onChange","func","asc","bool","clearable","multiple","column","string","label","metric","searchAllOptions","defaultValue","defaultProps","STYLE_WIDTH","width","FilterBoxItemControl","Component","constructor","props","state","bind","onControlChange","attr","value","typedValue","selectedColumnName","DEFAULT_VALUE","selectedColumn","columns","find","col","column_name","type","toUpperCase","has","Number","isNaN","parseInt","parseFloat","setState","setType","textSummary","renderForm","filter","map","concat","v","metrics","m","metric_name","MULTIPLE","SEARCH_ALL_OPTIONS","renderPopover","render"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nimport Popover from 'src/components/Popover';\nimport FormRow from 'src/components/FormRow';\nimport { Select } from 'src/components';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport { FILTER_CONFIG_ATTRIBUTES } from 'src/explore/constants';\n\nconst INTEGRAL_TYPES = new Set([\n  'TINYINT',\n  'SMALLINT',\n  'INT',\n  'INTEGER',\n  'BIGINT',\n  'LONG',\n]);\nconst DECIMAL_TYPES = new Set([\n  'FLOAT',\n  'DOUBLE',\n  'REAL',\n  'NUMERIC',\n  'DECIMAL',\n  'MONEY',\n]);\n\nconst propTypes = {\n  datasource: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  asc: PropTypes.bool,\n  clearable: PropTypes.bool,\n  multiple: PropTypes.bool,\n  column: PropTypes.string,\n  label: PropTypes.string,\n  metric: PropTypes.string,\n  searchAllOptions: PropTypes.bool,\n  defaultValue: PropTypes.string,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  asc: true,\n  clearable: true,\n  multiple: true,\n  searchAllOptions: false,\n};\n\nconst STYLE_WIDTH = { width: 350 };\n\nexport default class FilterBoxItemControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const {\n      column,\n      metric,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      label,\n      defaultValue,\n    } = props;\n    this.state = {\n      column,\n      metric,\n      label,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      defaultValue,\n    };\n    this.onChange = this.onChange.bind(this);\n    this.onControlChange = this.onControlChange.bind(this);\n  }\n\n  onChange() {\n    this.props.onChange(this.state);\n  }\n\n  onControlChange(attr, value) {\n    let typedValue = value;\n    const { column: selectedColumnName, multiple } = this.state;\n    if (value && !multiple && attr === FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE) {\n      // if single value filter_box,\n      // convert input value string to the column's data type\n      const { datasource } = this.props;\n      const selectedColumn = datasource.columns.find(\n        col => col.column_name === selectedColumnName,\n      );\n\n      if (selectedColumn && selectedColumn.type) {\n        const type = selectedColumn.type.toUpperCase();\n        if (type === 'BOOLEAN') {\n          typedValue = value === 'true';\n        } else if (INTEGRAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseInt(value, 10);\n        } else if (DECIMAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseFloat(value);\n        }\n      }\n    }\n    this.setState({ [attr]: typedValue }, this.onChange);\n  }\n\n  setType() {}\n\n  textSummary() {\n    return this.state.column || 'N/A';\n  }\n\n  renderForm() {\n    return (\n      <div>\n        <FormRow\n          label={t('Column')}\n          control={\n            <Select\n              ariaLabel={t('Column')}\n              value={this.state.column}\n              name=\"column\"\n              options={this.props.datasource.columns\n                .filter(col => col.column_name !== this.state.column)\n                .map(col => ({\n                  value: col.column_name,\n                  label: col.column_name,\n                }))\n                .concat([\n                  { value: this.state.column, label: this.state.column },\n                ])}\n              onChange={v => this.onControlChange('column', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Label')}\n          control={\n            <TextControl\n              value={this.state.label}\n              name=\"label\"\n              onChange={v => this.onControlChange('label', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Default')}\n          tooltip={t(\n            '(optional) default value for the filter, when using ' +\n              'the multiple option, you can use a semicolon-delimited list ' +\n              'of options.',\n          )}\n          control={\n            <TextControl\n              value={this.state.defaultValue}\n              name=\"defaultValue\"\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort metric')}\n          tooltip={t('Metric to sort the results by')}\n          control={\n            <Select\n              ariaLabel={t('Sort metric')}\n              value={this.state.metric}\n              name=\"column\"\n              options={this.props.datasource.metrics\n                .filter(m => m.metric_name !== this.state.metric)\n                .map(m => ({\n                  value: m.metric_name,\n                  label: m.metric_name,\n                }))\n                .concat([\n                  { value: this.state.metric, label: this.state.metric },\n                ])}\n              onChange={v => this.onControlChange('metric', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort ascending')}\n          tooltip={t('Check for sorting ascending')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.asc}\n              onChange={v => this.onControlChange('asc', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Allow multiple selections')}\n          isCheckbox\n          tooltip={t(\n            'Multiple selections allowed, otherwise filter ' +\n              'is limited to a single value',\n          )}\n          control={\n            <CheckboxControl\n              value={this.state.multiple}\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.MULTIPLE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Search all filter options')}\n          tooltip={t(\n            'By default, each filter loads at most 1000 choices at the initial page load. ' +\n              'Check this box if you have more than 1000 filter values and want to enable dynamically ' +\n              'searching that loads filter values as users type (may add stress to your database).',\n          )}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.searchAllOptions}\n              onChange={v =>\n                this.onControlChange(\n                  FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS,\n                  v,\n                )\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Required')}\n          tooltip={t('User must select a value for this filter')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={!this.state.clearable}\n              onChange={v => this.onControlChange('clearable', !v)}\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={STYLE_WIDTH}>\n        {this.renderForm()}\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span data-test=\"FilterBoxItemControl\">\n        {this.textSummary()}{' '}\n        <Popover\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n          title={t('Filter configuration')}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </Popover>\n      </span>\n    );\n  }\n}\n\nFilterBoxItemControl.propTypes = propTypes;\nFilterBoxItemControl.defaultProps = defaultProps;\n"]},"metadata":{},"sourceType":"module"}