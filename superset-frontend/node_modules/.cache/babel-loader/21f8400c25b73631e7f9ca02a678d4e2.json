{"ast":null,"code":"import _omit from \"lodash/omit\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();import \"core-js/modules/es.string.replace.js\";var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useEffect } from 'react';\n\n/* eslint camelcase: 0 */\nimport URI from 'urijs';\nimport {\nbuildQueryContext,\nensureIsArray,\ngetChartBuildQueryRegistry,\ngetChartMetadataRegistry } from\n'@superset-ui/core';\nimport { availableDomains } from 'src/utils/hostNamesConfig';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { URL_PARAMS } from 'src/constants';\nimport {\nMULTI_OPERATORS,\nOPERATOR_ENUM_TO_OPERATOR_TYPE } from\n'src/explore/constants';\nimport { DashboardStandaloneMode } from 'src/dashboard/util/constants';\n\nconst MAX_URL_LENGTH = 8000;\n\nexport function getChartKey(explore) {\n  const { slice } = explore;\n  return slice ? slice.slice_id : 0;\n}\n\nlet requestCounter = 0;\nexport function getHostName(allowDomainSharding = false) {\n  let currentIndex = 0;\n  if (allowDomainSharding) {\n    currentIndex = requestCounter % availableDomains.length;\n    requestCounter += 1;\n\n    // if domain sharding is enabled, skip main domain for fetching chart API\n    // leave main domain free for other calls like fav star, save change, etc.\n    // to make dashboard be responsive when it's loading large number of charts\n    if (currentIndex === 0) {\n      currentIndex += 1;\n      requestCounter += 1;\n    }\n  }\n  return availableDomains[currentIndex];\n}\n\nexport function getAnnotationJsonUrl(slice_id, form_data, isNative, force) {\n  if (slice_id === null || slice_id === undefined) {\n    return null;\n  }\n  const uri = URI(window.location.search);\n  const endpoint = isNative ? 'annotation_json' : 'slice_json';\n  return uri.\n  pathname(`/superset/${endpoint}/${slice_id}`).\n  search({\n    form_data: safeStringify(form_data, (key, value) =>\n    value === null ? undefined : value),\n\n    force }).\n\n  toString();\n}\n\nexport function getURIDirectory(endpointType = 'base') {\n  // Building the directory part of the URI\n  if (\n  ['full', 'json', 'csv', 'query', 'results', 'samples'].includes(\n  endpointType))\n\n  {\n    return '/superset/explore_json/';\n  }\n  return '/superset/explore/';\n}\n\n/**\n * This gets the url of the explore page, with all the form data included explicitly.\n * This includes any form data overrides from the dashboard.\n */\nexport function getExploreLongUrl(\nformData,\nendpointType,\nallowOverflow = true,\nextraSearch = {})\n{\n  if (!formData.datasource) {\n    return null;\n  }\n\n  // remove formData params that we don't need in the explore url.\n  // These are present when generating explore urls from the dashboard page.\n  // This should be superseded by some sort of \"exploration context\" system\n  // where form data and other context is referenced by id.\n  const trimmedFormData = _omit(formData, ['dataMask', 'url_params']);\n\n  const uri = new URI('/');\n  const directory = getURIDirectory(endpointType);\n  const search = uri.search(true);\n  Object.keys(extraSearch).forEach((key) => {\n    search[key] = extraSearch[key];\n  });\n  search.form_data = safeStringify(trimmedFormData);\n  if (endpointType === URL_PARAMS.standalone.name) {\n    search.standalone = DashboardStandaloneMode.HIDE_NAV;\n  }\n  const url = uri.directory(directory).search(search).toString();\n  if (!allowOverflow && url.length > MAX_URL_LENGTH) {\n    const minimalFormData = {\n      datasource: formData.datasource,\n      viz_type: formData.viz_type };\n\n    return getExploreLongUrl(minimalFormData, endpointType, false, {\n      URL_IS_TOO_LONG_TO_SHARE: null });\n\n  }\n  return url;\n}\n\nexport function getExploreUrlFromDashboard(formData) {\n  // remove formData params that we don't need in the explore url.\n  // These are present when generating explore urls from the dashboard page.\n  // This should be superseded by some sort of \"exploration context\" system\n  // where form data and other context is referenced by id.\n  const trimmedFormData = _omit(formData, [\n  'dataMask',\n  'url_params',\n  'label_colors']);\n\n  return getExploreLongUrl(trimmedFormData, null, false);\n}\n\nexport function getChartDataUri({ path, qs, allowDomainSharding = false }) {\n  // The search params from the window.location are carried through,\n  // but can be specified with curUrl (used for unit tests to spoof\n  // the window.location).\n  let uri = new URI({\n    protocol: window.location.protocol.slice(0, -1),\n    hostname: getHostName(allowDomainSharding),\n    port: window.location.port ? window.location.port : '',\n    path });\n\n  if (qs) {\n    uri = uri.search(qs);\n  }\n  return uri;\n}\n\n/**\n * This gets the minimal url for the given form data.\n * If there are dashboard overrides present in the form data,\n * they will not be included in the url.\n */\nexport function getExploreUrl({\n  formData,\n  endpointType = 'base',\n  force = false,\n  curUrl = null,\n  requestParams = {},\n  allowDomainSharding = false,\n  method = 'POST' })\n{\n  if (!formData.datasource) {\n    return null;\n  }\n\n  // label_colors should not pollute the URL\n  // eslint-disable-next-line no-param-reassign\n  delete formData.label_colors;\n\n  let uri = getChartDataUri({ path: '/', allowDomainSharding });\n  if (curUrl) {\n    uri = URI(URI(curUrl).search());\n  }\n\n  const directory = getURIDirectory(endpointType);\n\n  // Building the querystring (search) part of the URI\n  const search = uri.search(true);\n  const { slice_id, extra_filters, adhoc_filters, viz_type } = formData;\n  if (slice_id) {\n    const form_data = { slice_id };\n    if (method === 'GET') {\n      form_data.viz_type = viz_type;\n      if (extra_filters && extra_filters.length) {\n        form_data.extra_filters = extra_filters;\n      }\n      if (adhoc_filters && adhoc_filters.length) {\n        form_data.adhoc_filters = adhoc_filters;\n      }\n    }\n    search.form_data = safeStringify(form_data);\n  }\n  if (force) {\n    search.force = 'true';\n  }\n  if (endpointType === 'csv') {\n    search.csv = 'true';\n  }\n  if (endpointType === URL_PARAMS.standalone.name) {\n    search.standalone = '1';\n  }\n  if (endpointType === 'query') {\n    search.query = 'true';\n  }\n  if (endpointType === 'results') {\n    search.results = 'true';\n  }\n  if (endpointType === 'samples') {\n    search.samples = 'true';\n  }\n  const paramNames = Object.keys(requestParams);\n  if (paramNames.length) {\n    paramNames.forEach((name) => {\n      if (requestParams.hasOwnProperty(name)) {\n        search[name] = requestParams[name];\n      }\n    });\n  }\n  return uri.search(search).directory(directory).toString();\n}\n\nexport const shouldUseLegacyApi = (formData) => {\n  const vizMetadata = getChartMetadataRegistry().get(formData.viz_type);\n  return vizMetadata ? vizMetadata.useLegacyApi : false;\n};\n\nexport const buildV1ChartDataPayload = ({\n  formData,\n  force,\n  resultFormat,\n  resultType,\n  setDataMask,\n  ownState }) =>\n{var _getChartBuildQueryRe;\n  const buildQuery = (_getChartBuildQueryRe =\n  getChartBuildQueryRegistry().get(formData.viz_type)) != null ? _getChartBuildQueryRe :\n  (buildQueryformData) =>\n  buildQueryContext(buildQueryformData, (baseQueryObject) => [\n  {\n    ...baseQueryObject }]);\n\n\n  return buildQuery(\n  {\n    ...formData,\n    force,\n    result_format: resultFormat,\n    result_type: resultType },\n\n  {\n    ownState,\n    hooks: {\n      setDataMask } });\n\n\n\n};\n\nexport const getLegacyEndpointType = ({ resultType, resultFormat }) =>\nresultFormat === 'csv' ? resultFormat : resultType;\n\nexport function postForm(url, payload, target = '_blank') {\n  if (!url) {\n    return;\n  }\n\n  const hiddenForm = document.createElement('form');\n  hiddenForm.action = url;\n  hiddenForm.method = 'POST';\n  hiddenForm.target = target;\n  const token = document.createElement('input');\n  token.type = 'hidden';\n  token.name = 'csrf_token';\n  token.value = (document.getElementById('csrf_token') || {}).value;\n  hiddenForm.appendChild(token);\n  const data = document.createElement('input');\n  data.type = 'hidden';\n  data.name = 'form_data';\n  data.value = safeStringify(payload);\n  hiddenForm.appendChild(data);\n\n  document.body.appendChild(hiddenForm);\n  hiddenForm.submit();\n  document.body.removeChild(hiddenForm);\n}\n\nexport const exportChart = ({\n  formData,\n  resultFormat = 'json',\n  resultType = 'full',\n  force = false,\n  ownState = {} }) =>\n{\n  let url;\n  let payload;\n  if (shouldUseLegacyApi(formData)) {\n    const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n    url = getExploreUrl({\n      formData,\n      endpointType,\n      allowDomainSharding: false });\n\n    payload = formData;\n  } else {\n    url = '/api/v1/chart/data';\n    payload = buildV1ChartDataPayload({\n      formData,\n      force,\n      resultFormat,\n      resultType,\n      ownState });\n\n  }\n  postForm(url, payload);\n};\n\nexport const exploreChart = (formData) => {\n  const url = getExploreUrl({\n    formData,\n    endpointType: 'base',\n    allowDomainSharding: false });\n\n  postForm(url, formData);\n};\n\nexport const useDebouncedEffect = (effect, delay, deps) => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const callback = useCallback(effect, deps);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      callback();\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [callback, delay]);\n};__signature__(useDebouncedEffect, \"useCallback{callback}\\nuseEffect{}\");\n\nexport const getSimpleSQLExpression = (subject, operator, comparator) => {\n  const isMulti =\n  [...MULTI_OPERATORS].\n  map((op) => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation).\n  indexOf(operator) >= 0;\n  let expression = subject != null ? subject : '';\n  if (subject && operator) {\n    expression += ` ${operator}`;\n    const firstValue =\n    isMulti && Array.isArray(comparator) ? comparator[0] : comparator;\n    const comparatorArray = ensureIsArray(comparator);\n    const isString =\n    firstValue !== undefined && Number.isNaN(Number(firstValue));\n    const quote = isString ? \"'\" : '';\n    const [prefix, suffix] = isMulti ? ['(', ')'] : ['', ''];\n    const formattedComparators = comparatorArray.map(\n    (val) =>\n    `${quote}${isString ? String(val).replace(\"'\", \"''\") : val}${quote}`);\n\n    if (comparatorArray.length > 0) {\n      expression += ` ${prefix}${formattedComparators.join(', ')}${suffix}`;\n    }\n  }\n  return expression;\n};;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(MAX_URL_LENGTH, \"MAX_URL_LENGTH\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getChartKey, \"getChartKey\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(requestCounter, \"requestCounter\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getHostName, \"getHostName\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getAnnotationJsonUrl, \"getAnnotationJsonUrl\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getURIDirectory, \"getURIDirectory\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getExploreLongUrl, \"getExploreLongUrl\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getExploreUrlFromDashboard, \"getExploreUrlFromDashboard\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getChartDataUri, \"getChartDataUri\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getExploreUrl, \"getExploreUrl\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(shouldUseLegacyApi, \"shouldUseLegacyApi\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(buildV1ChartDataPayload, \"buildV1ChartDataPayload\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getLegacyEndpointType, \"getLegacyEndpointType\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(postForm, \"postForm\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(exportChart, \"exportChart\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(exploreChart, \"exploreChart\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(useDebouncedEffect, \"useDebouncedEffect\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");reactHotLoader.register(getSimpleSQLExpression, \"getSimpleSQLExpression\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/exploreUtils/index.js"],"names":["useCallback","useEffect","URI","buildQueryContext","ensureIsArray","getChartBuildQueryRegistry","getChartMetadataRegistry","availableDomains","safeStringify","URL_PARAMS","MULTI_OPERATORS","OPERATOR_ENUM_TO_OPERATOR_TYPE","DashboardStandaloneMode","MAX_URL_LENGTH","getChartKey","explore","slice","slice_id","requestCounter","getHostName","allowDomainSharding","currentIndex","length","getAnnotationJsonUrl","form_data","isNative","force","undefined","uri","window","location","search","endpoint","pathname","key","value","toString","getURIDirectory","endpointType","includes","getExploreLongUrl","formData","allowOverflow","extraSearch","datasource","trimmedFormData","directory","Object","keys","forEach","standalone","name","HIDE_NAV","url","minimalFormData","viz_type","URL_IS_TOO_LONG_TO_SHARE","getExploreUrlFromDashboard","getChartDataUri","path","qs","protocol","hostname","port","getExploreUrl","curUrl","requestParams","method","label_colors","extra_filters","adhoc_filters","csv","query","results","samples","paramNames","hasOwnProperty","shouldUseLegacyApi","vizMetadata","get","useLegacyApi","buildV1ChartDataPayload","resultFormat","resultType","setDataMask","ownState","buildQuery","buildQueryformData","baseQueryObject","result_format","result_type","hooks","getLegacyEndpointType","postForm","payload","target","hiddenForm","document","createElement","action","token","type","getElementById","appendChild","data","body","submit","removeChild","exportChart","exploreChart","useDebouncedEffect","effect","delay","deps","callback","handler","setTimeout","clearTimeout","getSimpleSQLExpression","subject","operator","comparator","isMulti","map","op","operation","indexOf","expression","firstValue","Array","isArray","comparatorArray","isString","Number","isNaN","quote","prefix","suffix","formattedComparators","val","String","replace","join"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useEffect } from 'react';\nimport { omit } from 'lodash';\n/* eslint camelcase: 0 */\nimport URI from 'urijs';\nimport {\n  buildQueryContext,\n  ensureIsArray,\n  getChartBuildQueryRegistry,\n  getChartMetadataRegistry,\n} from '@superset-ui/core';\nimport { availableDomains } from 'src/utils/hostNamesConfig';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { URL_PARAMS } from 'src/constants';\nimport {\n  MULTI_OPERATORS,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport { DashboardStandaloneMode } from 'src/dashboard/util/constants';\n\nconst MAX_URL_LENGTH = 8000;\n\nexport function getChartKey(explore) {\n  const { slice } = explore;\n  return slice ? slice.slice_id : 0;\n}\n\nlet requestCounter = 0;\nexport function getHostName(allowDomainSharding = false) {\n  let currentIndex = 0;\n  if (allowDomainSharding) {\n    currentIndex = requestCounter % availableDomains.length;\n    requestCounter += 1;\n\n    // if domain sharding is enabled, skip main domain for fetching chart API\n    // leave main domain free for other calls like fav star, save change, etc.\n    // to make dashboard be responsive when it's loading large number of charts\n    if (currentIndex === 0) {\n      currentIndex += 1;\n      requestCounter += 1;\n    }\n  }\n  return availableDomains[currentIndex];\n}\n\nexport function getAnnotationJsonUrl(slice_id, form_data, isNative, force) {\n  if (slice_id === null || slice_id === undefined) {\n    return null;\n  }\n  const uri = URI(window.location.search);\n  const endpoint = isNative ? 'annotation_json' : 'slice_json';\n  return uri\n    .pathname(`/superset/${endpoint}/${slice_id}`)\n    .search({\n      form_data: safeStringify(form_data, (key, value) =>\n        value === null ? undefined : value,\n      ),\n      force,\n    })\n    .toString();\n}\n\nexport function getURIDirectory(endpointType = 'base') {\n  // Building the directory part of the URI\n  if (\n    ['full', 'json', 'csv', 'query', 'results', 'samples'].includes(\n      endpointType,\n    )\n  ) {\n    return '/superset/explore_json/';\n  }\n  return '/superset/explore/';\n}\n\n/**\n * This gets the url of the explore page, with all the form data included explicitly.\n * This includes any form data overrides from the dashboard.\n */\nexport function getExploreLongUrl(\n  formData,\n  endpointType,\n  allowOverflow = true,\n  extraSearch = {},\n) {\n  if (!formData.datasource) {\n    return null;\n  }\n\n  // remove formData params that we don't need in the explore url.\n  // These are present when generating explore urls from the dashboard page.\n  // This should be superseded by some sort of \"exploration context\" system\n  // where form data and other context is referenced by id.\n  const trimmedFormData = omit(formData, ['dataMask', 'url_params']);\n\n  const uri = new URI('/');\n  const directory = getURIDirectory(endpointType);\n  const search = uri.search(true);\n  Object.keys(extraSearch).forEach(key => {\n    search[key] = extraSearch[key];\n  });\n  search.form_data = safeStringify(trimmedFormData);\n  if (endpointType === URL_PARAMS.standalone.name) {\n    search.standalone = DashboardStandaloneMode.HIDE_NAV;\n  }\n  const url = uri.directory(directory).search(search).toString();\n  if (!allowOverflow && url.length > MAX_URL_LENGTH) {\n    const minimalFormData = {\n      datasource: formData.datasource,\n      viz_type: formData.viz_type,\n    };\n    return getExploreLongUrl(minimalFormData, endpointType, false, {\n      URL_IS_TOO_LONG_TO_SHARE: null,\n    });\n  }\n  return url;\n}\n\nexport function getExploreUrlFromDashboard(formData) {\n  // remove formData params that we don't need in the explore url.\n  // These are present when generating explore urls from the dashboard page.\n  // This should be superseded by some sort of \"exploration context\" system\n  // where form data and other context is referenced by id.\n  const trimmedFormData = omit(formData, [\n    'dataMask',\n    'url_params',\n    'label_colors',\n  ]);\n  return getExploreLongUrl(trimmedFormData, null, false);\n}\n\nexport function getChartDataUri({ path, qs, allowDomainSharding = false }) {\n  // The search params from the window.location are carried through,\n  // but can be specified with curUrl (used for unit tests to spoof\n  // the window.location).\n  let uri = new URI({\n    protocol: window.location.protocol.slice(0, -1),\n    hostname: getHostName(allowDomainSharding),\n    port: window.location.port ? window.location.port : '',\n    path,\n  });\n  if (qs) {\n    uri = uri.search(qs);\n  }\n  return uri;\n}\n\n/**\n * This gets the minimal url for the given form data.\n * If there are dashboard overrides present in the form data,\n * they will not be included in the url.\n */\nexport function getExploreUrl({\n  formData,\n  endpointType = 'base',\n  force = false,\n  curUrl = null,\n  requestParams = {},\n  allowDomainSharding = false,\n  method = 'POST',\n}) {\n  if (!formData.datasource) {\n    return null;\n  }\n\n  // label_colors should not pollute the URL\n  // eslint-disable-next-line no-param-reassign\n  delete formData.label_colors;\n\n  let uri = getChartDataUri({ path: '/', allowDomainSharding });\n  if (curUrl) {\n    uri = URI(URI(curUrl).search());\n  }\n\n  const directory = getURIDirectory(endpointType);\n\n  // Building the querystring (search) part of the URI\n  const search = uri.search(true);\n  const { slice_id, extra_filters, adhoc_filters, viz_type } = formData;\n  if (slice_id) {\n    const form_data = { slice_id };\n    if (method === 'GET') {\n      form_data.viz_type = viz_type;\n      if (extra_filters && extra_filters.length) {\n        form_data.extra_filters = extra_filters;\n      }\n      if (adhoc_filters && adhoc_filters.length) {\n        form_data.adhoc_filters = adhoc_filters;\n      }\n    }\n    search.form_data = safeStringify(form_data);\n  }\n  if (force) {\n    search.force = 'true';\n  }\n  if (endpointType === 'csv') {\n    search.csv = 'true';\n  }\n  if (endpointType === URL_PARAMS.standalone.name) {\n    search.standalone = '1';\n  }\n  if (endpointType === 'query') {\n    search.query = 'true';\n  }\n  if (endpointType === 'results') {\n    search.results = 'true';\n  }\n  if (endpointType === 'samples') {\n    search.samples = 'true';\n  }\n  const paramNames = Object.keys(requestParams);\n  if (paramNames.length) {\n    paramNames.forEach(name => {\n      if (requestParams.hasOwnProperty(name)) {\n        search[name] = requestParams[name];\n      }\n    });\n  }\n  return uri.search(search).directory(directory).toString();\n}\n\nexport const shouldUseLegacyApi = formData => {\n  const vizMetadata = getChartMetadataRegistry().get(formData.viz_type);\n  return vizMetadata ? vizMetadata.useLegacyApi : false;\n};\n\nexport const buildV1ChartDataPayload = ({\n  formData,\n  force,\n  resultFormat,\n  resultType,\n  setDataMask,\n  ownState,\n}) => {\n  const buildQuery =\n    getChartBuildQueryRegistry().get(formData.viz_type) ??\n    (buildQueryformData =>\n      buildQueryContext(buildQueryformData, baseQueryObject => [\n        {\n          ...baseQueryObject,\n        },\n      ]));\n  return buildQuery(\n    {\n      ...formData,\n      force,\n      result_format: resultFormat,\n      result_type: resultType,\n    },\n    {\n      ownState,\n      hooks: {\n        setDataMask,\n      },\n    },\n  );\n};\n\nexport const getLegacyEndpointType = ({ resultType, resultFormat }) =>\n  resultFormat === 'csv' ? resultFormat : resultType;\n\nexport function postForm(url, payload, target = '_blank') {\n  if (!url) {\n    return;\n  }\n\n  const hiddenForm = document.createElement('form');\n  hiddenForm.action = url;\n  hiddenForm.method = 'POST';\n  hiddenForm.target = target;\n  const token = document.createElement('input');\n  token.type = 'hidden';\n  token.name = 'csrf_token';\n  token.value = (document.getElementById('csrf_token') || {}).value;\n  hiddenForm.appendChild(token);\n  const data = document.createElement('input');\n  data.type = 'hidden';\n  data.name = 'form_data';\n  data.value = safeStringify(payload);\n  hiddenForm.appendChild(data);\n\n  document.body.appendChild(hiddenForm);\n  hiddenForm.submit();\n  document.body.removeChild(hiddenForm);\n}\n\nexport const exportChart = ({\n  formData,\n  resultFormat = 'json',\n  resultType = 'full',\n  force = false,\n  ownState = {},\n}) => {\n  let url;\n  let payload;\n  if (shouldUseLegacyApi(formData)) {\n    const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n    url = getExploreUrl({\n      formData,\n      endpointType,\n      allowDomainSharding: false,\n    });\n    payload = formData;\n  } else {\n    url = '/api/v1/chart/data';\n    payload = buildV1ChartDataPayload({\n      formData,\n      force,\n      resultFormat,\n      resultType,\n      ownState,\n    });\n  }\n  postForm(url, payload);\n};\n\nexport const exploreChart = formData => {\n  const url = getExploreUrl({\n    formData,\n    endpointType: 'base',\n    allowDomainSharding: false,\n  });\n  postForm(url, formData);\n};\n\nexport const useDebouncedEffect = (effect, delay, deps) => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const callback = useCallback(effect, deps);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      callback();\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [callback, delay]);\n};\n\nexport const getSimpleSQLExpression = (subject, operator, comparator) => {\n  const isMulti =\n    [...MULTI_OPERATORS]\n      .map(op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation)\n      .indexOf(operator) >= 0;\n  let expression = subject ?? '';\n  if (subject && operator) {\n    expression += ` ${operator}`;\n    const firstValue =\n      isMulti && Array.isArray(comparator) ? comparator[0] : comparator;\n    const comparatorArray = ensureIsArray(comparator);\n    const isString =\n      firstValue !== undefined && Number.isNaN(Number(firstValue));\n    const quote = isString ? \"'\" : '';\n    const [prefix, suffix] = isMulti ? ['(', ')'] : ['', ''];\n    const formattedComparators = comparatorArray.map(\n      val =>\n        `${quote}${isString ? String(val).replace(\"'\", \"''\") : val}${quote}`,\n    );\n    if (comparatorArray.length > 0) {\n      expression += ` ${prefix}${formattedComparators.join(', ')}${suffix}`;\n    }\n  }\n  return expression;\n};\n"]},"metadata":{},"sourceType":"module"}