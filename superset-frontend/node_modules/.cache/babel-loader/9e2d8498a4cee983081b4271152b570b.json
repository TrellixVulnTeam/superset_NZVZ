{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter, {\nEXPRESSION_TYPES,\nCLAUSES } from\n'src/explore/components/controls/FilterControl/AdhocFilter';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n  PropTypes.oneOfType([\n  columnType,\n  PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n  adhocMetricType])).\n\n  isRequired,\n  height: PropTypes.number.isRequired,\n  activeKey: PropTypes.string.isRequired };\n\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange = this.onSqlExpressionClauseChange.bind(\n    this);\n\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n\n    this.selectProps = {\n      ariaLabel: t('Select column') };\n\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n    this.props.adhocFilter.duplicateWith({\n      clause,\n      expressionType: EXPRESSION_TYPES.SQL }));\n\n\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n    this.props.adhocFilter.duplicateWith({\n      sqlExpression,\n      expressionType: EXPRESSION_TYPES.SQL }));\n\n\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const clauseSelectProps = {\n      placeholder: t('choose WHERE or HAVING...'),\n      value: adhocFilter.clause,\n      onChange: this.onSqlExpressionClauseChange };\n\n    const keywords = sqlKeywords.concat(\n    options.\n    map((option) => {\n      if (option.column_name) {\n        return {\n          name: option.column_name,\n          value: option.column_name,\n          score: 50,\n          meta: 'option' };\n\n      }\n      return null;\n    }).\n    filter(Boolean));\n\n    const selectOptions = Object.keys(CLAUSES).map((clause) => ({\n      label: clause,\n      value: clause }));\n\n\n    return (\n      ___EmotionJSX(\"span\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 127, columnNumber: 7 } },\n      ___EmotionJSX(\"div\", { className: \"filter-edit-clause-section\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 128, columnNumber: 9 } },\n      ___EmotionJSX(StyledSelect, _extends({\n        options: selectOptions },\n      this.selectProps,\n      clauseSelectProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 129, columnNumber: 11 } })),\n\n      ___EmotionJSX(\"span\", { className: \"filter-edit-clause-info\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 134, columnNumber: 11 } },\n      ___EmotionJSX(\"strong\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 135, columnNumber: 13 } }, \"WHERE\"), \" \", t('Filters by columns'),\n      ___EmotionJSX(\"br\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 136, columnNumber: 13 } }),\n      ___EmotionJSX(\"strong\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 137, columnNumber: 13 } }, \"HAVING\"), \" \", t('Filters by metrics'))),\n\n\n      ___EmotionJSX(\"div\", { css: (theme) => ({ marginTop: theme.gridUnit * 4 }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 140, columnNumber: 9 } },\n      ___EmotionJSX(SQLEditor, {\n        ref: this.handleAceEditorRef,\n        keywords: keywords,\n        height: `${height - 130}px`,\n        onChange: this.onSqlExpressionChange,\n        width: \"100%\",\n        showGutter: false,\n        value: adhocFilter.sqlExpression || adhocFilter.translateToSql(),\n        editorProps: { $blockScrolling: true },\n        enableLiveAutocompletion: true,\n        className: \"filter-sql-editor\",\n        wrapEnabled: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 141, columnNumber: 11 } }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}AdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");reactHotLoader.register(StyledSelect, \"StyledSelect\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");reactHotLoader.register(AdhocFilterEditPopoverSqlTabContent, \"AdhocFilterEditPopoverSqlTabContent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx"],"names":["React","PropTypes","Select","styled","t","SQLEditor","sqlKeywords","adhocMetricType","columnType","AdhocFilter","EXPRESSION_TYPES","CLAUSES","propTypes","adhocFilter","instanceOf","isRequired","onChange","func","options","arrayOf","oneOfType","shape","saved_metric_name","string","height","number","activeKey","StyledSelect","theme","gridUnit","AdhocFilterEditPopoverSqlTabContent","Component","constructor","props","onSqlExpressionChange","bind","onSqlExpressionClauseChange","handleAceEditorRef","selectProps","ariaLabel","componentDidUpdate","aceEditorRef","editor","resize","clause","duplicateWith","expressionType","SQL","sqlExpression","ref","render","clauseSelectProps","placeholder","value","keywords","concat","map","option","column_name","name","score","meta","filter","Boolean","selectOptions","Object","keys","label","marginTop","translateToSql","$blockScrolling"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n  CLAUSES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n  activeKey: PropTypes.string.isRequired,\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange = this.onSqlExpressionClauseChange.bind(\n      this,\n    );\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n\n    this.selectProps = {\n      ariaLabel: t('Select column'),\n    };\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const clauseSelectProps = {\n      placeholder: t('choose WHERE or HAVING...'),\n      value: adhocFilter.clause,\n      onChange: this.onSqlExpressionClauseChange,\n    };\n    const keywords = sqlKeywords.concat(\n      options\n        .map(option => {\n          if (option.column_name) {\n            return {\n              name: option.column_name,\n              value: option.column_name,\n              score: 50,\n              meta: 'option',\n            };\n          }\n          return null;\n        })\n        .filter(Boolean),\n    );\n    const selectOptions = Object.keys(CLAUSES).map(clause => ({\n      label: clause,\n      value: clause,\n    }));\n\n    return (\n      <span>\n        <div className=\"filter-edit-clause-section\">\n          <StyledSelect\n            options={selectOptions}\n            {...this.selectProps}\n            {...clauseSelectProps}\n          />\n          <span className=\"filter-edit-clause-info\">\n            <strong>WHERE</strong> {t('Filters by columns')}\n            <br />\n            <strong>HAVING</strong> {t('Filters by metrics')}\n          </span>\n        </div>\n        <div css={theme => ({ marginTop: theme.gridUnit * 4 })}>\n          <SQLEditor\n            ref={this.handleAceEditorRef}\n            keywords={keywords}\n            height={`${height - 130}px`}\n            onChange={this.onSqlExpressionChange}\n            width=\"100%\"\n            showGutter={false}\n            value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n          />\n        </div>\n      </span>\n    );\n  }\n}\nAdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;\n"]},"metadata":{},"sourceType":"module"}