{"ast":null,"code":"import _isEqual from \"lodash/isEqual\";import _snakeCase from \"lodash/snakeCase\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/ChartRenderer.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;};\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { SuperChart, logging, Behavior } from '@superset-ui/core';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from 'src/logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  initialValues: PropTypes.object,\n  formData: PropTypes.object.isRequired,\n  labelColors: PropTypes.object,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  setDataMask: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object };\n\n\nconst BLANK = {};\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false };\n\n\nclass ChartRenderer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.hasQueryResponseChange = false;\n\n    this.handleAddFilter = this.handleAddFilter.bind(this);\n    this.handleRenderSuccess = this.handleRenderSuccess.bind(this);\n    this.handleRenderFailure = this.handleRenderFailure.bind(this);\n    this.handleSetControlValue = this.handleSetControlValue.bind(this);\n\n    this.hooks = {\n      onAddFilter: this.handleAddFilter,\n      onError: this.handleRenderFailure,\n      setControlValue: this.handleSetControlValue,\n      onFilterMenuOpen: this.props.onFilterMenuOpen,\n      onFilterMenuClose: this.props.onFilterMenuClose,\n      setDataMask: (dataMask) => {var _this$props$actions;\n        (_this$props$actions = this.props.actions) == null ? void 0 : _this$props$actions.updateDataMask(this.props.chartId, dataMask);\n      } };\n\n  }\n\n  shouldComponentUpdate(nextProps) {var _nextProps$queriesRes, _nextProps$queriesRes2;\n    const resultsReady =\n    nextProps.queriesResponse &&\n    ['success', 'rendered'].indexOf(nextProps.chartStatus) > -1 &&\n    !((_nextProps$queriesRes = nextProps.queriesResponse) != null && (_nextProps$queriesRes2 = _nextProps$queriesRes[0]) != null && _nextProps$queriesRes2.error) &&\n    !nextProps.refreshOverlayVisible;\n\n    if (resultsReady) {\n      this.hasQueryResponseChange =\n      nextProps.queriesResponse !== this.props.queriesResponse;\n      return (\n        this.hasQueryResponseChange ||\n        !_isEqual(nextProps.datasource, this.props.datasource) ||\n        nextProps.annotationData !== this.props.annotationData ||\n        nextProps.ownState !== this.props.ownState ||\n        nextProps.filterState !== this.props.filterState ||\n        nextProps.height !== this.props.height ||\n        nextProps.width !== this.props.width ||\n        nextProps.triggerRender ||\n        nextProps.labelColors !== this.props.labelColors ||\n        nextProps.formData.color_scheme !== this.props.formData.color_scheme ||\n        nextProps.cacheBusterProp !== this.props.cacheBusterProp);\n\n    }\n    return false;\n  }\n\n  handleAddFilter(col, vals, merge = true, refresh = true) {\n    this.props.addFilter(col, vals, merge, refresh);\n  }\n\n  handleRenderSuccess() {\n    const { actions, chartStatus, chartId, vizType } = this.props;\n    if (['loading', 'rendered'].indexOf(chartStatus) < 0) {\n      actions.chartRenderingSucceeded(chartId);\n    }\n\n    // only log chart render time which is triggered by query results change\n    // currently we don't log chart re-render time, like window resize etc\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        viz_type: vizType,\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime });\n\n    }\n  }\n\n  handleRenderFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n    error.toString(),\n    chartId,\n    info ? info.componentStack : null);\n\n\n    // only trigger render log when query is changed\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        has_err: true,\n        error_details: error.toString(),\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime });\n\n    }\n  }\n\n  handleSetControlValue(...args) {\n    const { setControlValue } = this.props;\n    if (setControlValue) {\n      setControlValue(...args);\n    }\n  }\n\n  render() {\n    const {\n      chartAlert,\n      chartStatus,\n      vizType,\n      chartId,\n      refreshOverlayVisible } =\n    this.props;\n\n    // Skip chart rendering\n    if (\n    refreshOverlayVisible ||\n    chartStatus === 'loading' ||\n    !!chartAlert ||\n    chartStatus === null)\n    {\n      return null;\n    }\n\n    this.renderStartTime = Logger.getTimestamp();\n\n    const {\n      width,\n      height,\n      datasource,\n      annotationData,\n      initialValues,\n      ownState,\n      filterState,\n      formData,\n      queriesResponse } =\n    this.props;\n\n    // It's bad practice to use unprefixed `vizType` as classnames for chart\n    // container. It may cause css conflicts as in the case of legacy table chart.\n    // When migrating charts, we should gradually add a `superset-chart-` prefix\n    // to each one of them.\n    const snakeCaseVizType = _snakeCase(vizType);\n    const chartClassName =\n    vizType === 'table' ?\n    `superset-chart-${snakeCaseVizType}` :\n    snakeCaseVizType;\n\n    const webpackHash =\n    process.env.WEBPACK_MODE === 'development' ?\n    `-${\n    // eslint-disable-next-line camelcase\n    typeof __webpack_require__ !== 'undefined' &&\n    // eslint-disable-next-line camelcase, no-undef\n    typeof __webpack_require__.h === 'function' &&\n    // eslint-disable-next-line no-undef\n    __webpack_require__.h()\n    }` :\n    '';\n\n    return (\n      ___EmotionJSX(SuperChart, {\n        disableErrorBoundary: true,\n        key: `${chartId}${webpackHash}`,\n        id: `chart-id-${chartId}`,\n        className: chartClassName,\n        chartType: vizType,\n        width: width,\n        height: height,\n        annotationData: annotationData,\n        datasource: datasource,\n        initialValues: initialValues,\n        formData: formData,\n        ownState: ownState,\n        filterState: filterState,\n        hooks: this.hooks,\n        behaviors: [Behavior.INTERACTIVE_CHART],\n        queriesData: queriesResponse,\n        onRenderSuccess: this.handleRenderSuccess,\n        onRenderFailure: this.handleRenderFailure, __self: this, __source: { fileName: _jsxFileName, lineNumber: 220, columnNumber: 7 } }));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nChartRenderer.propTypes = propTypes;\nChartRenderer.defaultProps = defaultProps;const _default =\n\nChartRenderer;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(BLANK, \"BLANK\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(ChartRenderer, \"ChartRenderer\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/ChartRenderer.jsx\");reactHotLoader.register(_default, \"default\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/ChartRenderer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/ChartRenderer.jsx"],"names":["PropTypes","React","SuperChart","logging","Behavior","Logger","LOG_ACTIONS_RENDER_CHART","propTypes","annotationData","object","actions","chartId","number","isRequired","datasource","initialValues","formData","labelColors","height","width","setControlValue","func","vizType","string","triggerRender","bool","chartAlert","chartStatus","queriesResponse","arrayOf","triggerQuery","refreshOverlayVisible","addFilter","setDataMask","onFilterMenuOpen","onFilterMenuClose","ownState","BLANK","defaultProps","ChartRenderer","Component","constructor","props","hasQueryResponseChange","handleAddFilter","bind","handleRenderSuccess","handleRenderFailure","handleSetControlValue","hooks","onAddFilter","onError","dataMask","updateDataMask","shouldComponentUpdate","nextProps","resultsReady","indexOf","error","filterState","color_scheme","cacheBusterProp","col","vals","merge","refresh","chartRenderingSucceeded","logEvent","slice_id","viz_type","start_offset","renderStartTime","ts","Date","getTime","duration","getTimestamp","info","warn","chartRenderingFailed","toString","componentStack","has_err","error_details","args","render","snakeCaseVizType","chartClassName","webpackHash","process","env","WEBPACK_MODE","__webpack_require__","h","INTERACTIVE_CHART"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { snakeCase, isEqual } from 'lodash';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { SuperChart, logging, Behavior } from '@superset-ui/core';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from 'src/logger/LogUtils';\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  initialValues: PropTypes.object,\n  formData: PropTypes.object.isRequired,\n  labelColors: PropTypes.object,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  setDataMask: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object,\n};\n\nconst BLANK = {};\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n};\n\nclass ChartRenderer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.hasQueryResponseChange = false;\n\n    this.handleAddFilter = this.handleAddFilter.bind(this);\n    this.handleRenderSuccess = this.handleRenderSuccess.bind(this);\n    this.handleRenderFailure = this.handleRenderFailure.bind(this);\n    this.handleSetControlValue = this.handleSetControlValue.bind(this);\n\n    this.hooks = {\n      onAddFilter: this.handleAddFilter,\n      onError: this.handleRenderFailure,\n      setControlValue: this.handleSetControlValue,\n      onFilterMenuOpen: this.props.onFilterMenuOpen,\n      onFilterMenuClose: this.props.onFilterMenuClose,\n      setDataMask: dataMask => {\n        this.props.actions?.updateDataMask(this.props.chartId, dataMask);\n      },\n    };\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const resultsReady =\n      nextProps.queriesResponse &&\n      ['success', 'rendered'].indexOf(nextProps.chartStatus) > -1 &&\n      !nextProps.queriesResponse?.[0]?.error &&\n      !nextProps.refreshOverlayVisible;\n\n    if (resultsReady) {\n      this.hasQueryResponseChange =\n        nextProps.queriesResponse !== this.props.queriesResponse;\n      return (\n        this.hasQueryResponseChange ||\n        !isEqual(nextProps.datasource, this.props.datasource) ||\n        nextProps.annotationData !== this.props.annotationData ||\n        nextProps.ownState !== this.props.ownState ||\n        nextProps.filterState !== this.props.filterState ||\n        nextProps.height !== this.props.height ||\n        nextProps.width !== this.props.width ||\n        nextProps.triggerRender ||\n        nextProps.labelColors !== this.props.labelColors ||\n        nextProps.formData.color_scheme !== this.props.formData.color_scheme ||\n        nextProps.cacheBusterProp !== this.props.cacheBusterProp\n      );\n    }\n    return false;\n  }\n\n  handleAddFilter(col, vals, merge = true, refresh = true) {\n    this.props.addFilter(col, vals, merge, refresh);\n  }\n\n  handleRenderSuccess() {\n    const { actions, chartStatus, chartId, vizType } = this.props;\n    if (['loading', 'rendered'].indexOf(chartStatus) < 0) {\n      actions.chartRenderingSucceeded(chartId);\n    }\n\n    // only log chart render time which is triggered by query results change\n    // currently we don't log chart re-render time, like window resize etc\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        viz_type: vizType,\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime,\n      });\n    }\n  }\n\n  handleRenderFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n      error.toString(),\n      chartId,\n      info ? info.componentStack : null,\n    );\n\n    // only trigger render log when query is changed\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        has_err: true,\n        error_details: error.toString(),\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime,\n      });\n    }\n  }\n\n  handleSetControlValue(...args) {\n    const { setControlValue } = this.props;\n    if (setControlValue) {\n      setControlValue(...args);\n    }\n  }\n\n  render() {\n    const {\n      chartAlert,\n      chartStatus,\n      vizType,\n      chartId,\n      refreshOverlayVisible,\n    } = this.props;\n\n    // Skip chart rendering\n    if (\n      refreshOverlayVisible ||\n      chartStatus === 'loading' ||\n      !!chartAlert ||\n      chartStatus === null\n    ) {\n      return null;\n    }\n\n    this.renderStartTime = Logger.getTimestamp();\n\n    const {\n      width,\n      height,\n      datasource,\n      annotationData,\n      initialValues,\n      ownState,\n      filterState,\n      formData,\n      queriesResponse,\n    } = this.props;\n\n    // It's bad practice to use unprefixed `vizType` as classnames for chart\n    // container. It may cause css conflicts as in the case of legacy table chart.\n    // When migrating charts, we should gradually add a `superset-chart-` prefix\n    // to each one of them.\n    const snakeCaseVizType = snakeCase(vizType);\n    const chartClassName =\n      vizType === 'table'\n        ? `superset-chart-${snakeCaseVizType}`\n        : snakeCaseVizType;\n\n    const webpackHash =\n      process.env.WEBPACK_MODE === 'development'\n        ? `-${\n            // eslint-disable-next-line camelcase\n            typeof __webpack_require__ !== 'undefined' &&\n            // eslint-disable-next-line camelcase, no-undef\n            typeof __webpack_require__.h === 'function' &&\n            // eslint-disable-next-line no-undef\n            __webpack_require__.h()\n          }`\n        : '';\n\n    return (\n      <SuperChart\n        disableErrorBoundary\n        key={`${chartId}${webpackHash}`}\n        id={`chart-id-${chartId}`}\n        className={chartClassName}\n        chartType={vizType}\n        width={width}\n        height={height}\n        annotationData={annotationData}\n        datasource={datasource}\n        initialValues={initialValues}\n        formData={formData}\n        ownState={ownState}\n        filterState={filterState}\n        hooks={this.hooks}\n        behaviors={[Behavior.INTERACTIVE_CHART]}\n        queriesData={queriesResponse}\n        onRenderSuccess={this.handleRenderSuccess}\n        onRenderFailure={this.handleRenderFailure}\n      />\n    );\n  }\n}\n\nChartRenderer.propTypes = propTypes;\nChartRenderer.defaultProps = defaultProps;\n\nexport default ChartRenderer;\n"]},"metadata":{},"sourceType":"module"}