{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Select } from 'src/components';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nfunction isLabeledValue(arg) {\n  return arg.value !== undefined;\n}\nconst SelectAsyncControl = ({ addDangerToast, allowClear = true, ariaLabel, dataEndpoint, multi = true, mutator, onChange, placeholder, value, ...props }) => {\n  const [options, setOptions] = useState([]);\n  const handleOnChange = (val) => {\n    let onChangeVal = val;\n    if (Array.isArray(val)) {\n      const values = val.map((v) => isLabeledValue(v) ? v.value : v);\n      onChangeVal = values;\n    }\n    if (isLabeledValue(val)) {\n      onChangeVal = val.value;\n    }\n    onChange(onChangeVal);\n  };\n  const getValue = () => {\n    const currentValue = value || (props.default !== undefined ? props.default : undefined);\n    // safety check - the value is intended to be undefined but null was used\n    if (currentValue === null && !options.find((o) => o.value === null)) {\n      return undefined;\n    }\n    return currentValue;\n  };\n  useEffect(() => {\n    const onError = (response) => getClientErrorObject(response).then((e) => {\n      const { error } = e;\n      addDangerToast(`${t('Error while fetching data')}: ${error}`);\n    });\n    const loadOptions = () => SupersetClient.get({\n      endpoint: dataEndpoint }).\n\n    then((response) => {\n      const data = mutator ? mutator(response.json) : response.json.result;\n      setOptions(data);\n    }).\n    catch(onError);\n    loadOptions();\n  }, [addDangerToast, dataEndpoint, mutator]);\n  return ___EmotionJSX(Select, { allowClear: allowClear, ariaLabel: ariaLabel || t('Select ...'), value: getValue(), header: ___EmotionJSX(ControlHeader, _extends({}, props, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 64, columnNumber: 113 } })), mode: multi ? 'multiple' : 'single', onChange: handleOnChange, options: options, placeholder: placeholder, __self: this, __source: { fileName: _jsxFileName, lineNumber: 64, columnNumber: 13 } });\n};__signature__(SelectAsyncControl, \"useState{[options, setOptions]([])}\\nuseEffect{}\");const _default =\nwithToasts(SelectAsyncControl);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(isLabeledValue, \"isLabeledValue\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx\");reactHotLoader.register(SelectAsyncControl, \"SelectAsyncControl\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx\");reactHotLoader.register(_default, \"default\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectAsyncControl/index.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Select } from 'src/components';\nimport { SelectProps, OptionsType } from 'src/components/Select/Select';\nimport { SelectValue, LabeledValue } from 'antd/lib/select';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\n\ntype SelectAsyncProps = Omit<SelectProps, 'options' | 'ariaLabel' | 'onChange'>;\n\ninterface SelectAsyncControlProps extends SelectAsyncProps {\n  addDangerToast: (error: string) => void;\n  ariaLabel?: string;\n  dataEndpoint: string;\n  default?: SelectValue;\n  mutator?: (response: Record<string, any>) => OptionsType;\n  multi?: boolean;\n  onChange: (val: SelectValue) => void;\n  // ControlHeader related props\n  description?: string;\n  hovered?: boolean;\n  label?: string;\n}\n\nfunction isLabeledValue(arg: any): arg is LabeledValue {\n  return arg.value !== undefined;\n}\n\nconst SelectAsyncControl = ({\n  addDangerToast,\n  allowClear = true,\n  ariaLabel,\n  dataEndpoint,\n  multi = true,\n  mutator,\n  onChange,\n  placeholder,\n  value,\n  ...props\n}: SelectAsyncControlProps) => {\n  const [options, setOptions] = useState<OptionsType>([]);\n\n  const handleOnChange = (val: SelectValue) => {\n    let onChangeVal = val;\n    if (Array.isArray(val)) {\n      const values = val.map(v => (isLabeledValue(v) ? v.value : v));\n      onChangeVal = values;\n    }\n    if (isLabeledValue(val)) {\n      onChangeVal = val.value;\n    }\n    onChange(onChangeVal);\n  };\n\n  const getValue = () => {\n    const currentValue =\n      value || (props.default !== undefined ? props.default : undefined);\n\n    // safety check - the value is intended to be undefined but null was used\n    if (currentValue === null && !options.find(o => o.value === null)) {\n      return undefined;\n    }\n    return currentValue;\n  };\n\n  useEffect(() => {\n    const onError = (response: Response) =>\n      getClientErrorObject(response).then(e => {\n        const { error } = e;\n        addDangerToast(`${t('Error while fetching data')}: ${error}`);\n      });\n    const loadOptions = () =>\n      SupersetClient.get({\n        endpoint: dataEndpoint,\n      })\n        .then(response => {\n          const data = mutator ? mutator(response.json) : response.json.result;\n          setOptions(data);\n        })\n        .catch(onError);\n    loadOptions();\n  }, [addDangerToast, dataEndpoint, mutator]);\n\n  return (\n    <Select\n      allowClear={allowClear}\n      ariaLabel={ariaLabel || t('Select ...')}\n      value={getValue()}\n      header={<ControlHeader {...props} />}\n      mode={multi ? 'multiple' : 'single'}\n      onChange={handleOnChange}\n      options={options}\n      placeholder={placeholder}\n    />\n  );\n};\n\nexport default withToasts(SelectAsyncControl);\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}