{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState } from 'react';\nimport { styled, t } from '@superset-ui/core';\nimport { css } from '@emotion/react';\nimport * as portals from 'react-reverse-portal';\nimport { Collapse } from 'src/common/components';\nimport CascadePopover from '../CascadeFilters/CascadePopover';\nimport { buildCascadeFiltersTree } from './utils';\nimport { useFilters } from '../state';\nimport { useDashboardHasTabs, useSelectFiltersInScope } from '../../state';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst Wrapper = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  &:hover {\n    cursor: pointer;\n  }\n`;\nconst FilterControls = ({ directPathToChild, dataMaskSelected, onFilterSelectionChange }) => {\n  const [visiblePopoverId, setVisiblePopoverId] = useState(null);\n  const filters = useFilters();\n  const filterValues = Object.values(filters);\n  const portalNodes = React.useMemo(() => {\n    const nodes = new Array(filterValues.length);\n    for (let i = 0; i < filterValues.length; i += 1) {\n      nodes[i] = portals.createHtmlPortalNode();\n    }\n    return nodes;\n  }, [filterValues.length]);\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = filterValues.map((filter) => ({\n      ...filter,\n      dataMask: dataMaskSelected[filter.id] }));\n\n    return buildCascadeFiltersTree(filtersWithValue);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [JSON.stringify(filterValues), dataMaskSelected]);\n  const cascadeFilterIds = new Set(cascadeFilters.map((item) => item.id));\n  const [filtersInScope, filtersOutOfScope] = useSelectFiltersInScope(cascadeFilters);\n  const dashboardHasTabs = useDashboardHasTabs();\n  const showCollapsePanel = dashboardHasTabs && cascadeFilters.length > 0;\n  return ___EmotionJSX(Wrapper, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 57, columnNumber: 13 } },\n  portalNodes.\n  filter((node, index) => cascadeFilterIds.has(filterValues[index].id)).\n  map((node, index) => ___EmotionJSX(portals.InPortal, { node: node, __self: this, __source: { fileName: _jsxFileName, lineNumber: 60, columnNumber: 36 } },\n  ___EmotionJSX(CascadePopover, { \"data-test\": \"cascade-filters-control\", key: cascadeFilters[index].id, dataMaskSelected: dataMaskSelected, visible: visiblePopoverId === cascadeFilters[index].id, onVisibleChange: (visible) => setVisiblePopoverId(visible ? cascadeFilters[index].id : null), filter: cascadeFilters[index], onFilterSelectionChange: onFilterSelectionChange, directPathToChild: directPathToChild, inView: false, __self: this, __source: { fileName: _jsxFileName, lineNumber: 61, columnNumber: 13 } }))),\n\n  filtersInScope.map((filter) => {\n    const index = filterValues.findIndex((f) => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 65, columnNumber: 20 } });\n  }),\n  showCollapsePanel && ___EmotionJSX(Collapse, { ghost: true, bordered: true, expandIconPosition: \"right\", collapsible: filtersOutOfScope.length === 0 ? 'disabled' : undefined, css: (theme) => /*#__PURE__*/css(\"&.ant-collapse{margin-top:\",\n\n    filtersInScope.length > 0 ?\n    theme.gridUnit * 6 :\n    0, \"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:\",\n\n\n\n    theme.gridUnit * 2, \"px;&>.ant-collapse-arrow{right:\",\n\n\n    theme.gridUnit, \"px;}}& .ant-collapse-content-box{padding:\",\n\n\n\n\n    theme.gridUnit * 4, \"px 0 0;}}}\" + (process.env.NODE_ENV === \"production\" ? \"\" : \";label:FilterControls;\"), process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3VidW50dS9teV9wbHVnaW4vc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL25hdGl2ZUZpbHRlcnMvRmlsdGVyQmFyL0ZpbHRlckNvbnRyb2xzL0ZpbHRlckNvbnRyb2xzLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFrRXlLIiwiZmlsZSI6Ii9ob21lL3VidW50dS9teV9wbHVnaW4vc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL25hdGl2ZUZpbHRlcnMvRmlsdGVyQmFyL0ZpbHRlckNvbnRyb2xzL0ZpbHRlckNvbnRyb2xzLnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCwgeyB1c2VNZW1vLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHN0eWxlZCwgdCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCB7IGNzcyB9IGZyb20gJ0BlbW90aW9uL3JlYWN0JztcbmltcG9ydCAqIGFzIHBvcnRhbHMgZnJvbSAncmVhY3QtcmV2ZXJzZS1wb3J0YWwnO1xuaW1wb3J0IHsgQ29sbGFwc2UgfSBmcm9tICdzcmMvY29tbW9uL2NvbXBvbmVudHMnO1xuaW1wb3J0IENhc2NhZGVQb3BvdmVyIGZyb20gJy4uL0Nhc2NhZGVGaWx0ZXJzL0Nhc2NhZGVQb3BvdmVyJztcbmltcG9ydCB7IGJ1aWxkQ2FzY2FkZUZpbHRlcnNUcmVlIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgeyB1c2VGaWx0ZXJzIH0gZnJvbSAnLi4vc3RhdGUnO1xuaW1wb3J0IHsgdXNlRGFzaGJvYXJkSGFzVGFicywgdXNlU2VsZWN0RmlsdGVyc0luU2NvcGUgfSBmcm9tICcuLi8uLi9zdGF0ZSc7XG5jb25zdCBXcmFwcGVyID0gc3R5bGVkLmRpdiBgXG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiA0fXB4O1xuICAmOmhvdmVyIHtcbiAgICBjdXJzb3I6IHBvaW50ZXI7XG4gIH1cbmA7XG5jb25zdCBGaWx0ZXJDb250cm9scyA9ICh7IGRpcmVjdFBhdGhUb0NoaWxkLCBkYXRhTWFza1NlbGVjdGVkLCBvbkZpbHRlclNlbGVjdGlvbkNoYW5nZSwgfSkgPT4ge1xuICAgIGNvbnN0IFt2aXNpYmxlUG9wb3ZlcklkLCBzZXRWaXNpYmxlUG9wb3ZlcklkXSA9IHVzZVN0YXRlKG51bGwpO1xuICAgIGNvbnN0IGZpbHRlcnMgPSB1c2VGaWx0ZXJzKCk7XG4gICAgY29uc3QgZmlsdGVyVmFsdWVzID0gT2JqZWN0LnZhbHVlcyhmaWx0ZXJzKTtcbiAgICBjb25zdCBwb3J0YWxOb2RlcyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgICAgICBjb25zdCBub2RlcyA9IG5ldyBBcnJheShmaWx0ZXJWYWx1ZXMubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWx0ZXJWYWx1ZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgICAgIG5vZGVzW2ldID0gcG9ydGFscy5jcmVhdGVIdG1sUG9ydGFsTm9kZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlcztcbiAgICB9LCBbZmlsdGVyVmFsdWVzLmxlbmd0aF0pO1xuICAgIGNvbnN0IGNhc2NhZGVGaWx0ZXJzID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICAgIGNvbnN0IGZpbHRlcnNXaXRoVmFsdWUgPSBmaWx0ZXJWYWx1ZXMubWFwKGZpbHRlciA9PiAoe1xuICAgICAgICAgICAgLi4uZmlsdGVyLFxuICAgICAgICAgICAgZGF0YU1hc2s6IGRhdGFNYXNrU2VsZWN0ZWRbZmlsdGVyLmlkXSxcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gYnVpbGRDYXNjYWRlRmlsdGVyc1RyZWUoZmlsdGVyc1dpdGhWYWx1ZSk7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHNcbiAgICB9LCBbSlNPTi5zdHJpbmdpZnkoZmlsdGVyVmFsdWVzKSwgZGF0YU1hc2tTZWxlY3RlZF0pO1xuICAgIGNvbnN0IGNhc2NhZGVGaWx0ZXJJZHMgPSBuZXcgU2V0KGNhc2NhZGVGaWx0ZXJzLm1hcChpdGVtID0+IGl0ZW0uaWQpKTtcbiAgICBjb25zdCBbZmlsdGVyc0luU2NvcGUsIGZpbHRlcnNPdXRPZlNjb3BlXSA9IHVzZVNlbGVjdEZpbHRlcnNJblNjb3BlKGNhc2NhZGVGaWx0ZXJzKTtcbiAgICBjb25zdCBkYXNoYm9hcmRIYXNUYWJzID0gdXNlRGFzaGJvYXJkSGFzVGFicygpO1xuICAgIGNvbnN0IHNob3dDb2xsYXBzZVBhbmVsID0gZGFzaGJvYXJkSGFzVGFicyAmJiBjYXNjYWRlRmlsdGVycy5sZW5ndGggPiAwO1xuICAgIHJldHVybiAoPFdyYXBwZXI+XG4gICAgICB7cG9ydGFsTm9kZXNcbiAgICAgICAgICAgIC5maWx0ZXIoKG5vZGUsIGluZGV4KSA9PiBjYXNjYWRlRmlsdGVySWRzLmhhcyhmaWx0ZXJWYWx1ZXNbaW5kZXhdLmlkKSlcbiAgICAgICAgICAgIC5tYXAoKG5vZGUsIGluZGV4KSA9PiAoPHBvcnRhbHMuSW5Qb3J0YWwgbm9kZT17bm9kZX0+XG4gICAgICAgICAgICA8Q2FzY2FkZVBvcG92ZXIgZGF0YS10ZXN0PVwiY2FzY2FkZS1maWx0ZXJzLWNvbnRyb2xcIiBrZXk9e2Nhc2NhZGVGaWx0ZXJzW2luZGV4XS5pZH0gZGF0YU1hc2tTZWxlY3RlZD17ZGF0YU1hc2tTZWxlY3RlZH0gdmlzaWJsZT17dmlzaWJsZVBvcG92ZXJJZCA9PT0gY2FzY2FkZUZpbHRlcnNbaW5kZXhdLmlkfSBvblZpc2libGVDaGFuZ2U9e3Zpc2libGUgPT4gc2V0VmlzaWJsZVBvcG92ZXJJZCh2aXNpYmxlID8gY2FzY2FkZUZpbHRlcnNbaW5kZXhdLmlkIDogbnVsbCl9IGZpbHRlcj17Y2FzY2FkZUZpbHRlcnNbaW5kZXhdfSBvbkZpbHRlclNlbGVjdGlvbkNoYW5nZT17b25GaWx0ZXJTZWxlY3Rpb25DaGFuZ2V9IGRpcmVjdFBhdGhUb0NoaWxkPXtkaXJlY3RQYXRoVG9DaGlsZH0gaW5WaWV3PXtmYWxzZX0vPlxuICAgICAgICAgIDwvcG9ydGFscy5JblBvcnRhbD4pKX1cbiAgICAgIHtmaWx0ZXJzSW5TY29wZS5tYXAoZmlsdGVyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZmlsdGVyVmFsdWVzLmZpbmRJbmRleChmID0+IGYuaWQgPT09IGZpbHRlci5pZCk7XG4gICAgICAgICAgICByZXR1cm4gPHBvcnRhbHMuT3V0UG9ydGFsIG5vZGU9e3BvcnRhbE5vZGVzW2luZGV4XX0gaW5WaWV3Lz47XG4gICAgICAgIH0pfVxuICAgICAge3Nob3dDb2xsYXBzZVBhbmVsICYmICg8Q29sbGFwc2UgZ2hvc3QgYm9yZGVyZWQgZXhwYW5kSWNvblBvc2l0aW9uPVwicmlnaHRcIiBjb2xsYXBzaWJsZT17ZmlsdGVyc091dE9mU2NvcGUubGVuZ3RoID09PSAwID8gJ2Rpc2FibGVkJyA6IHVuZGVmaW5lZH0gY3NzPXt0aGVtZSA9PiBjc3MgYFxuICAgICAgICAgICAgJi5hbnQtY29sbGFwc2Uge1xuICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAke2ZpbHRlcnNJblNjb3BlLmxlbmd0aCA+IDBcbiAgICAgICAgICAgICAgICA/IHRoZW1lLmdyaWRVbml0ICogNlxuICAgICAgICAgICAgICAgIDogMH1weDtcbiAgICAgICAgICAgICAgJiA+IC5hbnQtY29sbGFwc2UtaXRlbSB7XG4gICAgICAgICAgICAgICAgJiA+IC5hbnQtY29sbGFwc2UtaGVhZGVyIHtcbiAgICAgICAgICAgICAgICAgIHBhZGRpbmctbGVmdDogMDtcbiAgICAgICAgICAgICAgICAgIHBhZGRpbmctYm90dG9tOiAke3RoZW1lLmdyaWRVbml0ICogMn1weDtcblxuICAgICAgICAgICAgICAgICAgJiA+IC5hbnQtY29sbGFwc2UtYXJyb3cge1xuICAgICAgICAgICAgICAgICAgICByaWdodDogJHt0aGVtZS5ncmlkVW5pdH1weDtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAmIC5hbnQtY29sbGFwc2UtY29udGVudC1ib3gge1xuICAgICAgICAgICAgICAgICAgcGFkZGluZzogJHt0aGVtZS5ncmlkVW5pdCAqIDR9cHggMCAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIGB9PlxuICAgICAgICAgIDxDb2xsYXBzZS5QYW5lbCBoZWFkZXI9e2Ake3QoJ0ZpbHRlcnMgb3V0IG9mIHNjb3BlJyl9ICgke2ZpbHRlcnNPdXRPZlNjb3BlLmxlbmd0aH0pYH0ga2V5PVwiMVwiPlxuICAgICAgICAgICAge2ZpbHRlcnNPdXRPZlNjb3BlLm1hcChmaWx0ZXIgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY2FzY2FkZUZpbHRlcnMuZmluZEluZGV4KGYgPT4gZi5pZCA9PT0gZmlsdGVyLmlkKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gPHBvcnRhbHMuT3V0UG9ydGFsIG5vZGU9e3BvcnRhbE5vZGVzW2luZGV4XX0gaW5WaWV3Lz47XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICA8L0NvbGxhcHNlLlBhbmVsPlxuICAgICAgICA8L0NvbGxhcHNlPil9XG4gICAgPC9XcmFwcGVyPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgRmlsdGVyQ29udHJvbHM7XG4iXX0= */\"), __self: this, __source: { fileName: _jsxFileName, lineNumber: 67, columnNumber: 30 } },\n\n\n\n\n  ___EmotionJSX(Collapse.Panel, { header: `${t('Filters out of scope')} (${filtersOutOfScope.length})`, key: \"1\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 88, columnNumber: 11 } },\n  filtersOutOfScope.map((filter) => {\n    const index = cascadeFilters.findIndex((f) => f.id === filter.id);\n    return ___EmotionJSX(portals.OutPortal, { node: portalNodes[index], inView: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 91, columnNumber: 24 } });\n  }))));\n\n\n\n};__signature__(FilterControls, \"useState{[visiblePopoverId, setVisiblePopoverId](null)}\\nuseFilters{filters}\\nuseMemo{portalNodes}\\nuseMemo{cascadeFilters}\\nuseSelectFiltersInScope{[filtersInScope, filtersOutOfScope]}\\nuseDashboardHasTabs{dashboardHasTabs}\", () => [useFilters, useSelectFiltersInScope, useDashboardHasTabs]);const _default =\nFilterControls;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(Wrapper, \"Wrapper\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");reactHotLoader.register(FilterControls, \"FilterControls\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");reactHotLoader.register(_default, \"default\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/dashboard/components/nativeFilters/FilterBar/FilterControls/FilterControls.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, useMemo, useState } from 'react';\nimport { DataMask, styled, t } from '@superset-ui/core';\nimport { css } from '@emotion/react';\nimport * as portals from 'react-reverse-portal';\nimport { DataMaskStateWithId } from 'src/dataMask/types';\nimport { Collapse } from 'src/common/components';\nimport CascadePopover from '../CascadeFilters/CascadePopover';\nimport { buildCascadeFiltersTree } from './utils';\nimport { useFilters } from '../state';\nimport { Filter } from '../../types';\nimport { useDashboardHasTabs, useSelectFiltersInScope } from '../../state';\n\nconst Wrapper = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 4}px;\n  &:hover {\n    cursor: pointer;\n  }\n`;\n\ntype FilterControlsProps = {\n  directPathToChild?: string[];\n  dataMaskSelected: DataMaskStateWithId;\n  onFilterSelectionChange: (filter: Filter, dataMask: DataMask) => void;\n};\n\nconst FilterControls: FC<FilterControlsProps> = ({\n  directPathToChild,\n  dataMaskSelected,\n  onFilterSelectionChange,\n}) => {\n  const [visiblePopoverId, setVisiblePopoverId] = useState<string | null>(null);\n  const filters = useFilters();\n  const filterValues = Object.values<Filter>(filters);\n  const portalNodes = React.useMemo(() => {\n    const nodes = new Array(filterValues.length);\n    for (let i = 0; i < filterValues.length; i += 1) {\n      nodes[i] = portals.createHtmlPortalNode();\n    }\n    return nodes;\n  }, [filterValues.length]);\n\n  const cascadeFilters = useMemo(() => {\n    const filtersWithValue = filterValues.map(filter => ({\n      ...filter,\n      dataMask: dataMaskSelected[filter.id],\n    }));\n    return buildCascadeFiltersTree(filtersWithValue);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [JSON.stringify(filterValues), dataMaskSelected]);\n  const cascadeFilterIds = new Set(cascadeFilters.map(item => item.id));\n\n  const [filtersInScope, filtersOutOfScope] = useSelectFiltersInScope(\n    cascadeFilters,\n  );\n  const dashboardHasTabs = useDashboardHasTabs();\n  const showCollapsePanel = dashboardHasTabs && cascadeFilters.length > 0;\n\n  return (\n    <Wrapper>\n      {portalNodes\n        .filter((node, index) => cascadeFilterIds.has(filterValues[index].id))\n        .map((node, index) => (\n          <portals.InPortal node={node}>\n            <CascadePopover\n              data-test=\"cascade-filters-control\"\n              key={cascadeFilters[index].id}\n              dataMaskSelected={dataMaskSelected}\n              visible={visiblePopoverId === cascadeFilters[index].id}\n              onVisibleChange={visible =>\n                setVisiblePopoverId(visible ? cascadeFilters[index].id : null)\n              }\n              filter={cascadeFilters[index]}\n              onFilterSelectionChange={onFilterSelectionChange}\n              directPathToChild={directPathToChild}\n              inView={false}\n            />\n          </portals.InPortal>\n        ))}\n      {filtersInScope.map(filter => {\n        const index = filterValues.findIndex(f => f.id === filter.id);\n        return <portals.OutPortal node={portalNodes[index]} inView />;\n      })}\n      {showCollapsePanel && (\n        <Collapse\n          ghost\n          bordered\n          expandIconPosition=\"right\"\n          collapsible={filtersOutOfScope.length === 0 ? 'disabled' : undefined}\n          css={theme => css`\n            &.ant-collapse {\n              margin-top: ${filtersInScope.length > 0\n                ? theme.gridUnit * 6\n                : 0}px;\n              & > .ant-collapse-item {\n                & > .ant-collapse-header {\n                  padding-left: 0;\n                  padding-bottom: ${theme.gridUnit * 2}px;\n\n                  & > .ant-collapse-arrow {\n                    right: ${theme.gridUnit}px;\n                  }\n                }\n\n                & .ant-collapse-content-box {\n                  padding: ${theme.gridUnit * 4}px 0 0;\n                }\n              }\n            }\n          `}\n        >\n          <Collapse.Panel\n            header={`${t('Filters out of scope')} (${\n              filtersOutOfScope.length\n            })`}\n            key=\"1\"\n          >\n            {filtersOutOfScope.map(filter => {\n              const index = cascadeFilters.findIndex(f => f.id === filter.id);\n              return <portals.OutPortal node={portalNodes[index]} inView />;\n            })}\n          </Collapse.Panel>\n        </Collapse>\n      )}\n    </Wrapper>\n  );\n};\n\nexport default FilterControls;\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}