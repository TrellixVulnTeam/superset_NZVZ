{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport {\naddDangerToast,\naddSuccessToast } from\n'src/components/MessageToasts/actions';\n\nexport const SET_REPORT = 'SET_REPORT';\nexport function setReport(report) {\n  return { type: SET_REPORT, report };\n}\n\nexport function fetchUISpecificReport(\nuserId,\nfilter_field,\ncreation_method,\ndashboardId)\n{\n  const queryParams = rison.encode({\n    filters: [\n    {\n      col: filter_field,\n      opr: 'eq',\n      value: dashboardId },\n\n    {\n      col: 'creation_method',\n      opr: 'eq',\n      value: creation_method },\n\n    {\n      col: 'created_by',\n      opr: 'rel_o_m',\n      value: userId }] });\n\n\n\n  return function fetchUISpecificReportThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/report/?q=${queryParams}` }).\n\n    then(({ json }) => {\n      dispatch(setReport(json));\n    }).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'There was an issue fetching reports attached to this dashboard.'))));\n\n\n\n\n  };\n}\n\nconst structureFetchAction = (dispatch, getState) => {\n  const state = getState();\n  const { user, dashboardInfo, charts, explore } = state;\n  if (dashboardInfo) {\n    dispatch(\n    fetchUISpecificReport(\n    user.userId,\n    'dashboard_id',\n    'dashboards',\n    dashboardInfo.id));\n\n\n  } else {\n    const [chartArr] = Object.keys(charts);\n    dispatch(\n    fetchUISpecificReport(\n    explore.user.userId,\n    'chart_id',\n    'charts',\n    charts[chartArr].id));\n\n\n  }\n};\n\nexport const ADD_REPORT = 'ADD_REPORT';\n\nexport const addReport = (report) => (dispatch) =>\nSupersetClient.post({\n  endpoint: `/api/v1/report/`,\n  jsonPayload: report }).\n\nthen(({ json }) => {\n  dispatch({ type: ADD_REPORT, json });\n  dispatch(addSuccessToast(t('The report has been created')));\n}).\ncatch(async (e) => {\n  const parsedError = await getClientErrorObject(e);\n  const errorMessage = parsedError.message;\n  const errorArr = Object.keys(errorMessage);\n  const error = errorMessage[errorArr[0]];\n  dispatch(\n  addDangerToast(\n  t('An error occurred while editing this report: %s', error)));\n\n\n});\n\nexport const EDIT_REPORT = 'EDIT_REPORT';\n\nexport function editReport(id, report) {\n  return function (dispatch) {\n    SupersetClient.put({\n      endpoint: `/api/v1/report/${id}`,\n      jsonPayload: report }).\n\n    then(({ json }) => {\n      dispatch({ type: EDIT_REPORT, json });\n    }).\n    catch(() =>\n    dispatch(\n    addDangerToast(t('An error occurred while editing this report.'))));\n\n\n  };\n}\n\nexport function toggleActive(report, isActive) {\n  return function toggleActiveThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        active: isActive }) }).\n\n\n    catch(() => {\n      dispatch(\n      addDangerToast(\n      t('We were unable to active or deactivate this report.')));\n\n\n    }).\n    finally(() => {\n      dispatch(structureFetchAction);\n    });\n  };\n}\n\nexport function deleteActiveReport(report) {\n  return function deleteActiveReportThunk(dispatch) {\n    return SupersetClient.delete({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`) }).\n\n    catch(() => {\n      dispatch(addDangerToast(t('Your report could not be deleted')));\n    }).\n    finally(() => {\n      dispatch(structureFetchAction);\n      dispatch(addSuccessToast(t('Deleted: %s', report.name)));\n    });\n  };\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(SET_REPORT, \"SET_REPORT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(setReport, \"setReport\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(fetchUISpecificReport, \"fetchUISpecificReport\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(structureFetchAction, \"structureFetchAction\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(ADD_REPORT, \"ADD_REPORT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(addReport, \"addReport\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(EDIT_REPORT, \"EDIT_REPORT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(editReport, \"editReport\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(toggleActive, \"toggleActive\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(deleteActiveReport, \"deleteActiveReport\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/reports/actions/reports.js"],"names":["t","SupersetClient","rison","getClientErrorObject","addDangerToast","addSuccessToast","SET_REPORT","setReport","report","type","fetchUISpecificReport","userId","filter_field","creation_method","dashboardId","queryParams","encode","filters","col","opr","value","fetchUISpecificReportThunk","dispatch","get","endpoint","then","json","catch","structureFetchAction","getState","state","user","dashboardInfo","charts","explore","id","chartArr","Object","keys","ADD_REPORT","addReport","post","jsonPayload","e","parsedError","errorMessage","message","errorArr","error","EDIT_REPORT","editReport","put","toggleActive","isActive","toggleActiveThunk","encodeURI","headers","body","JSON","stringify","active","finally","deleteActiveReport","deleteActiveReportThunk","delete","name"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport {\n  addDangerToast,\n  addSuccessToast,\n} from 'src/components/MessageToasts/actions';\n\nexport const SET_REPORT = 'SET_REPORT';\nexport function setReport(report) {\n  return { type: SET_REPORT, report };\n}\n\nexport function fetchUISpecificReport(\n  userId,\n  filter_field,\n  creation_method,\n  dashboardId,\n) {\n  const queryParams = rison.encode({\n    filters: [\n      {\n        col: filter_field,\n        opr: 'eq',\n        value: dashboardId,\n      },\n      {\n        col: 'creation_method',\n        opr: 'eq',\n        value: creation_method,\n      },\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: userId,\n      },\n    ],\n  });\n  return function fetchUISpecificReportThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/report/?q=${queryParams}`,\n    })\n      .then(({ json }) => {\n        dispatch(setReport(json));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'There was an issue fetching reports attached to this dashboard.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nconst structureFetchAction = (dispatch, getState) => {\n  const state = getState();\n  const { user, dashboardInfo, charts, explore } = state;\n  if (dashboardInfo) {\n    dispatch(\n      fetchUISpecificReport(\n        user.userId,\n        'dashboard_id',\n        'dashboards',\n        dashboardInfo.id,\n      ),\n    );\n  } else {\n    const [chartArr] = Object.keys(charts);\n    dispatch(\n      fetchUISpecificReport(\n        explore.user.userId,\n        'chart_id',\n        'charts',\n        charts[chartArr].id,\n      ),\n    );\n  }\n};\n\nexport const ADD_REPORT = 'ADD_REPORT';\n\nexport const addReport = report => dispatch =>\n  SupersetClient.post({\n    endpoint: `/api/v1/report/`,\n    jsonPayload: report,\n  })\n    .then(({ json }) => {\n      dispatch({ type: ADD_REPORT, json });\n      dispatch(addSuccessToast(t('The report has been created')));\n    })\n    .catch(async e => {\n      const parsedError = await getClientErrorObject(e);\n      const errorMessage = parsedError.message;\n      const errorArr = Object.keys(errorMessage);\n      const error = errorMessage[errorArr[0]];\n      dispatch(\n        addDangerToast(\n          t('An error occurred while editing this report: %s', error),\n        ),\n      );\n    });\n\nexport const EDIT_REPORT = 'EDIT_REPORT';\n\nexport function editReport(id, report) {\n  return function (dispatch) {\n    SupersetClient.put({\n      endpoint: `/api/v1/report/${id}`,\n      jsonPayload: report,\n    })\n      .then(({ json }) => {\n        dispatch({ type: EDIT_REPORT, json });\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(t('An error occurred while editing this report.')),\n        ),\n      );\n  };\n}\n\nexport function toggleActive(report, isActive) {\n  return function toggleActiveThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        active: isActive,\n      }),\n    })\n      .catch(() => {\n        dispatch(\n          addDangerToast(\n            t('We were unable to active or deactivate this report.'),\n          ),\n        );\n      })\n      .finally(() => {\n        dispatch(structureFetchAction);\n      });\n  };\n}\n\nexport function deleteActiveReport(report) {\n  return function deleteActiveReportThunk(dispatch) {\n    return SupersetClient.delete({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n    })\n      .catch(() => {\n        dispatch(addDangerToast(t('Your report could not be deleted')));\n      })\n      .finally(() => {\n        dispatch(structureFetchAction);\n        dispatch(addSuccessToast(t('Deleted: %s', report.name)));\n      });\n  };\n}\n"]},"metadata":{},"sourceType":"module"}