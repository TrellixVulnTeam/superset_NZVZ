{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { useState, useEffect, useCallback } from 'react';\nimport { makeApi, SupersetClient, t } from '@superset-ui/core';\nimport { createErrorHandler, getAlreadyExists, getPasswordsNeeded, hasTerminalValidation } from 'src/views/CRUD/utils';\nimport copyTextToClipboard from 'src/utils/copy';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport SupersetText from 'src/utils/textUtils';\nconst parsedErrorMessage = (errorMessage) => {\n  if (typeof errorMessage === 'string') {\n    return errorMessage;\n  }\n  return Object.entries(errorMessage).\n  map(([key, value]) => {\n    if (Array.isArray(value)) {\n      return `(${key}) ${value.join(', ')}`;\n    }\n    return `(${key}) ${value}`;\n  }).\n  join('\\n');\n};\nexport function useListViewResource(resource, resourceLabel, // resourceLabel for translations\nhandleErrorMsg, infoEnable = true, defaultCollectionValue = [], baseFilters, // must be memoized\ninitialLoadingState = true) {\n  const [state, setState] = useState({\n    count: 0,\n    collection: defaultCollectionValue,\n    loading: initialLoadingState,\n    lastFetchDataConfig: null,\n    permissions: [],\n    bulkSelectEnabled: false });\n\n  function updateState(update) {\n    setState((currentState) => ({ ...currentState, ...update }));\n  }\n  function toggleBulkSelect() {\n    updateState({ bulkSelectEnabled: !state.bulkSelectEnabled });\n  }\n  useEffect(() => {\n    if (!infoEnable)\n    return;\n    SupersetClient.get({\n      endpoint: `/api/v1/${resource}/_info?q=${rison.encode({\n        keys: ['permissions'] })\n      }` }).\n    then(({ json: infoJson = {} }) => {\n      updateState({\n        permissions: infoJson.permissions });\n\n    }, createErrorHandler((errMsg) => handleErrorMsg(t('An error occurred while fetching %s info: %s', resourceLabel, errMsg))));\n  }, []);\n  function hasPerm(perm) {\n    if (!state.permissions.length) {\n      return false;\n    }\n    return Boolean(state.permissions.find((p) => p === perm));\n  }\n  const fetchData = useCallback(({ pageIndex, pageSize, sortBy, filters: filterValues }) => {\n    // set loading state, cache the last config for refreshing data.\n    updateState({\n      lastFetchDataConfig: {\n        filters: filterValues,\n        pageIndex,\n        pageSize,\n        sortBy },\n\n      loading: true });\n\n    const filterExps = (baseFilters || []).\n    concat(filterValues).\n    map(({ id, operator: opr, value }) => ({\n      col: id,\n      opr,\n      value: value && typeof value === 'object' && 'value' in value ?\n      value.value :\n      value }));\n\n    const queryParams = rison.encode({\n      order_column: sortBy[0].id,\n      order_direction: sortBy[0].desc ? 'desc' : 'asc',\n      page: pageIndex,\n      page_size: pageSize,\n      ...(filterExps.length ? { filters: filterExps } : {}) });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/${resource}/?q=${queryParams}` }).\n\n    then(({ json = {} }) => {\n      updateState({\n        collection: json.result,\n        count: json.count,\n        lastFetched: new Date().toISOString() });\n\n    }, createErrorHandler((errMsg) => handleErrorMsg(t('An error occurred while fetching %ss: %s', resourceLabel, errMsg)))).\n    finally(() => {\n      updateState({ loading: false });\n    });\n  }, [baseFilters]);\n  return {\n    state: {\n      loading: state.loading,\n      resourceCount: state.count,\n      resourceCollection: state.collection,\n      bulkSelectEnabled: state.bulkSelectEnabled,\n      lastFetched: state.lastFetched },\n\n    setResourceCollection: (update) => updateState({\n      collection: update }),\n\n    hasPerm,\n    fetchData,\n    toggleBulkSelect,\n    refreshData: (provideConfig) => {\n      if (state.lastFetchDataConfig) {\n        return fetchData(state.lastFetchDataConfig);\n      }\n      if (provideConfig) {\n        return fetchData(provideConfig);\n      }\n      return null;\n    } };\n\n}__signature__(useListViewResource, \"useState{[state, setState]({\\n        count: 0,\\n        collection: defaultCollectionValue,\\n        loading: initialLoadingState,\\n        lastFetchDataConfig: null,\\n        permissions: [],\\n        bulkSelectEnabled: false,\\n    })}\\nuseEffect{}\\nuseCallback{fetchData}\");\nexport function useSingleViewResource(resourceName, resourceLabel, // resourceLabel for translations\nhandleErrorMsg) {\n  const [state, setState] = useState({\n    loading: false,\n    resource: null,\n    error: null });\n\n  function updateState(update) {\n    setState((currentState) => ({ ...currentState, ...update }));\n  }\n  const fetchResource = useCallback((resourceID) => {\n    // Set loading state\n    updateState({\n      loading: true });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/${resourceName}/${resourceID}` }).\n\n    then(({ json = {} }) => {\n      updateState({\n        resource: json.result,\n        error: null });\n\n      return json.result;\n    }, createErrorHandler((errMsg) => {\n      handleErrorMsg(t('An error occurred while fetching %ss: %s', resourceLabel, parsedErrorMessage(errMsg)));\n      updateState({\n        error: errMsg });\n\n    })).\n    finally(() => {\n      updateState({ loading: false });\n    });\n  }, [handleErrorMsg, resourceName, resourceLabel]);\n  const createResource = useCallback((resource, hideToast = false) => {\n    // Set loading state\n    updateState({\n      loading: true });\n\n    return SupersetClient.post({\n      endpoint: `/api/v1/${resourceName}/`,\n      body: JSON.stringify(resource),\n      headers: { 'Content-Type': 'application/json' } }).\n\n    then(({ json = {} }) => {\n      updateState({\n        resource: { id: json.id, ...json.result },\n        error: null });\n\n      return json.id;\n    }, createErrorHandler((errMsg) => {\n      // we did not want toasts for db-connection-ui but did not want to disable it everywhere\n      if (!hideToast) {\n        handleErrorMsg(t('An error occurred while creating %ss: %s', resourceLabel, parsedErrorMessage(errMsg)));\n      }\n      updateState({\n        error: errMsg });\n\n    })).\n    finally(() => {\n      updateState({ loading: false });\n    });\n  }, [handleErrorMsg, resourceName, resourceLabel]);\n  const updateResource = useCallback((resourceID, resource, hideToast = false) => {\n    // Set loading state\n    updateState({\n      loading: true });\n\n    return SupersetClient.put({\n      endpoint: `/api/v1/${resourceName}/${resourceID}`,\n      body: JSON.stringify(resource),\n      headers: { 'Content-Type': 'application/json' } }).\n\n    then(({ json = {} }) => {\n      updateState({\n        resource: { ...json.result, id: json.id },\n        error: null });\n\n      return json.result;\n    }, createErrorHandler((errMsg) => {\n      if (!hideToast) {\n        handleErrorMsg(t('An error occurred while fetching %ss: %s', resourceLabel, JSON.stringify(errMsg)));\n      }\n      updateState({\n        error: errMsg });\n\n      return errMsg;\n    })).\n    finally(() => {\n      updateState({ loading: false });\n    });\n  }, [handleErrorMsg, resourceName, resourceLabel]);\n  const clearError = () => updateState({\n    error: null });\n\n  return {\n    state,\n    setResource: (update) => updateState({\n      resource: update }),\n\n    fetchResource,\n    createResource,\n    updateResource,\n    clearError };\n\n}__signature__(useSingleViewResource, \"useState{[state, setState]({\\n        loading: false,\\n        resource: null,\\n        error: null,\\n    })}\\nuseCallback{fetchResource}\\nuseCallback{createResource}\\nuseCallback{updateResource}\");\nexport function useImportResource(resourceName, resourceLabel, // resourceLabel for translations\nhandleErrorMsg) {\n  const [state, setState] = useState({\n    loading: false,\n    passwordsNeeded: [],\n    alreadyExists: [] });\n\n  function updateState(update) {\n    setState((currentState) => ({ ...currentState, ...update }));\n  }\n  const importResource = useCallback((bundle, databasePasswords = {}, overwrite = false) => {\n    // Set loading state\n    updateState({\n      loading: true });\n\n    const formData = new FormData();\n    formData.append('formData', bundle);\n    /* The import bundle never contains database passwords; if required\n     * they should be provided by the user during import.\n     */\n    if (databasePasswords) {\n      formData.append('passwords', JSON.stringify(databasePasswords));\n    }\n    /* If the imported model already exists the user needs to confirm\n     * that they want to overwrite it.\n     */\n    if (overwrite) {\n      formData.append('overwrite', 'true');\n    }\n    return SupersetClient.post({\n      endpoint: `/api/v1/${resourceName}/import/`,\n      body: formData,\n      headers: { Accept: 'application/json' } }).\n\n    then(() => true).\n    catch((response) => getClientErrorObject(response).then((error) => {\n      if (!error.errors) {\n        handleErrorMsg(t('An error occurred while importing %s: %s', resourceLabel, error.message || error.error));\n        return false;\n      }\n      if (hasTerminalValidation(error.errors)) {\n        handleErrorMsg(t('An error occurred while importing %s: %s', resourceLabel, error.errors.map((payload) => payload.message).join('\\n')));\n      } else\n      {\n        updateState({\n          passwordsNeeded: getPasswordsNeeded(error.errors),\n          alreadyExists: getAlreadyExists(error.errors) });\n\n      }\n      return false;\n    })).\n    finally(() => {\n      updateState({ loading: false });\n    });\n  }, []);\n  return { state, importResource };\n}__signature__(useImportResource, \"useState{[state, setState]({\\n        loading: false,\\n        passwordsNeeded: [],\\n        alreadyExists: [],\\n    })}\\nuseCallback{importResource}\");\nvar FavStarClassName;\n(function (FavStarClassName) {\n  FavStarClassName[\"CHART\"] = \"slice\";\n  FavStarClassName[\"DASHBOARD\"] = \"Dashboard\";\n})(FavStarClassName || (FavStarClassName = {}));\nconst favoriteApis = {\n  chart: makeApi({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/chart/favorite_status/' }),\n\n  dashboard: makeApi({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/dashboard/favorite_status/' }) };\n\n\nexport function useFavoriteStatus(type, ids, handleErrorMsg) {\n  const [favoriteStatus, setFavoriteStatus] = useState({});\n  const updateFavoriteStatus = (update) => setFavoriteStatus((currentState) => ({ ...currentState, ...update }));\n  useEffect(() => {\n    if (!ids.length) {\n      return;\n    }\n    favoriteApis[type](ids).then(({ result }) => {\n      const update = result.reduce((acc, element) => {\n        acc[element.id] = element.value;\n        return acc;\n      }, {});\n      updateFavoriteStatus(update);\n    }, createErrorHandler((errMsg) => handleErrorMsg(t('There was an error fetching the favorite status: %s', errMsg))));\n  }, [ids, type, handleErrorMsg]);\n  const saveFaveStar = useCallback((id, isStarred) => {\n    const urlSuffix = isStarred ? 'unselect' : 'select';\n    SupersetClient.get({\n      endpoint: `/superset/favstar/${type === 'chart' ? FavStarClassName.CHART : FavStarClassName.DASHBOARD}/${id}/${urlSuffix}/` }).\n    then(({ json }) => {\n      updateFavoriteStatus({\n        [id]: (json == null ? void 0 : json.count) > 0 });\n\n    }, createErrorHandler((errMsg) => handleErrorMsg(t('There was an error saving the favorite status: %s', errMsg))));\n  }, [type]);\n  return [saveFaveStar, favoriteStatus];\n}__signature__(useFavoriteStatus, \"useState{[favoriteStatus, setFavoriteStatus]({})}\\nuseEffect{}\\nuseCallback{saveFaveStar}\");\nexport const useChartEditModal = (setCharts, charts) => {\n  const [sliceCurrentlyEditing, setSliceCurrentlyEditing] = useState(null);\n  function openChartEditModal(chart) {\n    setSliceCurrentlyEditing({\n      slice_id: chart.id,\n      slice_name: chart.slice_name,\n      description: chart.description,\n      cache_timeout: chart.cache_timeout,\n      certified_by: chart.certified_by,\n      certification_details: chart.certification_details });\n\n  }\n  function closeChartEditModal() {\n    setSliceCurrentlyEditing(null);\n  }\n  function handleChartUpdated(edits) {\n    // update the chart in our state with the edited info\n    const newCharts = charts.map((chart) => chart.id === edits.id ? { ...chart, ...edits } : chart);\n    setCharts(newCharts);\n  }\n  return {\n    sliceCurrentlyEditing,\n    handleChartUpdated,\n    openChartEditModal,\n    closeChartEditModal };\n\n};__signature__(useChartEditModal, \"useState{[sliceCurrentlyEditing, setSliceCurrentlyEditing,](null)}\");\nexport const copyQueryLink = (id, addDangerToast, addSuccessToast) => {\n  copyTextToClipboard(`${window.location.origin}/superset/sqllab?savedQueryId=${id}`).\n  then(() => {\n    addSuccessToast(t('Link Copied!'));\n  }).\n  catch(() => {\n    addDangerToast(t('Sorry, your browser does not support copying.'));\n  });\n};\nexport const getDatabaseImages = () => SupersetText.DB_IMAGES;\nexport const getConnectionAlert = () => SupersetText.DB_CONNECTION_ALERTS;\nexport const getDatabaseDocumentationLinks = () => SupersetText.DB_CONNECTION_DOC_LINKS;\nexport const testDatabaseConnection = (connection, handleErrorMsg, addSuccessToast) => {\n  SupersetClient.post({\n    endpoint: 'api/v1/database/test_connection',\n    body: JSON.stringify(connection),\n    headers: { 'Content-Type': 'application/json' } }).\n  then(() => {\n    addSuccessToast(t('Connection looks good!'));\n  }, createErrorHandler((errMsg) => {\n    handleErrorMsg(t(`${t('ERROR: ')}${parsedErrorMessage(errMsg)}`));\n  }));\n};\nexport function useAvailableDatabases() {\n  const [availableDbs, setAvailableDbs] = useState(null);\n  const getAvailable = useCallback(() => {\n    SupersetClient.get({\n      endpoint: `/api/v1/database/available/` }).\n    then(({ json }) => {\n      setAvailableDbs(json);\n    });\n  }, [setAvailableDbs]);\n  return [availableDbs, getAvailable];\n}__signature__(useAvailableDatabases, \"useState{[availableDbs, setAvailableDbs](null)}\\nuseCallback{getAvailable}\");\nexport function useDatabaseValidation() {\n  const [validationErrors, setValidationErrors] = useState(null);\n  const getValidation = useCallback((database, onCreate = false) => {\n    SupersetClient.post({\n      endpoint: '/api/v1/database/validate_parameters',\n      body: JSON.stringify(database),\n      headers: { 'Content-Type': 'application/json' } }).\n\n    then(() => {\n      setValidationErrors(null);\n    }).\n    catch((e) => {\n      if (typeof e.json === 'function') {\n        e.json().then(({ errors = [] }) => {\n          const parsedErrors = errors.\n          filter((error) => {\n            const skipValidationError = ![\n            'CONNECTION_MISSING_PARAMETERS_ERROR',\n            'CONNECTION_ACCESS_DENIED_ERROR'].\n            includes(error.error_type);\n            return skipValidationError || onCreate;\n          }).\n          reduce((obj, { error_type, extra, message }) => {\n            if (extra.catalog) {\n              if (extra.catalog.name) {\n                return {\n                  ...obj,\n                  error_type,\n                  [extra.catalog.idx]: {\n                    name: message } };\n\n\n              }\n              if (extra.catalog.url) {\n                return {\n                  ...obj,\n                  error_type,\n                  [extra.catalog.idx]: {\n                    url: message } };\n\n\n              }\n              return {\n                ...obj,\n                error_type,\n                [extra.catalog.idx]: {\n                  name: message,\n                  url: message } };\n\n\n            }\n            // if extra.invalid doesn't exist then the\n            // error can't be mapped to a parameter\n            // so leave it alone\n            if (extra.invalid) {\n              return {\n                ...obj,\n                [extra.invalid[0]]: message,\n                error_type };\n\n            }\n            if (extra.missing) {\n              return {\n                ...obj,\n                error_type,\n                ...Object.assign({}, ...extra.missing.map((field) => ({\n                  [field]: 'This is a required field' }))) };\n\n\n            }\n            return obj;\n          }, {});\n          setValidationErrors(parsedErrors);\n        });\n      } else\n      {\n        // eslint-disable-next-line no-console\n        console.error(e);\n      }\n    });\n  }, [setValidationErrors]);\n  return [validationErrors, getValidation, setValidationErrors];\n}__signature__(useDatabaseValidation, \"useState{[validationErrors, setValidationErrors](null)}\\nuseCallback{getValidation}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(parsedErrorMessage, \"parsedErrorMessage\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(useListViewResource, \"useListViewResource\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(useSingleViewResource, \"useSingleViewResource\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(useImportResource, \"useImportResource\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(FavStarClassName, \"FavStarClassName\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(favoriteApis, \"favoriteApis\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(useFavoriteStatus, \"useFavoriteStatus\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(useChartEditModal, \"useChartEditModal\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(copyQueryLink, \"copyQueryLink\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(getDatabaseImages, \"getDatabaseImages\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(getConnectionAlert, \"getConnectionAlert\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(getDatabaseDocumentationLinks, \"getDatabaseDocumentationLinks\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(testDatabaseConnection, \"testDatabaseConnection\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(useAvailableDatabases, \"useAvailableDatabases\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");reactHotLoader.register(useDatabaseValidation, \"useDatabaseValidation\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/views/CRUD/hooks.ts"],"names":[],"mappings":"wSAAA;;;;;;;;;;;;;;;;;AAiBG;AACH,OAAO,KAAP,MAAkB,OAAlB;AACA,SAAS,QAAT,EAAmB,SAAnB,EAA8B,WAA9B,QAAiD,OAAjD;AACA,SAAS,OAAT,EAAkB,cAAlB,EAAkC,CAAlC,QAAuD,mBAAvD;AAEA,SACE,kBADF,EAEE,gBAFF,EAGE,kBAHF,EAIE,qBAJF,QAKO,sBALP;AASA,OAAO,mBAAP,MAAgC,gBAAhC;AACA,SAAS,oBAAT,QAAqC,gCAArC;AACA,OAAO,YAAP,MAAyB,qBAAzB;AAaA,MAAM,kBAAkB,GAAG,CACzB,YADyB,KAEvB;AACF,MAAI,OAAO,YAAP,KAAwB,QAA5B,EAAsC;AACpC,WAAO,YAAP;AACD;AACD,SAAO,MAAM,CAAC,OAAP,CAAe,YAAf;AACJ,EAAA,GADI,CACA,CAAC,CAAC,GAAD,EAAM,KAAN,CAAD,KAAiB;AACpB,QAAI,KAAK,CAAC,OAAN,CAAc,KAAd,CAAJ,EAA0B;AACxB,aAAO,IAAI,GAAG,KAAK,KAAK,CAAC,IAAN,CAAW,IAAX,CAAgB,EAAnC;AACD;AACD,WAAO,IAAI,GAAG,KAAK,KAAK,EAAxB;AACD,GANI;AAOJ,EAAA,IAPI,CAOC,IAPD,CAAP;AAQD,CAdD;AAgBA,OAAM,SAAU,mBAAV,CACJ,QADI,EAEJ,aAFI,EAEmB;AACvB,cAHI,EAIJ,UAAU,GAAG,IAJT,EAKJ,sBAAA,GAA8B,EAL1B,EAMJ,WANI,EAMyB;AAC7B,mBAAmB,GAAG,IAPlB,EAOsB;AAE1B,QAAM,CAAC,KAAD,EAAQ,QAAR,IAAoB,QAAQ,CAA2B;AAC3D,IAAA,KAAK,EAAE,CADoD;AAE3D,IAAA,UAAU,EAAE,sBAF+C;AAG3D,IAAA,OAAO,EAAE,mBAHkD;AAI3D,IAAA,mBAAmB,EAAE,IAJsC;AAK3D,IAAA,WAAW,EAAE,EAL8C;AAM3D,IAAA,iBAAiB,EAAE,KANwC,EAA3B,CAAlC;;AASA,WAAS,WAAT,CAAqB,MAArB,EAA8D;AAC5D,IAAA,QAAQ,CAAC,CAAA,YAAY,MAAK,EAAE,GAAG,YAAL,EAAmB,GAAG,MAAtB,EAAL,CAAb,CAAR;AACD;AAED,WAAS,gBAAT,GAAyB;AACvB,IAAA,WAAW,CAAC,EAAE,iBAAiB,EAAE,CAAC,KAAK,CAAC,iBAA5B,EAAD,CAAX;AACD;AAED,EAAA,SAAS,CAAC,MAAK;AACb,QAAI,CAAC,UAAL;AAAiB;AACjB,IAAA,cAAc,CAAC,GAAf,CAAmB;AACjB,MAAA,QAAQ,EAAE,WAAW,QAAQ,YAAY,KAAK,CAAC,MAAN,CAAa;AACpD,QAAA,IAAI,EAAE,CAAC,aAAD,CAD8C,EAAb;AAEvC,QAHe,EAAnB;AAIG,IAAA,IAJH,CAKE,CAAC,EAAE,IAAI,EAAE,QAAQ,GAAG,EAAnB,EAAD,KAA4B;AAC1B,MAAA,WAAW,CAAC;AACV,QAAA,WAAW,EAAE,QAAQ,CAAC,WADZ,EAAD,CAAX;;AAGD,KATH,EAUE,kBAAkB,CAAC,CAAA,MAAM,KACvB,cAAc,CACZ,CAAC,CACC,8CADD,EAEC,aAFD,EAGC,MAHD,CADW,CADE,CAVpB;AAoBD,GAtBQ,EAsBN,EAtBM,CAAT;AAwBA,WAAS,OAAT,CAAiB,IAAjB,EAA6B;AAC3B,QAAI,CAAC,KAAK,CAAC,WAAN,CAAkB,MAAvB,EAA+B;AAC7B,aAAO,KAAP;AACD;AAED,WAAO,OAAO,CAAC,KAAK,CAAC,WAAN,CAAkB,IAAlB,CAAuB,CAAA,CAAC,KAAI,CAAC,KAAK,IAAlC,CAAD,CAAd;AACD;AAED,QAAM,SAAS,GAAG,WAAW,CAC3B,CAAC,EACC,SADD,EAEC,QAFD,EAGC,MAHD,EAIC,OAAO,EAAE,YAJV,EAAD,KAKsB;AACpB;AACA,IAAA,WAAW,CAAC;AACV,MAAA,mBAAmB,EAAE;AACnB,QAAA,OAAO,EAAE,YADU;AAEnB,QAAA,SAFmB;AAGnB,QAAA,QAHmB;AAInB,QAAA,MAJmB,EADX;;AAOV,MAAA,OAAO,EAAE,IAPC,EAAD,CAAX;;AAUA,UAAM,UAAU,GAAG,CAAC,WAAW,IAAI,EAAhB;AAChB,IAAA,MADgB,CACT,YADS;AAEhB,IAAA,GAFgB,CAEZ,CAAC,EAAE,EAAF,EAAM,QAAQ,EAAE,GAAhB,EAAqB,KAArB,EAAD,MAAmC;AACtC,MAAA,GAAG,EAAE,EADiC;AAEtC,MAAA,GAFsC;AAGtC,MAAA,KAAK,EACH,KAAK,IAAI,OAAO,KAAP,KAAiB,QAA1B,IAAsC,WAAW,KAAjD;AACI,MAAA,KAAK,CAAC,KADV;AAEI,MAAA,KANgC,EAAnC,CAFY,CAAnB;;AAWA,UAAM,WAAW,GAAG,KAAK,CAAC,MAAN,CAAa;AAC/B,MAAA,YAAY,EAAE,MAAM,CAAC,CAAD,CAAN,CAAU,EADO;AAE/B,MAAA,eAAe,EAAE,MAAM,CAAC,CAAD,CAAN,CAAU,IAAV,GAAiB,MAAjB,GAA0B,KAFZ;AAG/B,MAAA,IAAI,EAAE,SAHyB;AAI/B,MAAA,SAAS,EAAE,QAJoB;AAK/B,UAAI,UAAU,CAAC,MAAX,GAAoB,EAAE,OAAO,EAAE,UAAX,EAApB,GAA8C,EAAlD,CAL+B,EAAb,CAApB;;AAQA,WAAO,cAAc,CAAC,GAAf,CAAmB;AACxB,MAAA,QAAQ,EAAE,WAAW,QAAQ,OAAO,WAAW,EADvB,EAAnB;;AAGJ,IAAA,IAHI,CAIH,CAAC,EAAE,IAAI,GAAG,EAAT,EAAD,KAAkB;AAChB,MAAA,WAAW,CAAC;AACV,QAAA,UAAU,EAAE,IAAI,CAAC,MADP;AAEV,QAAA,KAAK,EAAE,IAAI,CAAC,KAFF;AAGV,QAAA,WAAW,EAAE,IAAI,IAAJ,GAAW,WAAX,EAHH,EAAD,CAAX;;AAKD,KAVE,EAWH,kBAAkB,CAAC,CAAA,MAAM,KACvB,cAAc,CACZ,CAAC,CACC,0CADD,EAEC,aAFD,EAGC,MAHD,CADW,CADE,CAXf;AAqBJ,IAAA,OArBI,CAqBI,MAAK;AACZ,MAAA,WAAW,CAAC,EAAE,OAAO,EAAE,KAAX,EAAD,CAAX;AACD,KAvBI,CAAP;AAwBD,GA7D0B,EA8D3B,CAAC,WAAD,CA9D2B,CAA7B;AAiEA,SAAO;AACL,IAAA,KAAK,EAAE;AACL,MAAA,OAAO,EAAE,KAAK,CAAC,OADV;AAEL,MAAA,aAAa,EAAE,KAAK,CAAC,KAFhB;AAGL,MAAA,kBAAkB,EAAE,KAAK,CAAC,UAHrB;AAIL,MAAA,iBAAiB,EAAE,KAAK,CAAC,iBAJpB;AAKL,MAAA,WAAW,EAAE,KAAK,CAAC,WALd,EADF;;AAQL,IAAA,qBAAqB,EAAE,CAAC,MAAD,KACrB,WAAW,CAAC;AACV,MAAA,UAAU,EAAE,MADF,EAAD,CATR;;AAYL,IAAA,OAZK;AAaL,IAAA,SAbK;AAcL,IAAA,gBAdK;AAeL,IAAA,WAAW,EAAE,CAAC,aAAD,KAAoC;AAC/C,UAAI,KAAK,CAAC,mBAAV,EAA+B;AAC7B,eAAO,SAAS,CAAC,KAAK,CAAC,mBAAP,CAAhB;AACD;AACD,UAAI,aAAJ,EAAmB;AACjB,eAAO,SAAS,CAAC,aAAD,CAAhB;AACD;AACD,aAAO,IAAP;AACD,KAvBI,EAAP;;AAyBD,C,cApJe,mB;AA6JhB,OAAM,SAAU,qBAAV,CACJ,YADI,EAEJ,aAFI,EAEmB;AACvB,cAHI,EAGsC;AAE1C,QAAM,CAAC,KAAD,EAAQ,QAAR,IAAoB,QAAQ,CAA6B;AAC7D,IAAA,OAAO,EAAE,KADoD;AAE7D,IAAA,QAAQ,EAAE,IAFmD;AAG7D,IAAA,KAAK,EAAE,IAHsD,EAA7B,CAAlC;;AAMA,WAAS,WAAT,CAAqB,MAArB,EAAgE;AAC9D,IAAA,QAAQ,CAAC,CAAA,YAAY,MAAK,EAAE,GAAG,YAAL,EAAmB,GAAG,MAAtB,EAAL,CAAb,CAAR;AACD;AAED,QAAM,aAAa,GAAG,WAAW,CAC/B,CAAC,UAAD,KAAuB;AACrB;AACA,IAAA,WAAW,CAAC;AACV,MAAA,OAAO,EAAE,IADC,EAAD,CAAX;;AAIA,WAAO,cAAc,CAAC,GAAf,CAAmB;AACxB,MAAA,QAAQ,EAAE,WAAW,YAAY,IAAI,UAAU,EADvB,EAAnB;;AAGJ,IAAA,IAHI,CAIH,CAAC,EAAE,IAAI,GAAG,EAAT,EAAD,KAAkB;AAChB,MAAA,WAAW,CAAC;AACV,QAAA,QAAQ,EAAE,IAAI,CAAC,MADL;AAEV,QAAA,KAAK,EAAE,IAFG,EAAD,CAAX;;AAIA,aAAO,IAAI,CAAC,MAAZ;AACD,KAVE,EAWH,kBAAkB,CAAC,CAAC,MAAD,KAA8C;AAC/D,MAAA,cAAc,CACZ,CAAC,CACC,0CADD,EAEC,aAFD,EAGC,kBAAkB,CAAC,MAAD,CAHnB,CADW,CAAd;AAQA,MAAA,WAAW,CAAC;AACV,QAAA,KAAK,EAAE,MADG,EAAD,CAAX;;AAGD,KAZiB,CAXf;AAyBJ,IAAA,OAzBI,CAyBI,MAAK;AACZ,MAAA,WAAW,CAAC,EAAE,OAAO,EAAE,KAAX,EAAD,CAAX;AACD,KA3BI,CAAP;AA4BD,GAnC8B,EAoC/B,CAAC,cAAD,EAAiB,YAAjB,EAA+B,aAA/B,CApC+B,CAAjC;AAuCA,QAAM,cAAc,GAAG,WAAW,CAChC,CAAC,QAAD,EAAc,SAAS,GAAG,KAA1B,KAAmC;AACjC;AACA,IAAA,WAAW,CAAC;AACV,MAAA,OAAO,EAAE,IADC,EAAD,CAAX;;AAIA,WAAO,cAAc,CAAC,IAAf,CAAoB;AACzB,MAAA,QAAQ,EAAE,WAAW,YAAY,GADR;AAEzB,MAAA,IAAI,EAAE,IAAI,CAAC,SAAL,CAAe,QAAf,CAFmB;AAGzB,MAAA,OAAO,EAAE,EAAE,gBAAgB,kBAAlB,EAHgB,EAApB;;AAKJ,IAAA,IALI,CAMH,CAAC,EAAE,IAAI,GAAG,EAAT,EAAD,KAAkB;AAChB,MAAA,WAAW,CAAC;AACV,QAAA,QAAQ,EAAE,EAAE,EAAE,EAAE,IAAI,CAAC,EAAX,EAAe,GAAG,IAAI,CAAC,MAAvB,EADA;AAEV,QAAA,KAAK,EAAE,IAFG,EAAD,CAAX;;AAIA,aAAO,IAAI,CAAC,EAAZ;AACD,KAZE,EAaH,kBAAkB,CAAC,CAAC,MAAD,KAA8C;AAC/D;AACA,UAAI,CAAC,SAAL,EAAgB;AACd,QAAA,cAAc,CACZ,CAAC,CACC,0CADD,EAEC,aAFD,EAGC,kBAAkB,CAAC,MAAD,CAHnB,CADW,CAAd;AAOD;AAED,MAAA,WAAW,CAAC;AACV,QAAA,KAAK,EAAE,MADG,EAAD,CAAX;;AAGD,KAfiB,CAbf;AA8BJ,IAAA,OA9BI,CA8BI,MAAK;AACZ,MAAA,WAAW,CAAC,EAAE,OAAO,EAAE,KAAX,EAAD,CAAX;AACD,KAhCI,CAAP;AAiCD,GAxC+B,EAyChC,CAAC,cAAD,EAAiB,YAAjB,EAA+B,aAA/B,CAzCgC,CAAlC;AA4CA,QAAM,cAAc,GAAG,WAAW,CAChC,CAAC,UAAD,EAAqB,QAArB,EAAkC,SAAS,GAAG,KAA9C,KAAuD;AACrD;AACA,IAAA,WAAW,CAAC;AACV,MAAA,OAAO,EAAE,IADC,EAAD,CAAX;;AAIA,WAAO,cAAc,CAAC,GAAf,CAAmB;AACxB,MAAA,QAAQ,EAAE,WAAW,YAAY,IAAI,UAAU,EADvB;AAExB,MAAA,IAAI,EAAE,IAAI,CAAC,SAAL,CAAe,QAAf,CAFkB;AAGxB,MAAA,OAAO,EAAE,EAAE,gBAAgB,kBAAlB,EAHe,EAAnB;;AAKJ,IAAA,IALI,CAMH,CAAC,EAAE,IAAI,GAAG,EAAT,EAAD,KAAkB;AAChB,MAAA,WAAW,CAAC;AACV,QAAA,QAAQ,EAAE,EAAE,GAAG,IAAI,CAAC,MAAV,EAAkB,EAAE,EAAE,IAAI,CAAC,EAA3B,EADA;AAEV,QAAA,KAAK,EAAE,IAFG,EAAD,CAAX;;AAIA,aAAO,IAAI,CAAC,MAAZ;AACD,KAZE,EAaH,kBAAkB,CAAC,CAAA,MAAM,KAAG;AAC1B,UAAI,CAAC,SAAL,EAAgB;AACd,QAAA,cAAc,CACZ,CAAC,CACC,0CADD,EAEC,aAFD,EAGC,IAAI,CAAC,SAAL,CAAe,MAAf,CAHD,CADW,CAAd;AAOD;AAED,MAAA,WAAW,CAAC;AACV,QAAA,KAAK,EAAE,MADG,EAAD,CAAX;;AAIA,aAAO,MAAP;AACD,KAhBiB,CAbf;AA+BJ,IAAA,OA/BI,CA+BI,MAAK;AACZ,MAAA,WAAW,CAAC,EAAE,OAAO,EAAE,KAAX,EAAD,CAAX;AACD,KAjCI,CAAP;AAkCD,GAzC+B,EA0ChC,CAAC,cAAD,EAAiB,YAAjB,EAA+B,aAA/B,CA1CgC,CAAlC;AA4CA,QAAM,UAAU,GAAG,MACjB,WAAW,CAAC;AACV,IAAA,KAAK,EAAE,IADG,EAAD,CADb;;AAKA,SAAO;AACL,IAAA,KADK;AAEL,IAAA,WAAW,EAAE,CAAC,MAAD,KACX,WAAW,CAAC;AACV,MAAA,QAAQ,EAAE,MADA,EAAD,CAHR;;AAML,IAAA,aANK;AAOL,IAAA,cAPK;AAQL,IAAA,cARK;AASL,IAAA,UATK,EAAP;;AAWD,C,cA9Je,qB;AAsKhB,OAAM,SAAU,iBAAV,CACJ,YADI,EAEJ,aAFI,EAEmB;AACvB,cAHI,EAGsC;AAE1C,QAAM,CAAC,KAAD,EAAQ,QAAR,IAAoB,QAAQ,CAAsB;AACtD,IAAA,OAAO,EAAE,KAD6C;AAEtD,IAAA,eAAe,EAAE,EAFqC;AAGtD,IAAA,aAAa,EAAE,EAHuC,EAAtB,CAAlC;;AAMA,WAAS,WAAT,CAAqB,MAArB,EAAyD;AACvD,IAAA,QAAQ,CAAC,CAAA,YAAY,MAAK,EAAE,GAAG,YAAL,EAAmB,GAAG,MAAtB,EAAL,CAAb,CAAR;AACD;AAED,QAAM,cAAc,GAAG,WAAW,CAChC,CACE,MADF,EAEE,iBAAA,GAA4C,EAF9C,EAGE,SAAS,GAAG,KAHd,KAII;AACF;AACA,IAAA,WAAW,CAAC;AACV,MAAA,OAAO,EAAE,IADC,EAAD,CAAX;;AAIA,UAAM,QAAQ,GAAG,IAAI,QAAJ,EAAjB;AACA,IAAA,QAAQ,CAAC,MAAT,CAAgB,UAAhB,EAA4B,MAA5B;AAEA;;AAEG;AACH,QAAI,iBAAJ,EAAuB;AACrB,MAAA,QAAQ,CAAC,MAAT,CAAgB,WAAhB,EAA6B,IAAI,CAAC,SAAL,CAAe,iBAAf,CAA7B;AACD;AACD;;AAEG;AACH,QAAI,SAAJ,EAAe;AACb,MAAA,QAAQ,CAAC,MAAT,CAAgB,WAAhB,EAA6B,MAA7B;AACD;AAED,WAAO,cAAc,CAAC,IAAf,CAAoB;AACzB,MAAA,QAAQ,EAAE,WAAW,YAAY,UADR;AAEzB,MAAA,IAAI,EAAE,QAFmB;AAGzB,MAAA,OAAO,EAAE,EAAE,MAAM,EAAE,kBAAV,EAHgB,EAApB;;AAKJ,IAAA,IALI,CAKC,MAAM,IALP;AAMJ,IAAA,KANI,CAME,CAAA,QAAQ,KACb,oBAAoB,CAAC,QAAD,CAApB,CAA+B,IAA/B,CAAoC,CAAA,KAAK,KAAG;AAC1C,UAAI,CAAC,KAAK,CAAC,MAAX,EAAmB;AACjB,QAAA,cAAc,CACZ,CAAC,CACC,0CADD,EAEC,aAFD,EAGC,KAAK,CAAC,OAAN,IAAiB,KAAK,CAAC,KAHxB,CADW,CAAd;AAOA,eAAO,KAAP;AACD;AACD,UAAI,qBAAqB,CAAC,KAAK,CAAC,MAAP,CAAzB,EAAyC;AACvC,QAAA,cAAc,CACZ,CAAC,CACC,0CADD,EAEC,aAFD,EAGC,KAAK,CAAC,MAAN,CAAa,GAAb,CAAiB,CAAA,OAAO,KAAI,OAAO,CAAC,OAApC,EAA6C,IAA7C,CAAkD,IAAlD,CAHD,CADW,CAAd;AAOD,OARD;AAQO;AACL,QAAA,WAAW,CAAC;AACV,UAAA,eAAe,EAAE,kBAAkB,CAAC,KAAK,CAAC,MAAP,CADzB;AAEV,UAAA,aAAa,EAAE,gBAAgB,CAAC,KAAK,CAAC,MAAP,CAFrB,EAAD,CAAX;;AAID;AACD,aAAO,KAAP;AACD,KA1BD,CAPG;AAmCJ,IAAA,OAnCI,CAmCI,MAAK;AACZ,MAAA,WAAW,CAAC,EAAE,OAAO,EAAE,KAAX,EAAD,CAAX;AACD,KArCI,CAAP;AAsCD,GAjE+B,EAkEhC,EAlEgC,CAAlC;AAqEA,SAAO,EAAE,KAAF,EAAS,cAAT,EAAP;AACD,C,cArFe,iB;AAuFhB,IAAK,gBAAL;AAAA,CAAA,UAAK,gBAAL,EAAqB;AACnB,EAAA,gBAAA,CAAA,OAAA,CAAA,GAAA,OAAA;AACA,EAAA,gBAAA,CAAA,WAAA,CAAA,GAAA,WAAA;AACD,CAHD,EAAK,gBAAgB,KAAhB,gBAAgB,GAAA,EAAA,CAArB;AAYA,MAAM,YAAY,GAAG;AACnB,EAAA,KAAK,EAAE,OAAO,CAAiD;AAC7D,IAAA,WAAW,EAAE,OADgD;AAE7D,IAAA,MAAM,EAAE,KAFqD;AAG7D,IAAA,QAAQ,EAAE,gCAHmD,EAAjD,CADK;;AAMnB,EAAA,SAAS,EAAE,OAAO,CAAiD;AACjE,IAAA,WAAW,EAAE,OADoD;AAEjE,IAAA,MAAM,EAAE,KAFyD;AAGjE,IAAA,QAAQ,EAAE,oCAHuD,EAAjD,CANC,EAArB;;;AAaA,OAAM,SAAU,iBAAV,CACJ,IADI,EAEJ,GAFI,EAGJ,cAHI,EAGqC;AAEzC,QAAM,CAAC,cAAD,EAAiB,iBAAjB,IAAsC,QAAQ,CAAiB,EAAjB,CAApD;AAEA,QAAM,oBAAoB,GAAG,CAAC,MAAD,KAC3B,iBAAiB,CAAC,CAAA,YAAY,MAAK,EAAE,GAAG,YAAL,EAAmB,GAAG,MAAtB,EAAL,CAAb,CADnB;AAGA,EAAA,SAAS,CAAC,MAAK;AACb,QAAI,CAAC,GAAG,CAAC,MAAT,EAAiB;AACf;AACD;AACD,IAAA,YAAY,CAAC,IAAD,CAAZ,CAAmB,GAAnB,EAAwB,IAAxB,CACE,CAAC,EAAE,MAAF,EAAD,KAAe;AACb,YAAM,MAAM,GAAG,MAAM,CAAC,MAAP,CAAc,CAAC,GAAD,EAAM,OAAN,KAAiB;AAC5C,QAAA,GAAG,CAAC,OAAO,CAAC,EAAT,CAAH,GAAkB,OAAO,CAAC,KAA1B;AACA,eAAO,GAAP;AACD,OAHc,EAGZ,EAHY,CAAf;AAIA,MAAA,oBAAoB,CAAC,MAAD,CAApB;AACD,KAPH,EAQE,kBAAkB,CAAC,CAAA,MAAM,KACvB,cAAc,CACZ,CAAC,CAAC,qDAAD,EAAwD,MAAxD,CADW,CADE,CARpB;AAcD,GAlBQ,EAkBN,CAAC,GAAD,EAAM,IAAN,EAAY,cAAZ,CAlBM,CAAT;AAoBA,QAAM,YAAY,GAAG,WAAW,CAC9B,CAAC,EAAD,EAAa,SAAb,KAAmC;AACjC,UAAM,SAAS,GAAG,SAAS,GAAG,UAAH,GAAgB,QAA3C;AACA,IAAA,cAAc,CAAC,GAAf,CAAmB;AACjB,MAAA,QAAQ,EAAE,qBACR,IAAI,KAAK,OAAT,GAAmB,gBAAgB,CAAC,KAApC,GAA4C,gBAAgB,CAAC,SAC/D,IAAI,EAAE,IAAI,SAAS,GAHF,EAAnB;AAIG,IAAA,IAJH,CAKE,CAAC,EAAE,IAAF,EAAD,KAAa;AACX,MAAA,oBAAoB,CAAC;AACnB,SAAC,EAAD,GAAO,CAAA,IAA0B,QAA1B,YAAA,IAA0B,CAAE,KAA5B,IAAoC,CADxB,EAAD,CAApB;;AAGD,KATH,EAUE,kBAAkB,CAAC,CAAA,MAAM,KACvB,cAAc,CACZ,CAAC,CAAC,mDAAD,EAAsD,MAAtD,CADW,CADE,CAVpB;AAgBD,GAnB6B,EAoB9B,CAAC,IAAD,CApB8B,CAAhC;AAuBA,SAAO,CAAC,YAAD,EAAe,cAAf,CAAP;AACD,C,cAtDe,iB;AAwDhB,OAAO,MAAM,iBAAiB,GAAG,CAC/B,SAD+B,EAE/B,MAF+B,KAG7B;AACF,QAAM,CACJ,qBADI,EAEJ,wBAFI,IAGF,QAAQ,CAAe,IAAf,CAHZ;AAKA,WAAS,kBAAT,CAA4B,KAA5B,EAAwC;AACtC,IAAA,wBAAwB,CAAC;AACvB,MAAA,QAAQ,EAAE,KAAK,CAAC,EADO;AAEvB,MAAA,UAAU,EAAE,KAAK,CAAC,UAFK;AAGvB,MAAA,WAAW,EAAE,KAAK,CAAC,WAHI;AAIvB,MAAA,aAAa,EAAE,KAAK,CAAC,aAJE;AAKvB,MAAA,YAAY,EAAE,KAAK,CAAC,YALG;AAMvB,MAAA,qBAAqB,EAAE,KAAK,CAAC,qBANN,EAAD,CAAxB;;AAQD;AAED,WAAS,mBAAT,GAA4B;AAC1B,IAAA,wBAAwB,CAAC,IAAD,CAAxB;AACD;AAED,WAAS,kBAAT,CAA4B,KAA5B,EAAwC;AACtC;AACA,UAAM,SAAS,GAAG,MAAM,CAAC,GAAP,CAAW,CAAC,KAAD,KAC3B,KAAK,CAAC,EAAN,KAAa,KAAK,CAAC,EAAnB,GAAwB,EAAE,GAAG,KAAL,EAAY,GAAG,KAAf,EAAxB,GAAiD,KADjC,CAAlB;AAGA,IAAA,SAAS,CAAC,SAAD,CAAT;AACD;AAED,SAAO;AACL,IAAA,qBADK;AAEL,IAAA,kBAFK;AAGL,IAAA,kBAHK;AAIL,IAAA,mBAJK,EAAP;;AAMD,CAtCM,C,cAAM,iB;AAwCb,OAAO,MAAM,aAAa,GAAG,CAC3B,EAD2B,EAE3B,cAF2B,EAG3B,eAH2B,KAIzB;AACF,EAAA,mBAAmB,CACjB,GAAG,MAAM,CAAC,QAAP,CAAgB,MAAM,iCAAiC,EAAE,EAD3C,CAAnB;AAGG,EAAA,IAHH,CAGQ,MAAK;AACT,IAAA,eAAe,CAAC,CAAC,CAAC,cAAD,CAAF,CAAf;AACD,GALH;AAMG,EAAA,KANH,CAMS,MAAK;AACV,IAAA,cAAc,CAAC,CAAC,CAAC,+CAAD,CAAF,CAAd;AACD,GARH;AASD,CAdM;AAgBP,OAAO,MAAM,iBAAiB,GAAG,MAAM,YAAY,CAAC,SAA7C;AAEP,OAAO,MAAM,kBAAkB,GAAG,MAAM,YAAY,CAAC,oBAA9C;AACP,OAAO,MAAM,6BAA6B,GAAG,MAC3C,YAAY,CAAC,uBADR;AAGP,OAAO,MAAM,sBAAsB,GAAG,CACpC,UADoC,EAEpC,cAFoC,EAGpC,eAHoC,KAIlC;AACF,EAAA,cAAc,CAAC,IAAf,CAAoB;AAClB,IAAA,QAAQ,EAAE,iCADQ;AAElB,IAAA,IAAI,EAAE,IAAI,CAAC,SAAL,CAAe,UAAf,CAFY;AAGlB,IAAA,OAAO,EAAE,EAAE,gBAAgB,kBAAlB,EAHS,EAApB;AAIG,EAAA,IAJH,CAKE,MAAK;AACH,IAAA,eAAe,CAAC,CAAC,CAAC,wBAAD,CAAF,CAAf;AACD,GAPH,EAQE,kBAAkB,CAAC,CAAC,MAAD,KAAuD;AACxE,IAAA,cAAc,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,SAAD,CAAW,GAAG,kBAAkB,CAAC,MAAD,CAAQ,EAA7C,CAAF,CAAd;AACD,GAFiB,CARpB;AAYD,CAjBM;AAmBP,OAAM,SAAU,qBAAV,GAA+B;AACnC,QAAM,CAAC,YAAD,EAAe,eAAf,IAAkC,QAAQ,CAAoB,IAApB,CAAhD;AAEA,QAAM,YAAY,GAAG,WAAW,CAAC,MAAK;AACpC,IAAA,cAAc,CAAC,GAAf,CAAmB;AACjB,MAAA,QAAQ,EAAE,6BADO,EAAnB;AAEG,IAAA,IAFH,CAEQ,CAAC,EAAE,IAAF,EAAD,KAAa;AACnB,MAAA,eAAe,CAAC,IAAD,CAAf;AACD,KAJD;AAKD,GAN+B,EAM7B,CAAC,eAAD,CAN6B,CAAhC;AAQA,SAAO,CAAC,YAAD,EAAe,YAAf,CAAP;AACD,C,cAZe,qB;AAchB,OAAM,SAAU,qBAAV,GAA+B;AACnC,QAAM,CAAC,gBAAD,EAAmB,mBAAnB,IAA0C,QAAQ,CACtD,IADsD,CAAxD;AAGA,QAAM,aAAa,GAAG,WAAW,CAC/B,CAAC,QAAD,EAA2C,QAAQ,GAAG,KAAtD,KAA+D;AAC7D,IAAA,cAAc,CAAC,IAAf,CAAoB;AAClB,MAAA,QAAQ,EAAE,sCADQ;AAElB,MAAA,IAAI,EAAE,IAAI,CAAC,SAAL,CAAe,QAAf,CAFY;AAGlB,MAAA,OAAO,EAAE,EAAE,gBAAgB,kBAAlB,EAHS,EAApB;;AAKG,IAAA,IALH,CAKQ,MAAK;AACT,MAAA,mBAAmB,CAAC,IAAD,CAAnB;AACD,KAPH;AAQG,IAAA,KARH,CAQS,CAAA,CAAC,KAAG;AACT,UAAI,OAAO,CAAC,CAAC,IAAT,KAAkB,UAAtB,EAAkC;AAChC,QAAA,CAAC,CAAC,IAAF,GAAS,IAAT,CAAc,CAAC,EAAE,MAAM,GAAG,EAAX,EAAD,KAAgC;AAC5C,gBAAM,YAAY,GAAG,MAAM;AACxB,UAAA,MADkB,CACX,CAAC,KAAD,KAAkC;AACxC,kBAAM,mBAAmB,GAAG,CAAC;AAC3B,iDAD2B;AAE3B,4CAF2B;AAG3B,YAAA,QAH2B,CAGlB,KAAK,CAAC,UAHY,CAA7B;AAIA,mBAAO,mBAAmB,IAAI,QAA9B;AACD,WAPkB;AAQlB,UAAA,MARkB,CASjB,CACE,GADF,EAEE,EACE,UADF,EAEE,KAFF,EAGE,OAHF,EAFF,KAoBI;AACF,gBAAI,KAAK,CAAC,OAAV,EAAmB;AACjB,kBAAI,KAAK,CAAC,OAAN,CAAc,IAAlB,EAAwB;AACtB,uBAAO;AACL,qBAAG,GADE;AAEL,kBAAA,UAFK;AAGL,mBAAC,KAAK,CAAC,OAAN,CAAc,GAAf,GAAqB;AACnB,oBAAA,IAAI,EAAE,OADa,EAHhB,EAAP;;;AAOD;AACD,kBAAI,KAAK,CAAC,OAAN,CAAc,GAAlB,EAAuB;AACrB,uBAAO;AACL,qBAAG,GADE;AAEL,kBAAA,UAFK;AAGL,mBAAC,KAAK,CAAC,OAAN,CAAc,GAAf,GAAqB;AACnB,oBAAA,GAAG,EAAE,OADc,EAHhB,EAAP;;;AAOD;AAED,qBAAO;AACL,mBAAG,GADE;AAEL,gBAAA,UAFK;AAGL,iBAAC,KAAK,CAAC,OAAN,CAAc,GAAf,GAAqB;AACnB,kBAAA,IAAI,EAAE,OADa;AAEnB,kBAAA,GAAG,EAAE,OAFc,EAHhB,EAAP;;;AAQD;AACD;AACA;AACA;AACA,gBAAI,KAAK,CAAC,OAAV,EAAmB;AACjB,qBAAO;AACL,mBAAG,GADE;AAEL,iBAAC,KAAK,CAAC,OAAN,CAAc,CAAd,CAAD,GAAoB,OAFf;AAGL,gBAAA,UAHK,EAAP;;AAKD;AACD,gBAAI,KAAK,CAAC,OAAV,EAAmB;AACjB,qBAAO;AACL,mBAAG,GADE;AAEL,gBAAA,UAFK;AAGL,mBAAG,MAAM,CAAC,MAAP,CACD,EADC,EAED,GAAG,KAAK,CAAC,OAAN,CAAc,GAAd,CAAkB,CAAA,KAAK,MAAK;AAC7B,mBAAC,KAAD,GAAS,0BADoB,EAAL,CAAvB,CAFF,CAHE,EAAP;;;AAUD;AACD,mBAAO,GAAP;AACD,WAlFgB,EAmFjB,EAnFiB,CAArB;AAqFA,UAAA,mBAAmB,CAAC,YAAD,CAAnB;AACD,SAvFD;AAwFD,OAzFD;AAyFO;AACL;AACA,QAAA,OAAO,CAAC,KAAR,CAAc,CAAd;AACD;AACF,KAtGH;AAuGD,GAzG8B,EA0G/B,CAAC,mBAAD,CA1G+B,CAAjC;AA6GA,SAAO,CAAC,gBAAD,EAAmB,aAAnB,EAAkC,mBAAlC,CAAP;AACD,C,cAlHe,qB,0QA1lBV,kB,6HAgBU,mB,8HA6JA,qB,gIAsKA,iB,4HAuFX,gB,2HAYC,Y,uHAaU,iB,4HAwDH,iB,4HAwCA,a,wHAgBA,iB,4HAEA,kB,6HACA,6B,wIAGA,sB,iIAmBG,qB,gIAcA,qB","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { useState, useEffect, useCallback } from 'react';\nimport { makeApi, SupersetClient, t, JsonObject } from '@superset-ui/core';\n\nimport {\n  createErrorHandler,\n  getAlreadyExists,\n  getPasswordsNeeded,\n  hasTerminalValidation,\n} from 'src/views/CRUD/utils';\nimport { FetchDataConfig } from 'src/components/ListView';\nimport { FilterValue } from 'src/components/ListView/types';\nimport Chart, { Slice } from 'src/types/Chart';\nimport copyTextToClipboard from 'src/utils/copy';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport SupersetText from 'src/utils/textUtils';\nimport { FavoriteStatus, ImportResourceName, DatabaseObject } from './types';\n\ninterface ListViewResourceState<D extends object = any> {\n  loading: boolean;\n  collection: D[];\n  count: number;\n  permissions: string[];\n  lastFetchDataConfig: FetchDataConfig | null;\n  bulkSelectEnabled: boolean;\n  lastFetched?: string;\n}\n\nconst parsedErrorMessage = (\n  errorMessage: Record<string, string[] | string> | string,\n) => {\n  if (typeof errorMessage === 'string') {\n    return errorMessage;\n  }\n  return Object.entries(errorMessage)\n    .map(([key, value]) => {\n      if (Array.isArray(value)) {\n        return `(${key}) ${value.join(', ')}`;\n      }\n      return `(${key}) ${value}`;\n    })\n    .join('\\n');\n};\n\nexport function useListViewResource<D extends object = any>(\n  resource: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n  infoEnable = true,\n  defaultCollectionValue: D[] = [],\n  baseFilters?: FilterValue[], // must be memoized\n  initialLoadingState = true,\n) {\n  const [state, setState] = useState<ListViewResourceState<D>>({\n    count: 0,\n    collection: defaultCollectionValue,\n    loading: initialLoadingState,\n    lastFetchDataConfig: null,\n    permissions: [],\n    bulkSelectEnabled: false,\n  });\n\n  function updateState(update: Partial<ListViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  function toggleBulkSelect() {\n    updateState({ bulkSelectEnabled: !state.bulkSelectEnabled });\n  }\n\n  useEffect(() => {\n    if (!infoEnable) return;\n    SupersetClient.get({\n      endpoint: `/api/v1/${resource}/_info?q=${rison.encode({\n        keys: ['permissions'],\n      })}`,\n    }).then(\n      ({ json: infoJson = {} }) => {\n        updateState({\n          permissions: infoJson.permissions,\n        });\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t(\n            'An error occurred while fetching %s info: %s',\n            resourceLabel,\n            errMsg,\n          ),\n        ),\n      ),\n    );\n  }, []);\n\n  function hasPerm(perm: string) {\n    if (!state.permissions.length) {\n      return false;\n    }\n\n    return Boolean(state.permissions.find(p => p === perm));\n  }\n\n  const fetchData = useCallback(\n    ({\n      pageIndex,\n      pageSize,\n      sortBy,\n      filters: filterValues,\n    }: FetchDataConfig) => {\n      // set loading state, cache the last config for refreshing data.\n      updateState({\n        lastFetchDataConfig: {\n          filters: filterValues,\n          pageIndex,\n          pageSize,\n          sortBy,\n        },\n        loading: true,\n      });\n\n      const filterExps = (baseFilters || [])\n        .concat(filterValues)\n        .map(({ id, operator: opr, value }) => ({\n          col: id,\n          opr,\n          value:\n            value && typeof value === 'object' && 'value' in value\n              ? value.value\n              : value,\n        }));\n\n      const queryParams = rison.encode({\n        order_column: sortBy[0].id,\n        order_direction: sortBy[0].desc ? 'desc' : 'asc',\n        page: pageIndex,\n        page_size: pageSize,\n        ...(filterExps.length ? { filters: filterExps } : {}),\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/${resource}/?q=${queryParams}`,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              collection: json.result,\n              count: json.count,\n              lastFetched: new Date().toISOString(),\n            });\n          },\n          createErrorHandler(errMsg =>\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                errMsg,\n              ),\n            ),\n          ),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [baseFilters],\n  );\n\n  return {\n    state: {\n      loading: state.loading,\n      resourceCount: state.count,\n      resourceCollection: state.collection,\n      bulkSelectEnabled: state.bulkSelectEnabled,\n      lastFetched: state.lastFetched,\n    },\n    setResourceCollection: (update: D[]) =>\n      updateState({\n        collection: update,\n      }),\n    hasPerm,\n    fetchData,\n    toggleBulkSelect,\n    refreshData: (provideConfig?: FetchDataConfig) => {\n      if (state.lastFetchDataConfig) {\n        return fetchData(state.lastFetchDataConfig);\n      }\n      if (provideConfig) {\n        return fetchData(provideConfig);\n      }\n      return null;\n    },\n  };\n}\n\n// In the same vein as above, a hook for viewing a single instance of a resource (given id)\ninterface SingleViewResourceState<D extends object = any> {\n  loading: boolean;\n  resource: D | null;\n  error: any | null;\n}\n\nexport function useSingleViewResource<D extends object = any>(\n  resourceName: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n) {\n  const [state, setState] = useState<SingleViewResourceState<D>>({\n    loading: false,\n    resource: null,\n    error: null,\n  });\n\n  function updateState(update: Partial<SingleViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const fetchResource = useCallback(\n    (resourceID: number) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/${resourceName}/${resourceID}`,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: json.result,\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                parsedErrorMessage(errMsg),\n              ),\n            );\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const createResource = useCallback(\n    (resource: D, hideToast = false) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { id: json.id, ...json.result },\n              error: null,\n            });\n            return json.id;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            // we did not want toasts for db-connection-ui but did not want to disable it everywhere\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while creating %ss: %s',\n                  resourceLabel,\n                  parsedErrorMessage(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const updateResource = useCallback(\n    (resourceID: number, resource: D, hideToast = false) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.put({\n        endpoint: `/api/v1/${resourceName}/${resourceID}`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { ...json.result, id: json.id },\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler(errMsg => {\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while fetching %ss: %s',\n                  resourceLabel,\n                  JSON.stringify(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n\n            return errMsg;\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n  const clearError = () =>\n    updateState({\n      error: null,\n    });\n\n  return {\n    state,\n    setResource: (update: D) =>\n      updateState({\n        resource: update,\n      }),\n    fetchResource,\n    createResource,\n    updateResource,\n    clearError,\n  };\n}\n\ninterface ImportResourceState {\n  loading: boolean;\n  passwordsNeeded: string[];\n  alreadyExists: string[];\n}\n\nexport function useImportResource(\n  resourceName: ImportResourceName,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n) {\n  const [state, setState] = useState<ImportResourceState>({\n    loading: false,\n    passwordsNeeded: [],\n    alreadyExists: [],\n  });\n\n  function updateState(update: Partial<ImportResourceState>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const importResource = useCallback(\n    (\n      bundle: File,\n      databasePasswords: Record<string, string> = {},\n      overwrite = false,\n    ) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      const formData = new FormData();\n      formData.append('formData', bundle);\n\n      /* The import bundle never contains database passwords; if required\n       * they should be provided by the user during import.\n       */\n      if (databasePasswords) {\n        formData.append('passwords', JSON.stringify(databasePasswords));\n      }\n      /* If the imported model already exists the user needs to confirm\n       * that they want to overwrite it.\n       */\n      if (overwrite) {\n        formData.append('overwrite', 'true');\n      }\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/import/`,\n        body: formData,\n        headers: { Accept: 'application/json' },\n      })\n        .then(() => true)\n        .catch(response =>\n          getClientErrorObject(response).then(error => {\n            if (!error.errors) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  error.message || error.error,\n                ),\n              );\n              return false;\n            }\n            if (hasTerminalValidation(error.errors)) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  error.errors.map(payload => payload.message).join('\\n'),\n                ),\n              );\n            } else {\n              updateState({\n                passwordsNeeded: getPasswordsNeeded(error.errors),\n                alreadyExists: getAlreadyExists(error.errors),\n              });\n            }\n            return false;\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [],\n  );\n\n  return { state, importResource };\n}\n\nenum FavStarClassName {\n  CHART = 'slice',\n  DASHBOARD = 'Dashboard',\n}\n\ntype FavoriteStatusResponse = {\n  result: Array<{\n    id: string;\n    value: boolean;\n  }>;\n};\n\nconst favoriteApis = {\n  chart: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/chart/favorite_status/',\n  }),\n  dashboard: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/dashboard/favorite_status/',\n  }),\n};\n\nexport function useFavoriteStatus(\n  type: 'chart' | 'dashboard',\n  ids: Array<string | number>,\n  handleErrorMsg: (message: string) => void,\n) {\n  const [favoriteStatus, setFavoriteStatus] = useState<FavoriteStatus>({});\n\n  const updateFavoriteStatus = (update: FavoriteStatus) =>\n    setFavoriteStatus(currentState => ({ ...currentState, ...update }));\n\n  useEffect(() => {\n    if (!ids.length) {\n      return;\n    }\n    favoriteApis[type](ids).then(\n      ({ result }) => {\n        const update = result.reduce((acc, element) => {\n          acc[element.id] = element.value;\n          return acc;\n        }, {});\n        updateFavoriteStatus(update);\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t('There was an error fetching the favorite status: %s', errMsg),\n        ),\n      ),\n    );\n  }, [ids, type, handleErrorMsg]);\n\n  const saveFaveStar = useCallback(\n    (id: number, isStarred: boolean) => {\n      const urlSuffix = isStarred ? 'unselect' : 'select';\n      SupersetClient.get({\n        endpoint: `/superset/favstar/${\n          type === 'chart' ? FavStarClassName.CHART : FavStarClassName.DASHBOARD\n        }/${id}/${urlSuffix}/`,\n      }).then(\n        ({ json }) => {\n          updateFavoriteStatus({\n            [id]: (json as { count: number })?.count > 0,\n          });\n        },\n        createErrorHandler(errMsg =>\n          handleErrorMsg(\n            t('There was an error saving the favorite status: %s', errMsg),\n          ),\n        ),\n      );\n    },\n    [type],\n  );\n\n  return [saveFaveStar, favoriteStatus] as const;\n}\n\nexport const useChartEditModal = (\n  setCharts: (charts: Array<Chart>) => void,\n  charts: Array<Chart>,\n) => {\n  const [\n    sliceCurrentlyEditing,\n    setSliceCurrentlyEditing,\n  ] = useState<Slice | null>(null);\n\n  function openChartEditModal(chart: Chart) {\n    setSliceCurrentlyEditing({\n      slice_id: chart.id,\n      slice_name: chart.slice_name,\n      description: chart.description,\n      cache_timeout: chart.cache_timeout,\n      certified_by: chart.certified_by,\n      certification_details: chart.certification_details,\n    });\n  }\n\n  function closeChartEditModal() {\n    setSliceCurrentlyEditing(null);\n  }\n\n  function handleChartUpdated(edits: Chart) {\n    // update the chart in our state with the edited info\n    const newCharts = charts.map((chart: Chart) =>\n      chart.id === edits.id ? { ...chart, ...edits } : chart,\n    );\n    setCharts(newCharts);\n  }\n\n  return {\n    sliceCurrentlyEditing,\n    handleChartUpdated,\n    openChartEditModal,\n    closeChartEditModal,\n  };\n};\n\nexport const copyQueryLink = (\n  id: number,\n  addDangerToast: (arg0: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  copyTextToClipboard(\n    `${window.location.origin}/superset/sqllab?savedQueryId=${id}`,\n  )\n    .then(() => {\n      addSuccessToast(t('Link Copied!'));\n    })\n    .catch(() => {\n      addDangerToast(t('Sorry, your browser does not support copying.'));\n    });\n};\n\nexport const getDatabaseImages = () => SupersetText.DB_IMAGES;\n\nexport const getConnectionAlert = () => SupersetText.DB_CONNECTION_ALERTS;\nexport const getDatabaseDocumentationLinks = () =>\n  SupersetText.DB_CONNECTION_DOC_LINKS;\n\nexport const testDatabaseConnection = (\n  connection: DatabaseObject,\n  handleErrorMsg: (errorMsg: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  SupersetClient.post({\n    endpoint: 'api/v1/database/test_connection',\n    body: JSON.stringify(connection),\n    headers: { 'Content-Type': 'application/json' },\n  }).then(\n    () => {\n      addSuccessToast(t('Connection looks good!'));\n    },\n    createErrorHandler((errMsg: Record<string, string[] | string> | string) => {\n      handleErrorMsg(t(`${t('ERROR: ')}${parsedErrorMessage(errMsg)}`));\n    }),\n  );\n};\n\nexport function useAvailableDatabases() {\n  const [availableDbs, setAvailableDbs] = useState<JsonObject | null>(null);\n\n  const getAvailable = useCallback(() => {\n    SupersetClient.get({\n      endpoint: `/api/v1/database/available/`,\n    }).then(({ json }) => {\n      setAvailableDbs(json);\n    });\n  }, [setAvailableDbs]);\n\n  return [availableDbs, getAvailable] as const;\n}\n\nexport function useDatabaseValidation() {\n  const [validationErrors, setValidationErrors] = useState<JsonObject | null>(\n    null,\n  );\n  const getValidation = useCallback(\n    (database: Partial<DatabaseObject> | null, onCreate = false) => {\n      SupersetClient.post({\n        endpoint: '/api/v1/database/validate_parameters',\n        body: JSON.stringify(database),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(() => {\n          setValidationErrors(null);\n        })\n        .catch(e => {\n          if (typeof e.json === 'function') {\n            e.json().then(({ errors = [] }: JsonObject) => {\n              const parsedErrors = errors\n                .filter((error: { error_type: string }) => {\n                  const skipValidationError = ![\n                    'CONNECTION_MISSING_PARAMETERS_ERROR',\n                    'CONNECTION_ACCESS_DENIED_ERROR',\n                  ].includes(error.error_type);\n                  return skipValidationError || onCreate;\n                })\n                .reduce(\n                  (\n                    obj: {},\n                    {\n                      error_type,\n                      extra,\n                      message,\n                    }: {\n                      error_type: string;\n                      extra: {\n                        invalid?: string[];\n                        missing?: string[];\n                        name: string;\n                        catalog: {\n                          name: string;\n                          url: string;\n                          idx: number;\n                        };\n                      };\n                      message: string;\n                    },\n                  ) => {\n                    if (extra.catalog) {\n                      if (extra.catalog.name) {\n                        return {\n                          ...obj,\n                          error_type,\n                          [extra.catalog.idx]: {\n                            name: message,\n                          },\n                        };\n                      }\n                      if (extra.catalog.url) {\n                        return {\n                          ...obj,\n                          error_type,\n                          [extra.catalog.idx]: {\n                            url: message,\n                          },\n                        };\n                      }\n\n                      return {\n                        ...obj,\n                        error_type,\n                        [extra.catalog.idx]: {\n                          name: message,\n                          url: message,\n                        },\n                      };\n                    }\n                    // if extra.invalid doesn't exist then the\n                    // error can't be mapped to a parameter\n                    // so leave it alone\n                    if (extra.invalid) {\n                      return {\n                        ...obj,\n                        [extra.invalid[0]]: message,\n                        error_type,\n                      };\n                    }\n                    if (extra.missing) {\n                      return {\n                        ...obj,\n                        error_type,\n                        ...Object.assign(\n                          {},\n                          ...extra.missing.map(field => ({\n                            [field]: 'This is a required field',\n                          })),\n                        ),\n                      };\n                    }\n                    return obj;\n                  },\n                  {},\n                );\n              setValidationErrors(parsedErrors);\n            });\n          } else {\n            // eslint-disable-next-line no-console\n            console.error(e);\n          }\n        });\n    },\n    [setValidationErrors],\n  );\n\n  return [validationErrors, getValidation, setValidationErrors] as const;\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}