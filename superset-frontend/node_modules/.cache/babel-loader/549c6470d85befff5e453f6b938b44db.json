{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/PropertiesModal/index.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState, useCallback, useEffect } from 'react';\nimport Modal from 'src/components/Modal';\nimport { Form, Row, Col, Input, TextArea } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport rison from 'rison';\nimport { t, SupersetClient, styled } from '@superset-ui/core';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst FormItem = Form.Item;\nconst StyledFormItem = styled(Form.Item)`\n  margin-bottom: 0;\n`;\nconst StyledHelpBlock = styled.span`\n  margin-bottom: 0;\n`;\nexport default function PropertiesModal({ slice, onHide, onSave, show }) {\n  const [submitting, setSubmitting] = useState(false);\n  const [form] = Form.useForm();\n  // values of form inputs\n  const [name, setName] = useState(slice.slice_name || '');\n  const [selectedOwners, setSelectedOwners] = useState(null);\n  function showError({ error, statusText, message }) {\n    let errorText = error || statusText || t('An error has occurred');\n    if (message === 'Forbidden') {\n      errorText = t('You do not have permission to edit this chart');\n    }\n    Modal.error({\n      title: 'Error',\n      content: errorText,\n      okButtonProps: { danger: true, className: 'btn-danger' } });\n\n  }\n  const fetchChartOwners = useCallback(async function fetchChartOwners() {\n    try {\n      const response = await SupersetClient.get({\n        endpoint: `/api/v1/chart/${slice.slice_id}` });\n\n      const chart = response.json.result;\n      setSelectedOwners(chart.owners.map((owner) => ({\n        value: owner.id,\n        label: `${owner.first_name} ${owner.last_name}` })));\n\n    }\n    catch (response) {\n      const clientError = await getClientErrorObject(response);\n      showError(clientError);\n    }\n  }, [slice.slice_id]);\n  const loadOptions = useMemo(() => (input = '', page, pageSize) => {\n    const query = rison.encode({\n      filter: input,\n      page,\n      page_size: pageSize });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/chart/related/owners?q=${query}` }).\n    then((response) => ({\n      data: response.json.result.map((item) => ({\n        value: item.value,\n        label: item.text })),\n\n      totalCount: response.json.count }));\n\n  }, []);\n  const onSubmit = async (values) => {\n    setSubmitting(true);\n    const { certified_by: certifiedBy, certification_details: certificationDetails, description, cache_timeout: cacheTimeout } = values;\n    const payload = {\n      slice_name: name || null,\n      description: description || null,\n      cache_timeout: cacheTimeout || null,\n      certified_by: certifiedBy || null,\n      certification_details: certifiedBy && certificationDetails ? certificationDetails : null };\n\n    if (selectedOwners) {\n      payload.owners = selectedOwners.map((o) => o.value);\n    }\n    try {\n      const res = await SupersetClient.put({\n        endpoint: `/api/v1/chart/${slice.slice_id}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload) });\n\n      // update the redux state\n      const updatedChart = {\n        ...res.json.result,\n        id: slice.slice_id };\n\n      onSave(updatedChart);\n      onHide();\n    }\n    catch (res) {\n      const clientError = await getClientErrorObject(res);\n      showError(clientError);\n    }\n    setSubmitting(false);\n  };\n  const ownersLabel = t('Owners');\n  // get the owners of this slice\n  useEffect(() => {\n    fetchChartOwners();\n  }, [fetchChartOwners]);\n  // update name after it's changed in another modal\n  useEffect(() => {\n    setName(slice.slice_name || '');\n  }, [slice.slice_name]);\n  return ___EmotionJSX(Modal, { show: show, onHide: onHide, title: \"Edit Chart Properties\", footer: ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Button, { \"data-test\": \"properties-modal-cancel-button\", htmlType: \"button\", buttonSize: \"small\", onClick: onHide, cta: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 126, columnNumber: 11 } },\n    t('Cancel')),\n\n    ___EmotionJSX(Button, { \"data-test\": \"properties-modal-save-button\", htmlType: \"submit\", buttonSize: \"small\", buttonStyle: \"primary\", onClick: form.submit, disabled: submitting || !name, cta: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 129, columnNumber: 11 } },\n    t('Save'))),\n\n    responsive: true, wrapProps: { 'data-test': 'properties-edit-modal' }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 125, columnNumber: 13 } },\n  ___EmotionJSX(Form, { form: form, onFinish: onSubmit, layout: \"vertical\", initialValues: {\n      name: slice.slice_name || '',\n      description: slice.description || '',\n      cache_timeout: slice.cache_timeout != null ? slice.cache_timeout : '',\n      certified_by: slice.certified_by || '',\n      certification_details: slice.certified_by && slice.certification_details ?\n      slice.certification_details :\n      '' }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 133, columnNumber: 7 } },\n\n  ___EmotionJSX(Row, { gutter: 16, __self: this, __source: { fileName: _jsxFileName, lineNumber: 142, columnNumber: 9 } },\n  ___EmotionJSX(Col, { xs: 24, md: 12, __self: this, __source: { fileName: _jsxFileName, lineNumber: 143, columnNumber: 11 } },\n  ___EmotionJSX(\"h3\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 144, columnNumber: 13 } }, t('Basic information')),\n  ___EmotionJSX(FormItem, { label: t('Name'), required: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 145, columnNumber: 13 } },\n  ___EmotionJSX(Input, { name: \"name\", \"data-test\": \"properties-modal-name-input\", type: \"text\", value: name, onChange: (event) => {var _event$target$value;return setName((_event$target$value = event.target.value) != null ? _event$target$value : '');}, __self: this, __source: { fileName: _jsxFileName, lineNumber: 146, columnNumber: 15 } })),\n\n  ___EmotionJSX(FormItem, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 148, columnNumber: 13 } },\n  ___EmotionJSX(StyledFormItem, { label: t('Description'), name: \"description\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 149, columnNumber: 15 } },\n  ___EmotionJSX(TextArea, { rows: 3, style: { maxWidth: '100%' }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 150, columnNumber: 17 } })),\n\n  ___EmotionJSX(StyledHelpBlock, { className: \"help-block\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 152, columnNumber: 15 } },\n  t('The description can be displayed as widget headers in the dashboard view. Supports markdown.'))),\n\n\n  ___EmotionJSX(\"h3\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 156, columnNumber: 13 } }, t('Certification')),\n  ___EmotionJSX(FormItem, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 157, columnNumber: 13 } },\n  ___EmotionJSX(StyledFormItem, { label: t('Certified by'), name: \"certified_by\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 158, columnNumber: 15 } },\n  ___EmotionJSX(Input, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 159, columnNumber: 17 } })),\n\n  ___EmotionJSX(StyledHelpBlock, { className: \"help-block\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 161, columnNumber: 15 } },\n  t('Person or group that has certified this chart.'))),\n\n\n  ___EmotionJSX(FormItem, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 165, columnNumber: 13 } },\n  ___EmotionJSX(StyledFormItem, { label: t('Certification details'), name: \"certification_details\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 166, columnNumber: 15 } },\n  ___EmotionJSX(Input, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 167, columnNumber: 17 } })),\n\n  ___EmotionJSX(StyledHelpBlock, { className: \"help-block\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 169, columnNumber: 15 } },\n  t('Any additional detail to show in the certification tooltip.')))),\n\n\n\n  ___EmotionJSX(Col, { xs: 24, md: 12, __self: this, __source: { fileName: _jsxFileName, lineNumber: 174, columnNumber: 11 } },\n  ___EmotionJSX(\"h3\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 175, columnNumber: 13 } }, t('Configuration')),\n  ___EmotionJSX(FormItem, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 176, columnNumber: 13 } },\n  ___EmotionJSX(StyledFormItem, { label: t('Cache timeout'), name: \"cacheTimeout\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 177, columnNumber: 15 } },\n  ___EmotionJSX(Input, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 178, columnNumber: 17 } })),\n\n  ___EmotionJSX(StyledHelpBlock, { className: \"help-block\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 180, columnNumber: 15 } },\n  t(\"Duration (in seconds) of the caching timeout for this chart. Note this defaults to the dataset's timeout if undefined.\"))),\n\n\n  ___EmotionJSX(\"h3\", { style: { marginTop: '1em' }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 184, columnNumber: 13 } }, t('Access')),\n  ___EmotionJSX(FormItem, { label: ownersLabel, __self: this, __source: { fileName: _jsxFileName, lineNumber: 185, columnNumber: 13 } },\n  ___EmotionJSX(Select, { ariaLabel: ownersLabel, mode: \"multiple\", name: \"owners\", value: selectedOwners || [], onChange: setSelectedOwners, options: loadOptions, disabled: !selectedOwners, allowClear: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 186, columnNumber: 15 } }),\n  ___EmotionJSX(StyledHelpBlock, { className: \"help-block\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 187, columnNumber: 15 } },\n  t('A list of users who can alter the chart. Searchable by name or username.')))))));\n\n\n\n\n\n\n}__signature__(PropertiesModal, \"useState{[submitting, setSubmitting](false)}\\nuseForm{[form]}\\nuseState{[name, setName](slice.slice_name || '')}\\nuseState{[selectedOwners, setSelectedOwners](null)}\\nuseCallback{fetchChartOwners}\\nuseMemo{loadOptions}\\nuseEffect{}\\nuseEffect{}\");;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(FormItem, \"FormItem\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/PropertiesModal/index.tsx\");reactHotLoader.register(StyledFormItem, \"StyledFormItem\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/PropertiesModal/index.tsx\");reactHotLoader.register(StyledHelpBlock, \"StyledHelpBlock\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/PropertiesModal/index.tsx\");reactHotLoader.register(PropertiesModal, \"PropertiesModal\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/PropertiesModal/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/PropertiesModal/index.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState, useCallback, useEffect } from 'react';\nimport Modal from 'src/components/Modal';\nimport { Form, Row, Col, Input, TextArea } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { SelectValue } from 'antd/lib/select';\nimport rison from 'rison';\nimport { t, SupersetClient, styled } from '@superset-ui/core';\nimport Chart, { Slice } from 'src/types/Chart';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\n\ntype PropertiesModalProps = {\n  slice: Slice;\n  show: boolean;\n  onHide: () => void;\n  onSave: (chart: Chart) => void;\n  permissionsError?: string;\n  existingOwners?: SelectValue;\n};\n\nconst FormItem = Form.Item;\n\nconst StyledFormItem = styled(Form.Item)`\n  margin-bottom: 0;\n`;\n\nconst StyledHelpBlock = styled.span`\n  margin-bottom: 0;\n`;\n\nexport default function PropertiesModal({\n  slice,\n  onHide,\n  onSave,\n  show,\n}: PropertiesModalProps) {\n  const [submitting, setSubmitting] = useState(false);\n  const [form] = Form.useForm();\n  // values of form inputs\n  const [name, setName] = useState(slice.slice_name || '');\n  const [selectedOwners, setSelectedOwners] = useState<SelectValue | null>(\n    null,\n  );\n\n  function showError({ error, statusText, message }: any) {\n    let errorText = error || statusText || t('An error has occurred');\n    if (message === 'Forbidden') {\n      errorText = t('You do not have permission to edit this chart');\n    }\n    Modal.error({\n      title: 'Error',\n      content: errorText,\n      okButtonProps: { danger: true, className: 'btn-danger' },\n    });\n  }\n\n  const fetchChartOwners = useCallback(\n    async function fetchChartOwners() {\n      try {\n        const response = await SupersetClient.get({\n          endpoint: `/api/v1/chart/${slice.slice_id}`,\n        });\n        const chart = response.json.result;\n        setSelectedOwners(\n          chart.owners.map((owner: any) => ({\n            value: owner.id,\n            label: `${owner.first_name} ${owner.last_name}`,\n          })),\n        );\n      } catch (response) {\n        const clientError = await getClientErrorObject(response);\n        showError(clientError);\n      }\n    },\n    [slice.slice_id],\n  );\n\n  const loadOptions = useMemo(\n    () => (input = '', page: number, pageSize: number) => {\n      const query = rison.encode({\n        filter: input,\n        page,\n        page_size: pageSize,\n      });\n      return SupersetClient.get({\n        endpoint: `/api/v1/chart/related/owners?q=${query}`,\n      }).then(response => ({\n        data: response.json.result.map(\n          (item: { value: number; text: string }) => ({\n            value: item.value,\n            label: item.text,\n          }),\n        ),\n        totalCount: response.json.count,\n      }));\n    },\n    [],\n  );\n\n  const onSubmit = async (values: {\n    certified_by?: string;\n    certification_details?: string;\n    description?: string;\n    cache_timeout?: number;\n  }) => {\n    setSubmitting(true);\n    const {\n      certified_by: certifiedBy,\n      certification_details: certificationDetails,\n      description,\n      cache_timeout: cacheTimeout,\n    } = values;\n    const payload: { [key: string]: any } = {\n      slice_name: name || null,\n      description: description || null,\n      cache_timeout: cacheTimeout || null,\n      certified_by: certifiedBy || null,\n      certification_details:\n        certifiedBy && certificationDetails ? certificationDetails : null,\n    };\n    if (selectedOwners) {\n      payload.owners = (selectedOwners as {\n        value: number;\n        label: string;\n      }[]).map(o => o.value);\n    }\n    try {\n      const res = await SupersetClient.put({\n        endpoint: `/api/v1/chart/${slice.slice_id}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(payload),\n      });\n      // update the redux state\n      const updatedChart = {\n        ...res.json.result,\n        id: slice.slice_id,\n      };\n      onSave(updatedChart);\n      onHide();\n    } catch (res) {\n      const clientError = await getClientErrorObject(res);\n      showError(clientError);\n    }\n    setSubmitting(false);\n  };\n\n  const ownersLabel = t('Owners');\n\n  // get the owners of this slice\n  useEffect(() => {\n    fetchChartOwners();\n  }, [fetchChartOwners]);\n\n  // update name after it's changed in another modal\n  useEffect(() => {\n    setName(slice.slice_name || '');\n  }, [slice.slice_name]);\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      title=\"Edit Chart Properties\"\n      footer={\n        <>\n          <Button\n            data-test=\"properties-modal-cancel-button\"\n            htmlType=\"button\"\n            buttonSize=\"small\"\n            onClick={onHide}\n            cta\n          >\n            {t('Cancel')}\n          </Button>\n          <Button\n            data-test=\"properties-modal-save-button\"\n            htmlType=\"submit\"\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            onClick={form.submit}\n            disabled={submitting || !name}\n            cta\n          >\n            {t('Save')}\n          </Button>\n        </>\n      }\n      responsive\n      wrapProps={{ 'data-test': 'properties-edit-modal' }}\n    >\n      <Form\n        form={form}\n        onFinish={onSubmit}\n        layout=\"vertical\"\n        initialValues={{\n          name: slice.slice_name || '',\n          description: slice.description || '',\n          cache_timeout: slice.cache_timeout != null ? slice.cache_timeout : '',\n          certified_by: slice.certified_by || '',\n          certification_details:\n            slice.certified_by && slice.certification_details\n              ? slice.certification_details\n              : '',\n        }}\n      >\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <h3>{t('Basic information')}</h3>\n            <FormItem label={t('Name')} required>\n              <Input\n                name=\"name\"\n                data-test=\"properties-modal-name-input\"\n                type=\"text\"\n                value={name}\n                onChange={(event: React.ChangeEvent<HTMLInputElement>) =>\n                  setName(event.target.value ?? '')\n                }\n              />\n            </FormItem>\n            <FormItem>\n              <StyledFormItem label={t('Description')} name=\"description\">\n                <TextArea rows={3} style={{ maxWidth: '100%' }} />\n              </StyledFormItem>\n              <StyledHelpBlock className=\"help-block\">\n                {t(\n                  'The description can be displayed as widget headers in the dashboard view. Supports markdown.',\n                )}\n              </StyledHelpBlock>\n            </FormItem>\n            <h3>{t('Certification')}</h3>\n            <FormItem>\n              <StyledFormItem label={t('Certified by')} name=\"certified_by\">\n                <Input />\n              </StyledFormItem>\n              <StyledHelpBlock className=\"help-block\">\n                {t('Person or group that has certified this chart.')}\n              </StyledHelpBlock>\n            </FormItem>\n            <FormItem>\n              <StyledFormItem\n                label={t('Certification details')}\n                name=\"certification_details\"\n              >\n                <Input />\n              </StyledFormItem>\n              <StyledHelpBlock className=\"help-block\">\n                {t(\n                  'Any additional detail to show in the certification tooltip.',\n                )}\n              </StyledHelpBlock>\n            </FormItem>\n          </Col>\n          <Col xs={24} md={12}>\n            <h3>{t('Configuration')}</h3>\n            <FormItem>\n              <StyledFormItem label={t('Cache timeout')} name=\"cacheTimeout\">\n                <Input />\n              </StyledFormItem>\n              <StyledHelpBlock className=\"help-block\">\n                {t(\n                  \"Duration (in seconds) of the caching timeout for this chart. Note this defaults to the dataset's timeout if undefined.\",\n                )}\n              </StyledHelpBlock>\n            </FormItem>\n            <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n            <FormItem label={ownersLabel}>\n              <Select\n                ariaLabel={ownersLabel}\n                mode=\"multiple\"\n                name=\"owners\"\n                value={selectedOwners || []}\n                onChange={setSelectedOwners}\n                options={loadOptions}\n                disabled={!selectedOwners}\n                allowClear\n              />\n              <StyledHelpBlock className=\"help-block\">\n                {t(\n                  'A list of users who can alter the chart. Searchable by name or username.',\n                )}\n              </StyledHelpBlock>\n            </FormItem>\n          </Col>\n        </Row>\n      </Form>\n    </Modal>\n  );\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}