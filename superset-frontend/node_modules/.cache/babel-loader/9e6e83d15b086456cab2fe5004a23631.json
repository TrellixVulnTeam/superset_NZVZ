{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter, {\nEXPRESSION_TYPES } from\n'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n  PropTypes.oneOfType([\n  columnType,\n  PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n  adhocMetricType])).\n\n  isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string) };\n\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst startingWidth = 320;\nconst startingHeight = 240;\nconst SectionWrapper = styled.div`\n  .ant-select {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n  }\n`;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n    padding-left: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-section {\n    display: inline-flex;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {var _this$props, _this$props$adhocFilt;\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: startingWidth,\n      height: startingHeight,\n      activeKey: ((_this$props = this.props) == null ? void 0 : (_this$props$adhocFilt = _this$props.adhocFilter) == null ? void 0 : _this$props$adhocFilt.expressionType) || 'SIMPLE' };\n\n\n    this.popoverContentRef = /*#__PURE__*/React.createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n      this.dragStartWidth + (e.clientX - this.dragStartX),\n      startingWidth),\n\n      height: Math.max(\n      this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n      startingHeight) });\n\n\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey });\n\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState((state) => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      sections = ['SIMPLE', 'CUSTOM_SQL'],\n      theme,\n      operators,\n      ...popoverProps } =\n    this.props;\n\n    const { adhocFilter } = this.state;\n\n    const resultSections =\n    (datasource == null ? void 0 : datasource.type) === 'druid' ?\n    sections.filter((s) => s !== 'CUSTOM_SQL') :\n    sections;\n\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges = !adhocFilter.equals(propsAdhocFilter);\n\n    const sectionRenders = {};\n\n    sectionRenders.CUSTOM_SQL =\n    ___EmotionJSX(ErrorBoundary, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 195, columnNumber: 7 } },\n    ___EmotionJSX(AdhocFilterEditPopoverSqlTabContent, {\n      adhocFilter: this.state.adhocFilter,\n      onChange: this.onAdhocFilterChange,\n      options: this.props.options,\n      height: this.state.height,\n      activeKey: this.state.activeKey, __self: this, __source: { fileName: _jsxFileName, lineNumber: 196, columnNumber: 9 } }));\n\n\n\n\n    sectionRenders.SIMPLE =\n    ___EmotionJSX(ErrorBoundary, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 207, columnNumber: 7 } },\n    ___EmotionJSX(AdhocFilterEditPopoverSimpleTabContent, {\n      operators: operators,\n      adhocFilter: this.state.adhocFilter,\n      onChange: this.onAdhocFilterChange,\n      options: options,\n      datasource: datasource,\n      onHeightChange: this.adjustHeight,\n      partitionColumn: partitionColumn,\n      popoverRef: this.popoverContentRef.current, __self: this, __source: { fileName: _jsxFileName, lineNumber: 208, columnNumber: 9 } }));\n\n\n\n\n    return (\n      ___EmotionJSX(FilterPopoverContentContainer, _extends({\n        id: \"filter-edit-popover\" },\n      popoverProps, {\n        \"data-test\": \"filter-edit-popover\",\n        ref: this.popoverContentRef, __self: this, __source: { fileName: _jsxFileName, lineNumber: 222, columnNumber: 7 } }),\n\n      resultSections.length > 1 ?\n      ___EmotionJSX(Tabs, {\n        id: \"adhoc-filter-edit-tabs\",\n        defaultActiveKey: adhocFilter.expressionType,\n        className: \"adhoc-filter-edit-tabs\",\n        \"data-test\": \"adhoc-filter-edit-tabs\",\n        style: { minHeight: this.state.height, width: this.state.width },\n        allowOverflow: true,\n        onChange: this.onTabChange, __self: this, __source: { fileName: _jsxFileName, lineNumber: 229, columnNumber: 11 } },\n\n      resultSections.includes('SIMPLE') &&\n      ___EmotionJSX(Tabs.TabPane, {\n        className: \"adhoc-filter-edit-tab\",\n        key: EXPRESSION_TYPES.SIMPLE,\n        tab: t('Simple'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 239, columnNumber: 15 } },\n\n      sectionRenders.SIMPLE),\n\n\n      resultSections.includes('CUSTOM_SQL') &&\n      ___EmotionJSX(Tabs.TabPane, {\n        className: \"adhoc-filter-edit-tab\",\n        key: EXPRESSION_TYPES.SQL,\n        tab: t('Custom SQL'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 248, columnNumber: 15 } },\n\n      sectionRenders.CUSTOM_SQL)) :\n\n\n\n\n      ___EmotionJSX(SectionWrapper, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 258, columnNumber: 11 } }, sectionRenders[resultSections[0]]),\n\n      ___EmotionJSX(\"div\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 260, columnNumber: 9 } },\n      ___EmotionJSX(Button, { buttonSize: \"small\", onClick: this.props.onClose, cta: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 261, columnNumber: 11 } },\n      t('Close')),\n\n      ___EmotionJSX(Button, {\n        \"data-test\": \"adhoc-filter-edit-popover-save-button\",\n        disabled: !stateIsValid,\n        buttonStyle:\n        hasUnsavedChanges && stateIsValid ? 'primary' : 'default',\n\n        buttonSize: \"small\",\n        className: \"m-r-5\",\n        onClick: this.onSave,\n        cta: true, __self: this, __source: { fileName: _jsxFileName, lineNumber: 264, columnNumber: 11 } },\n\n      t('Save')),\n\n      ___EmotionJSX(ResizeIcon, {\n        role: \"button\",\n        \"aria-label\": \"Resize\",\n        tabIndex: 0,\n        onMouseDown: this.onDragDown,\n        className: \"fa fa-expand edit-popover-resize text-muted\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 277, columnNumber: 11 } }))));\n\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nAdhocFilterEditPopover.propTypes = propTypes;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(ResizeIcon, \"ResizeIcon\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(startingWidth, \"startingWidth\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(startingHeight, \"startingHeight\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(SectionWrapper, \"SectionWrapper\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(FilterPopoverContentContainer, \"FilterPopoverContentContainer\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");reactHotLoader.register(AdhocFilterEditPopover, \"AdhocFilterEditPopover\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx"],"names":["React","PropTypes","Button","styled","t","ErrorBoundary","Tabs","adhocMetricType","AdhocFilter","EXPRESSION_TYPES","AdhocFilterEditPopoverSimpleTabContent","AdhocFilterEditPopoverSqlTabContent","columnType","propTypes","adhocFilter","instanceOf","isRequired","onChange","func","onClose","onResize","options","arrayOf","oneOfType","shape","saved_metric_name","string","datasource","object","partitionColumn","theme","sections","operators","ResizeIcon","i","gridUnit","startingWidth","startingHeight","SectionWrapper","div","FilterPopoverContentContainer","typography","sizes","xs","AdhocFilterEditPopover","Component","constructor","props","onSave","bind","onDragDown","onMouseMove","onMouseUp","onAdhocFilterChange","adjustHeight","onTabChange","state","width","height","activeKey","expressionType","popoverContentRef","createRef","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","setState","e","dragStartX","clientX","dragStartY","clientY","dragStartWidth","dragStartHeight","Math","max","heightDifference","render","propsAdhocFilter","popoverProps","resultSections","type","filter","s","stateIsValid","isValid","hasUnsavedChanges","equals","sectionRenders","CUSTOM_SQL","SIMPLE","current","length","minHeight","includes","SQL"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n};\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst startingWidth = 320;\nconst startingHeight = 240;\nconst SectionWrapper = styled.div`\n  .ant-select {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n  }\n`;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n    padding-left: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-section {\n    display: inline-flex;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: startingWidth,\n      height: startingHeight,\n      activeKey: this.props?.adhocFilter?.expressionType || 'SIMPLE',\n    };\n\n    this.popoverContentRef = React.createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        startingWidth,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n        startingHeight,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey,\n    });\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      sections = ['SIMPLE', 'CUSTOM_SQL'],\n      theme,\n      operators,\n      ...popoverProps\n    } = this.props;\n\n    const { adhocFilter } = this.state;\n\n    const resultSections =\n      datasource?.type === 'druid'\n        ? sections.filter(s => s !== 'CUSTOM_SQL')\n        : sections;\n\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges = !adhocFilter.equals(propsAdhocFilter);\n\n    const sectionRenders = {};\n\n    sectionRenders.CUSTOM_SQL = (\n      <ErrorBoundary>\n        <AdhocFilterEditPopoverSqlTabContent\n          adhocFilter={this.state.adhocFilter}\n          onChange={this.onAdhocFilterChange}\n          options={this.props.options}\n          height={this.state.height}\n          activeKey={this.state.activeKey}\n        />\n      </ErrorBoundary>\n    );\n\n    sectionRenders.SIMPLE = (\n      <ErrorBoundary>\n        <AdhocFilterEditPopoverSimpleTabContent\n          operators={operators}\n          adhocFilter={this.state.adhocFilter}\n          onChange={this.onAdhocFilterChange}\n          options={options}\n          datasource={datasource}\n          onHeightChange={this.adjustHeight}\n          partitionColumn={partitionColumn}\n          popoverRef={this.popoverContentRef.current}\n        />\n      </ErrorBoundary>\n    );\n\n    return (\n      <FilterPopoverContentContainer\n        id=\"filter-edit-popover\"\n        {...popoverProps}\n        data-test=\"filter-edit-popover\"\n        ref={this.popoverContentRef}\n      >\n        {resultSections.length > 1 ? (\n          <Tabs\n            id=\"adhoc-filter-edit-tabs\"\n            defaultActiveKey={adhocFilter.expressionType}\n            className=\"adhoc-filter-edit-tabs\"\n            data-test=\"adhoc-filter-edit-tabs\"\n            style={{ minHeight: this.state.height, width: this.state.width }}\n            allowOverflow\n            onChange={this.onTabChange}\n          >\n            {resultSections.includes('SIMPLE') && (\n              <Tabs.TabPane\n                className=\"adhoc-filter-edit-tab\"\n                key={EXPRESSION_TYPES.SIMPLE}\n                tab={t('Simple')}\n              >\n                {sectionRenders.SIMPLE}\n              </Tabs.TabPane>\n            )}\n            {resultSections.includes('CUSTOM_SQL') && (\n              <Tabs.TabPane\n                className=\"adhoc-filter-edit-tab\"\n                key={EXPRESSION_TYPES.SQL}\n                tab={t('Custom SQL')}\n              >\n                {sectionRenders.CUSTOM_SQL}\n              </Tabs.TabPane>\n            )}\n          </Tabs>\n        ) : (\n          <SectionWrapper>{sectionRenders[resultSections[0]]}</SectionWrapper>\n        )}\n        <div>\n          <Button buttonSize=\"small\" onClick={this.props.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            data-test=\"adhoc-filter-edit-popover-save-button\"\n            disabled={!stateIsValid}\n            buttonStyle={\n              hasUnsavedChanges && stateIsValid ? 'primary' : 'default'\n            }\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <ResizeIcon\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </div>\n      </FilterPopoverContentContainer>\n    );\n  }\n}\n\nAdhocFilterEditPopover.propTypes = propTypes;\n"]},"metadata":{},"sourceType":"module"}