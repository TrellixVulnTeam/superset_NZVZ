{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";import _debounce from \"lodash/debounce\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, css, useTheme } from '@superset-ui/core';\n\nimport { Resizable } from 're-resizable';\n\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icons from 'src/components/Icons';\nimport {\ngetFromLocalStorage,\nsetInLocalStorage } from\n'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\nLOG_ACTIONS_MOUNT_EXPLORER,\nLOG_ACTIONS_CHANGE_EXPLORE_CONTROLS } from\n'../../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string };\n\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  max-height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  flex-basis: 100vh;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth });\n\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = _debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}__signature__(useWindowSize, \"useState{[size, setSize](getWindowSize())}\\nuseEffect{}\");\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  /** the state of controls in the previous render */\n  const previousControls = usePrevious(props.controls);\n  /** the state of controls last time a query was triggered */\n  const [lastQueriedControls, setLastQueriedControls] = useState(\n  props.controls);\n\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const theme = useTheme();\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight ?\n  `${props.forcedHeight}px` :\n  `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width' };\n\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300 };\n\n\n  const addHistory = useCallback(\n  ({ isReplace = false, title } = {}) => {\n    const payload = { ...props.form_data };\n    const longUrl = getExploreLongUrl(\n    props.form_data,\n    props.standalone ? URL_PARAMS.standalone.name : null,\n    false);\n\n    try {\n      if (isReplace) {\n        window.history.replaceState(payload, title, longUrl);\n      } else {\n        window.history.pushState(payload, title, longUrl);\n      }\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\n      'Failed at altering browser history',\n      payload,\n      title,\n      longUrl);\n\n    }\n  },\n  [props.form_data, props.standalone]);\n\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n      formData,\n      false,\n      props.timeout,\n      props.chart.id);\n\n    }\n  }\n  const onQuery = useCallback(() => {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n    setLastQueriedControls(props.controls);\n  }, [props.controls, addHistory, props.actions, props.chart.id]);\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (props.slice) {\n          props.actions.\n          saveSlice(props.form_data, {\n            action: 'overwrite',\n            slice_id: props.slice.slice_id,\n            slice_name: props.slice.slice_name,\n            add_to_dash: 'noSave',\n            goto_dash: false }).\n\n          then(({ data }) => {\n            window.location = data.slice.slice_url;\n          });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n    getFormDataFromControls(props.controls),\n    props.chart.id);\n\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {\n      if (\n      props.controls.datasource && (\n      previousControls.datasource == null ||\n      props.controls.datasource.value !== previousControls.datasource.value))\n      {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n      (key) =>\n      typeof previousControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      previousControls[key].value));\n\n\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = changedControlKeys.some(\n      (key) => props.controls[key].renderTrigger);\n\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (lastQueriedControls) {\n      const changedControlKeys = Object.keys(props.controls).filter(\n      (key) =>\n      typeof lastQueriedControls[key] !== 'undefined' &&\n      !areObjectsEqual(\n      props.controls[key].value,\n      lastQueriedControls[key].value));\n\n\n\n      return changedControlKeys.some(\n      (key) =>\n      !props.controls[key].renderTrigger &&\n      !props.controls[key].dontRefreshOnChange);\n\n    }\n    return false;\n  }, [lastQueriedControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {\n    // Returns an error message as a node if any errors are in the store\n    const controlsWithErrors = Object.values(props.controls).filter(\n    (control) =>\n    control.validationErrors && control.validationErrors.length > 0);\n\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n    (control) => control.validationErrors);\n\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages.\n    map((message) => {\n      const matchingLabels = controlsWithErrors.\n      filter((control) => {var _control$validationEr;return (_control$validationEr = control.validationErrors) == null ? void 0 : _control$validationEr.includes(message);}).\n      map((control) => control.label);\n      return [matchingLabels, message];\n    }).\n    map(([labels, message]) =>\n    ___EmotionJSX(\"div\", { key: message, __self: this, __source: { fileName: _jsxFileName, lineNumber: 402, columnNumber: 9 } },\n    labels.length > 1 ? t('Controls labeled ') : t('Control labeled '),\n    ___EmotionJSX(\"strong\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 404, columnNumber: 11 } }, ` ${labels.join(', ')}`),\n    ___EmotionJSX(\"span\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 405, columnNumber: 11 } }, \": \", message)));\n\n\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = ___EmotionJSX(\"div\", { style: { textAlign: 'left' }, __self: this, __source: { fileName: _jsxFileName, lineNumber: 411, columnNumber: 22 } }, errors);\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      ___EmotionJSX(ExploreChartPanel, _extends({\n        width: width,\n        height: height },\n      props, {\n        errorMessage: renderErrorMessage(),\n        refreshOverlayVisible: chartIsStale,\n        addHistory: addHistory,\n        onQuery: onQuery, __self: this, __source: { fileName: _jsxFileName, lineNumber: 418, columnNumber: 7 } })));\n\n\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    ___EmotionJSX(Styles, { id: \"explore-container\", height: height, __self: this, __source: { fileName: _jsxFileName, lineNumber: 444, columnNumber: 5 } },\n    ___EmotionJSX(Global, {\n      styles: css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            height: 100vh;\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100%;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        `, __self: this, __source: { fileName: _jsxFileName, lineNumber: 445, columnNumber: 7 } }),\n\n    showingModal &&\n    ___EmotionJSX(SaveModal, {\n      onHide: toggleModal,\n      actions: props.actions,\n      form_data: props.form_data,\n      sliceName: props.sliceName,\n      dashboardId: props.dashboardId, __self: this, __source: { fileName: _jsxFileName, lineNumber: 470, columnNumber: 9 } }),\n\n\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.dataSourceWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.dataSourceWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.dataSourceWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className:\n      isCollapsed ? 'no-show' : 'explore-column data-source-selection', __self: this, __source: { fileName: _jsxFileName, lineNumber: 478, columnNumber: 7 } },\n\n\n    ___EmotionJSX(\"div\", { className: \"title-container\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 493, columnNumber: 9 } },\n    ___EmotionJSX(\"span\", { className: \"horizont al-text\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 494, columnNumber: 11 } }, t('Dataset')),\n    ___EmotionJSX(\"span\", {\n      role: \"button\",\n      tabIndex: 0,\n      className: \"action-button\",\n      onClick: toggleCollapse, __self: this, __source: { fileName: _jsxFileName, lineNumber: 495, columnNumber: 11 } },\n\n    ___EmotionJSX(Icons.Expand, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 501, columnNumber: 13 } }))),\n\n\n\n    ___EmotionJSX(DataSourcePanel, {\n      datasource: props.datasource,\n      controls: props.controls,\n      actions: props.actions, __self: this, __source: { fileName: _jsxFileName, lineNumber: 508, columnNumber: 9 } })),\n\n\n    isCollapsed ?\n    ___EmotionJSX(\"div\", {\n      className: \"sidebar\",\n      onClick: toggleCollapse,\n      \"data-test\": \"open-datasource-tab\",\n      role: \"button\",\n      tabIndex: 0, __self: this, __source: { fileName: _jsxFileName, lineNumber: 515, columnNumber: 9 } },\n\n    ___EmotionJSX(\"span\", { role: \"button\", tabIndex: 0, className: \"action-button\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 522, columnNumber: 11 } },\n    ___EmotionJSX(Tooltip, { title: t('Open Datasource tab'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 523, columnNumber: 13 } },\n    ___EmotionJSX(Icons.Collapse, {\n      className: \"collapse-icon\",\n      iconColor: theme.colors.primary.base,\n      iconSize: \"l\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 524, columnNumber: 15 } }))),\n\n\n\n    ___EmotionJSX(Icons.DatasetPhysical, {\n      css: /*#__PURE__*/_css({ marginTop: theme.gridUnit * 2 }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ExploreViewContainer;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3VidW50dS9teV9wbHVnaW4vc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9FeHBsb3JlVmlld0NvbnRhaW5lci5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBbWhCWSIsImZpbGUiOiIvaG9tZS91YnVudHUvbXlfcGx1Z2luL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9leHBsb3JlL2NvbXBvbmVudHMvRXhwbG9yZVZpZXdDb250YWluZXIuanN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyogZXNsaW50IGNhbWVsY2FzZTogMCAqL1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IGJpbmRBY3Rpb25DcmVhdG9ycyB9IGZyb20gJ3JlZHV4JztcbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyBzdHlsZWQsIHQsIGNzcywgdXNlVGhlbWUgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgeyBkZWJvdW5jZSB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBSZXNpemFibGUgfSBmcm9tICdyZS1yZXNpemFibGUnO1xuXG5pbXBvcnQgeyB1c2VQbHVnaW5Db250ZXh0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvRHluYW1pY1BsdWdpbnMnO1xuaW1wb3J0IHsgR2xvYmFsIH0gZnJvbSAnQGVtb3Rpb24vcmVhY3QnO1xuaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL1Rvb2x0aXAnO1xuaW1wb3J0IHsgdXNlUHJldmlvdXMgfSBmcm9tICdzcmMvY29tbW9uL2hvb2tzL3VzZVByZXZpb3VzJztcbmltcG9ydCBJY29ucyBmcm9tICdzcmMvY29tcG9uZW50cy9JY29ucyc7XG5pbXBvcnQge1xuICBnZXRGcm9tTG9jYWxTdG9yYWdlLFxuICBzZXRJbkxvY2FsU3RvcmFnZSxcbn0gZnJvbSAnc3JjL3V0aWxzL2xvY2FsU3RvcmFnZUhlbHBlcnMnO1xuaW1wb3J0IHsgVVJMX1BBUkFNUyB9IGZyb20gJ3NyYy9jb25zdGFudHMnO1xuaW1wb3J0IGN4IGZyb20gJ2NsYXNzbmFtZXMnO1xuaW1wb3J0ICogYXMgY2hhcnRBY3Rpb25zIGZyb20gJ3NyYy9jaGFydC9jaGFydEFjdGlvbic7XG5pbXBvcnQgeyBmZXRjaERhdGFzb3VyY2VNZXRhZGF0YSB9IGZyb20gJ3NyYy9kYXNoYm9hcmQvYWN0aW9ucy9kYXRhc291cmNlcyc7XG5pbXBvcnQgeyBjaGFydFByb3BTaGFwZSB9IGZyb20gJ3NyYy9kYXNoYm9hcmQvdXRpbC9wcm9wU2hhcGVzJztcbmltcG9ydCB7IG1lcmdlRXh0cmFGb3JtRGF0YSB9IGZyb20gJ3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9uYXRpdmVGaWx0ZXJzL3V0aWxzJztcbmltcG9ydCBFeHBsb3JlQ2hhcnRQYW5lbCBmcm9tICcuL0V4cGxvcmVDaGFydFBhbmVsJztcbmltcG9ydCBDb25uZWN0ZWRDb250cm9sUGFuZWxzQ29udGFpbmVyIGZyb20gJy4vQ29udHJvbFBhbmVsc0NvbnRhaW5lcic7XG5pbXBvcnQgU2F2ZU1vZGFsIGZyb20gJy4vU2F2ZU1vZGFsJztcbmltcG9ydCBRdWVyeUFuZFNhdmVCdG5zIGZyb20gJy4vUXVlcnlBbmRTYXZlQnRucyc7XG5pbXBvcnQgRGF0YVNvdXJjZVBhbmVsIGZyb20gJy4vRGF0YXNvdXJjZVBhbmVsJztcbmltcG9ydCB7IGdldEV4cGxvcmVMb25nVXJsIH0gZnJvbSAnLi4vZXhwbG9yZVV0aWxzJztcbmltcG9ydCB7IGFyZU9iamVjdHNFcXVhbCB9IGZyb20gJy4uLy4uL3JlZHV4VXRpbHMnO1xuaW1wb3J0IHsgZ2V0Rm9ybURhdGFGcm9tQ29udHJvbHMgfSBmcm9tICcuLi9jb250cm9sVXRpbHMnO1xuaW1wb3J0ICogYXMgZXhwbG9yZUFjdGlvbnMgZnJvbSAnLi4vYWN0aW9ucy9leHBsb3JlQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBzYXZlTW9kYWxBY3Rpb25zIGZyb20gJy4uL2FjdGlvbnMvc2F2ZU1vZGFsQWN0aW9ucyc7XG5pbXBvcnQgKiBhcyBsb2dBY3Rpb25zIGZyb20gJy4uLy4uL2xvZ2dlci9hY3Rpb25zJztcbmltcG9ydCB7XG4gIExPR19BQ1RJT05TX01PVU5UX0VYUExPUkVSLFxuICBMT0dfQUNUSU9OU19DSEFOR0VfRVhQTE9SRV9DT05UUk9MUyxcbn0gZnJvbSAnLi4vLi4vbG9nZ2VyL0xvZ1V0aWxzJztcblxuY29uc3QgcHJvcFR5cGVzID0ge1xuICAuLi5FeHBsb3JlQ2hhcnRQYW5lbC5wcm9wVHlwZXMsXG4gIGhlaWdodDogUHJvcFR5cGVzLnN0cmluZyxcbiAgd2lkdGg6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGFjdGlvbnM6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgZGF0YXNvdXJjZV90eXBlOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gIGRhc2hib2FyZElkOiBQcm9wVHlwZXMubnVtYmVyLFxuICBpc0RhdGFzb3VyY2VNZXRhTG9hZGluZzogUHJvcFR5cGVzLmJvb2wuaXNSZXF1aXJlZCxcbiAgY2hhcnQ6IGNoYXJ0UHJvcFNoYXBlLmlzUmVxdWlyZWQsXG4gIHNsaWNlOiBQcm9wVHlwZXMub2JqZWN0LFxuICBzbGljZU5hbWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGNvbnRyb2xzOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gIGZvcmNlZEhlaWdodDogUHJvcFR5cGVzLnN0cmluZyxcbiAgZm9ybV9kYXRhOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gIHN0YW5kYWxvbmU6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgdGltZW91dDogUHJvcFR5cGVzLm51bWJlcixcbiAgaW1wcmVzc2lvbklkOiBQcm9wVHlwZXMuc3RyaW5nLFxuICB2aXpUeXBlOiBQcm9wVHlwZXMuc3RyaW5nLFxufTtcblxuY29uc3QgU3R5bGVzID0gc3R5bGVkLmRpdmBcbiAgYmFja2dyb3VuZDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NX07XG4gIHRleHQtYWxpZ246IGxlZnQ7XG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcbiAgd2lkdGg6IDEwMCU7XG4gIG1heC1oZWlnaHQ6IDEwMCU7XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiByb3c7XG4gIGZsZXgtd3JhcDogbm93cmFwO1xuICBmbGV4LWJhc2lzOiAxMDB2aDtcbiAgYWxpZ24taXRlbXM6IHN0cmV0Y2g7XG4gIGJvcmRlci10b3A6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgLmV4cGxvcmUtY29sdW1uIHtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gICAgcGFkZGluZzogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHggMDtcbiAgICBtYXgtaGVpZ2h0OiAxMDAlO1xuICB9XG4gIC5kYXRhLXNvdXJjZS1zZWxlY3Rpb24ge1xuICAgIGJhY2tncm91bmQtY29sb3I6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDR9O1xuICAgIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4IDA7XG4gICAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWQgJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0Mn07XG4gIH1cbiAgLm1haW4tZXhwbG9yZS1jb250ZW50IHtcbiAgICBmbGV4OiAxO1xuICAgIG1pbi13aWR0aDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDEyOH1weDtcbiAgICBib3JkZXItbGVmdDogMXB4IHNvbGlkICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuICAgIC5wYW5lbCB7XG4gICAgICBtYXJnaW4tYm90dG9tOiAwO1xuICAgIH1cbiAgfVxuICAuY29udHJvbHMtY29sdW1uIHtcbiAgICBhbGlnbi1zZWxmOiBmbGV4LXN0YXJ0O1xuICAgIHBhZGRpbmc6IDA7XG4gIH1cbiAgLnRpdGxlLWNvbnRhaW5lciB7XG4gICAgcG9zaXRpb246IHJlbGF0aXZlO1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBwYWRkaW5nOiAwICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4O1xuICAgIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgICAuaG9yaXpvbnRhbC10ZXh0IHtcbiAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7XG4gICAgICBjb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0MX07XG4gICAgICBmb250LXNpemU6ICR7KHsgdGhlbWUgfSkgPT4gNCAqIHRoZW1lLnR5cG9ncmFwaHkuc2l6ZXMuc307XG4gICAgfVxuICB9XG4gIC5uby1zaG93IHtcbiAgICBkaXNwbGF5OiBub25lO1xuICB9XG4gIC52ZXJ0aWNhbC10ZXh0IHtcbiAgICB3cml0aW5nLW1vZGU6IHZlcnRpY2FsLXJsO1xuICAgIHRleHQtb3JpZW50YXRpb246IG1peGVkO1xuICB9XG4gIC5zaWRlYmFyIHtcbiAgICBoZWlnaHQ6IDEwMCU7XG4gICAgYmFja2dyb3VuZC1jb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NH07XG4gICAgcGFkZGluZzogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHg7XG4gICAgd2lkdGg6ICR7KHsgdGhlbWUgfSkgPT4gOCAqIHRoZW1lLmdyaWRVbml0fXB4O1xuICB9XG4gIC5jYWxscGFzZS1pY29uID4gc3ZnIHtcbiAgICBjb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMucHJpbWFyeS5iYXNlfTtcbiAgfVxuYDtcblxuY29uc3QgZ2V0V2luZG93U2l6ZSA9ICgpID0+ICh7XG4gIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0LFxuICB3aWR0aDogd2luZG93LmlubmVyV2lkdGgsXG59KTtcblxuZnVuY3Rpb24gdXNlV2luZG93U2l6ZSh7IGRlbGF5TXMgPSAyNTAgfSA9IHt9KSB7XG4gIGNvbnN0IFtzaXplLCBzZXRTaXplXSA9IHVzZVN0YXRlKGdldFdpbmRvd1NpemUoKSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBjb25zdCBvbldpbmRvd1Jlc2l6ZSA9IGRlYm91bmNlKCgpID0+IHNldFNpemUoZ2V0V2luZG93U2l6ZSgpKSwgZGVsYXlNcyk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplKTtcbiAgICByZXR1cm4gKCkgPT4gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIG9uV2luZG93UmVzaXplKTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiBzaXplO1xufVxuXG5mdW5jdGlvbiBFeHBsb3JlVmlld0NvbnRhaW5lcihwcm9wcykge1xuICBjb25zdCBkeW5hbWljUGx1Z2luQ29udGV4dCA9IHVzZVBsdWdpbkNvbnRleHQoKTtcbiAgY29uc3QgZHluYW1pY1BsdWdpbiA9IGR5bmFtaWNQbHVnaW5Db250ZXh0LmR5bmFtaWNQbHVnaW5zW3Byb3BzLnZpelR5cGVdO1xuICBjb25zdCBpc0R5bmFtaWNQbHVnaW5Mb2FkaW5nID0gZHluYW1pY1BsdWdpbiAmJiBkeW5hbWljUGx1Z2luLm1vdW50aW5nO1xuICBjb25zdCB3YXNEeW5hbWljUGx1Z2luTG9hZGluZyA9IHVzZVByZXZpb3VzKGlzRHluYW1pY1BsdWdpbkxvYWRpbmcpO1xuXG4gIC8qKiB0aGUgc3RhdGUgb2YgY29udHJvbHMgaW4gdGhlIHByZXZpb3VzIHJlbmRlciAqL1xuICBjb25zdCBwcmV2aW91c0NvbnRyb2xzID0gdXNlUHJldmlvdXMocHJvcHMuY29udHJvbHMpO1xuICAvKiogdGhlIHN0YXRlIG9mIGNvbnRyb2xzIGxhc3QgdGltZSBhIHF1ZXJ5IHdhcyB0cmlnZ2VyZWQgKi9cbiAgY29uc3QgW2xhc3RRdWVyaWVkQ29udHJvbHMsIHNldExhc3RRdWVyaWVkQ29udHJvbHNdID0gdXNlU3RhdGUoXG4gICAgcHJvcHMuY29udHJvbHMsXG4gICk7XG4gIGNvbnN0IHdpbmRvd1NpemUgPSB1c2VXaW5kb3dTaXplKCk7XG5cbiAgY29uc3QgW3Nob3dpbmdNb2RhbCwgc2V0U2hvd2luZ01vZGFsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2lzQ29sbGFwc2VkLCBzZXRJc0NvbGxhcHNlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICBjb25zdCB3aWR0aCA9IGAke3dpbmRvd1NpemUud2lkdGh9cHhgO1xuICBjb25zdCBuYXZIZWlnaHQgPSBwcm9wcy5zdGFuZGFsb25lID8gMCA6IDkwO1xuICBjb25zdCBoZWlnaHQgPSBwcm9wcy5mb3JjZWRIZWlnaHRcbiAgICA/IGAke3Byb3BzLmZvcmNlZEhlaWdodH1weGBcbiAgICA6IGAke3dpbmRvd1NpemUuaGVpZ2h0IC0gbmF2SGVpZ2h0fXB4YDtcblxuICBjb25zdCBzdG9yYWdlS2V5cyA9IHtcbiAgICBjb250cm9sc1dpZHRoOiAnY29udHJvbHNfd2lkdGgnLFxuICAgIGRhdGFTb3VyY2VXaWR0aDogJ2RhdGFzb3VyY2Vfd2lkdGgnLFxuICB9O1xuXG4gIGNvbnN0IGRlZmF1bHRTaWRlYmFyc1dpZHRoID0ge1xuICAgIGNvbnRyb2xzX3dpZHRoOiAzMjAsXG4gICAgZGF0YXNvdXJjZV93aWR0aDogMzAwLFxuICB9O1xuXG4gIGNvbnN0IGFkZEhpc3RvcnkgPSB1c2VDYWxsYmFjayhcbiAgICAoeyBpc1JlcGxhY2UgPSBmYWxzZSwgdGl0bGUgfSA9IHt9KSA9PiB7XG4gICAgICBjb25zdCBwYXlsb2FkID0geyAuLi5wcm9wcy5mb3JtX2RhdGEgfTtcbiAgICAgIGNvbnN0IGxvbmdVcmwgPSBnZXRFeHBsb3JlTG9uZ1VybChcbiAgICAgICAgcHJvcHMuZm9ybV9kYXRhLFxuICAgICAgICBwcm9wcy5zdGFuZGFsb25lID8gVVJMX1BBUkFNUy5zdGFuZGFsb25lLm5hbWUgOiBudWxsLFxuICAgICAgICBmYWxzZSxcbiAgICAgICk7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAoaXNSZXBsYWNlKSB7XG4gICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHBheWxvYWQsIHRpdGxlLCBsb25nVXJsKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUocGF5bG9hZCwgdGl0bGUsIGxvbmdVcmwpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlXG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAnRmFpbGVkIGF0IGFsdGVyaW5nIGJyb3dzZXIgaGlzdG9yeScsXG4gICAgICAgICAgcGF5bG9hZCxcbiAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICBsb25nVXJsLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0sXG4gICAgW3Byb3BzLmZvcm1fZGF0YSwgcHJvcHMuc3RhbmRhbG9uZV0sXG4gICk7XG5cbiAgZnVuY3Rpb24gaGFuZGxlUG9wc3RhdGUoKSB7XG4gICAgY29uc3QgZm9ybURhdGEgPSB3aW5kb3cuaGlzdG9yeS5zdGF0ZTtcbiAgICBpZiAoZm9ybURhdGEgJiYgT2JqZWN0LmtleXMoZm9ybURhdGEpLmxlbmd0aCkge1xuICAgICAgcHJvcHMuYWN0aW9ucy5zZXRFeHBsb3JlQ29udHJvbHMoZm9ybURhdGEpO1xuICAgICAgcHJvcHMuYWN0aW9ucy5wb3N0Q2hhcnRGb3JtRGF0YShcbiAgICAgICAgZm9ybURhdGEsXG4gICAgICAgIGZhbHNlLFxuICAgICAgICBwcm9wcy50aW1lb3V0LFxuICAgICAgICBwcm9wcy5jaGFydC5pZCxcbiAgICAgICk7XG4gICAgfVxuICB9XG4gIGNvbnN0IG9uUXVlcnkgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgcHJvcHMuYWN0aW9ucy50cmlnZ2VyUXVlcnkodHJ1ZSwgcHJvcHMuY2hhcnQuaWQpO1xuICAgIGFkZEhpc3RvcnkoKTtcbiAgICBzZXRMYXN0UXVlcmllZENvbnRyb2xzKHByb3BzLmNvbnRyb2xzKTtcbiAgfSwgW3Byb3BzLmNvbnRyb2xzLCBhZGRIaXN0b3J5LCBwcm9wcy5hY3Rpb25zLCBwcm9wcy5jaGFydC5pZF0pO1xuXG4gIGZ1bmN0aW9uIGhhbmRsZUtleWRvd24oZXZlbnQpIHtcbiAgICBjb25zdCBjb250cm9sT3JDb21tYW5kID0gZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5O1xuICAgIGlmIChjb250cm9sT3JDb21tYW5kKSB7XG4gICAgICBjb25zdCBpc0VudGVyID0gZXZlbnQua2V5ID09PSAnRW50ZXInIHx8IGV2ZW50LmtleUNvZGUgPT09IDEzO1xuICAgICAgY29uc3QgaXNTID0gZXZlbnQua2V5ID09PSAncycgfHwgZXZlbnQua2V5Q29kZSA9PT0gODM7XG4gICAgICBpZiAoaXNFbnRlcikge1xuICAgICAgICBvblF1ZXJ5KCk7XG4gICAgICB9IGVsc2UgaWYgKGlzUykge1xuICAgICAgICBpZiAocHJvcHMuc2xpY2UpIHtcbiAgICAgICAgICBwcm9wcy5hY3Rpb25zXG4gICAgICAgICAgICAuc2F2ZVNsaWNlKHByb3BzLmZvcm1fZGF0YSwge1xuICAgICAgICAgICAgICBhY3Rpb246ICdvdmVyd3JpdGUnLFxuICAgICAgICAgICAgICBzbGljZV9pZDogcHJvcHMuc2xpY2Uuc2xpY2VfaWQsXG4gICAgICAgICAgICAgIHNsaWNlX25hbWU6IHByb3BzLnNsaWNlLnNsaWNlX25hbWUsXG4gICAgICAgICAgICAgIGFkZF90b19kYXNoOiAnbm9TYXZlJyxcbiAgICAgICAgICAgICAgZ290b19kYXNoOiBmYWxzZSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbigoeyBkYXRhIH0pID0+IHtcbiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gZGF0YS5zbGljZS5zbGljZV91cmw7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uU3RvcCgpIHtcbiAgICBpZiAocHJvcHMuY2hhcnQgJiYgcHJvcHMuY2hhcnQucXVlcnlDb250cm9sbGVyKSB7XG4gICAgICBwcm9wcy5jaGFydC5xdWVyeUNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVNb2RhbCgpIHtcbiAgICBzZXRTaG93aW5nTW9kYWwoIXNob3dpbmdNb2RhbCk7XG4gIH1cblxuICBmdW5jdGlvbiB0b2dnbGVDb2xsYXBzZSgpIHtcbiAgICBzZXRJc0NvbGxhcHNlZCghaXNDb2xsYXBzZWQpO1xuICB9XG5cbiAgLy8gZWZmZWN0IHRvIHJ1biBvbiBtb3VudFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHByb3BzLmFjdGlvbnMubG9nRXZlbnQoTE9HX0FDVElPTlNfTU9VTlRfRVhQTE9SRVIpO1xuICAgIGFkZEhpc3RvcnkoeyBpc1JlcGxhY2U6IHRydWUgfSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgaGFuZGxlUG9wc3RhdGUpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBoYW5kbGVLZXlkb3duKTtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3BvcHN0YXRlJywgaGFuZGxlUG9wc3RhdGUpO1xuICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZUtleWRvd24pO1xuICAgIH07XG4gIH0sIFtdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICh3YXNEeW5hbWljUGx1Z2luTG9hZGluZyAmJiAhaXNEeW5hbWljUGx1Z2luTG9hZGluZykge1xuICAgICAgLy8gcmVsb2FkIHRoZSBjb250cm9scyBub3cgdGhhdCB3ZSBhY3R1YWxseSBoYXZlIHRoZSBjb250cm9sIGNvbmZpZ1xuICAgICAgcHJvcHMuYWN0aW9ucy5keW5hbWljUGx1Z2luQ29udHJvbHNSZWFkeSgpO1xuICAgIH1cbiAgfSwgW2lzRHluYW1pY1BsdWdpbkxvYWRpbmddKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGhhc0Vycm9yID0gT2JqZWN0LnZhbHVlcyhwcm9wcy5jb250cm9scykuc29tZShcbiAgICAgIGNvbnRyb2wgPT5cbiAgICAgICAgY29udHJvbC52YWxpZGF0aW9uRXJyb3JzICYmIGNvbnRyb2wudmFsaWRhdGlvbkVycm9ycy5sZW5ndGggPiAwLFxuICAgICk7XG4gICAgaWYgKCFoYXNFcnJvcikge1xuICAgICAgcHJvcHMuYWN0aW9ucy50cmlnZ2VyUXVlcnkodHJ1ZSwgcHJvcHMuY2hhcnQuaWQpO1xuICAgIH1cbiAgfSwgW10pO1xuXG4gIGNvbnN0IHJlUmVuZGVyQ2hhcnQgPSAoKSA9PiB7XG4gICAgcHJvcHMuYWN0aW9ucy51cGRhdGVRdWVyeUZvcm1EYXRhKFxuICAgICAgZ2V0Rm9ybURhdGFGcm9tQ29udHJvbHMocHJvcHMuY29udHJvbHMpLFxuICAgICAgcHJvcHMuY2hhcnQuaWQsXG4gICAgKTtcbiAgICBwcm9wcy5hY3Rpb25zLnJlbmRlclRyaWdnZXJlZChuZXcgRGF0ZSgpLmdldFRpbWUoKSwgcHJvcHMuY2hhcnQuaWQpO1xuICAgIGFkZEhpc3RvcnkoKTtcbiAgfTtcblxuICAvLyBlZmZlY3QgdG8gcnVuIHdoZW4gY29udHJvbHMgY2hhbmdlXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKHByZXZpb3VzQ29udHJvbHMpIHtcbiAgICAgIGlmIChcbiAgICAgICAgcHJvcHMuY29udHJvbHMuZGF0YXNvdXJjZSAmJlxuICAgICAgICAocHJldmlvdXNDb250cm9scy5kYXRhc291cmNlID09IG51bGwgfHxcbiAgICAgICAgICBwcm9wcy5jb250cm9scy5kYXRhc291cmNlLnZhbHVlICE9PSBwcmV2aW91c0NvbnRyb2xzLmRhdGFzb3VyY2UudmFsdWUpXG4gICAgICApIHtcbiAgICAgICAgLy8gdGhpcyBzaG91bGQgcmVhbGx5IGJlIGhhbmRsZWQgYnkgYWN0aW9uc1xuICAgICAgICBmZXRjaERhdGFzb3VyY2VNZXRhZGF0YShwcm9wcy5mb3JtX2RhdGEuZGF0YXNvdXJjZSwgdHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNoYW5nZWRDb250cm9sS2V5cyA9IE9iamVjdC5rZXlzKHByb3BzLmNvbnRyb2xzKS5maWx0ZXIoXG4gICAgICAgIGtleSA9PlxuICAgICAgICAgIHR5cGVvZiBwcmV2aW91c0NvbnRyb2xzW2tleV0gIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgIWFyZU9iamVjdHNFcXVhbChcbiAgICAgICAgICAgIHByb3BzLmNvbnRyb2xzW2tleV0udmFsdWUsXG4gICAgICAgICAgICBwcmV2aW91c0NvbnRyb2xzW2tleV0udmFsdWUsXG4gICAgICAgICAgKSxcbiAgICAgICk7XG5cbiAgICAgIC8vIHRoaXMgc2hvdWxkIGFsc28gYmUgaGFuZGxlZCBieSB0aGUgYWN0aW9ucyB0aGF0IGFyZSBhY3R1YWxseSBjaGFuZ2luZyB0aGUgY29udHJvbHNcbiAgICAgIGNvbnN0IGhhc0Rpc3BsYXlDb250cm9sQ2hhbmdlZCA9IGNoYW5nZWRDb250cm9sS2V5cy5zb21lKFxuICAgICAgICBrZXkgPT4gcHJvcHMuY29udHJvbHNba2V5XS5yZW5kZXJUcmlnZ2VyLFxuICAgICAgKTtcbiAgICAgIGlmIChoYXNEaXNwbGF5Q29udHJvbENoYW5nZWQpIHtcbiAgICAgICAgcmVSZW5kZXJDaGFydCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSwgW3Byb3BzLmNvbnRyb2xzLCBwcm9wcy5vd25TdGF0ZV0pO1xuXG4gIGNvbnN0IGNoYXJ0SXNTdGFsZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmIChsYXN0UXVlcmllZENvbnRyb2xzKSB7XG4gICAgICBjb25zdCBjaGFuZ2VkQ29udHJvbEtleXMgPSBPYmplY3Qua2V5cyhwcm9wcy5jb250cm9scykuZmlsdGVyKFxuICAgICAgICBrZXkgPT5cbiAgICAgICAgICB0eXBlb2YgbGFzdFF1ZXJpZWRDb250cm9sc1trZXldICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICFhcmVPYmplY3RzRXF1YWwoXG4gICAgICAgICAgICBwcm9wcy5jb250cm9sc1trZXldLnZhbHVlLFxuICAgICAgICAgICAgbGFzdFF1ZXJpZWRDb250cm9sc1trZXldLnZhbHVlLFxuICAgICAgICAgICksXG4gICAgICApO1xuXG4gICAgICByZXR1cm4gY2hhbmdlZENvbnRyb2xLZXlzLnNvbWUoXG4gICAgICAgIGtleSA9PlxuICAgICAgICAgICFwcm9wcy5jb250cm9sc1trZXldLnJlbmRlclRyaWdnZXIgJiZcbiAgICAgICAgICAhcHJvcHMuY29udHJvbHNba2V5XS5kb250UmVmcmVzaE9uQ2hhbmdlLFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LCBbbGFzdFF1ZXJpZWRDb250cm9scywgcHJvcHMuY29udHJvbHNdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChwcm9wcy5vd25TdGF0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBvblF1ZXJ5KCk7XG4gICAgICByZVJlbmRlckNoYXJ0KCk7XG4gICAgfVxuICB9LCBbcHJvcHMub3duU3RhdGVdKTtcblxuICBpZiAoY2hhcnRJc1N0YWxlKSB7XG4gICAgcHJvcHMuYWN0aW9ucy5sb2dFdmVudChMT0dfQUNUSU9OU19DSEFOR0VfRVhQTE9SRV9DT05UUk9MUyk7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJFcnJvck1lc3NhZ2UoKSB7XG4gICAgLy8gUmV0dXJucyBhbiBlcnJvciBtZXNzYWdlIGFzIGEgbm9kZSBpZiBhbnkgZXJyb3JzIGFyZSBpbiB0aGUgc3RvcmVcbiAgICBjb25zdCBjb250cm9sc1dpdGhFcnJvcnMgPSBPYmplY3QudmFsdWVzKHByb3BzLmNvbnRyb2xzKS5maWx0ZXIoXG4gICAgICBjb250cm9sID0+XG4gICAgICAgIGNvbnRyb2wudmFsaWRhdGlvbkVycm9ycyAmJiBjb250cm9sLnZhbGlkYXRpb25FcnJvcnMubGVuZ3RoID4gMCxcbiAgICApO1xuICAgIGlmIChjb250cm9sc1dpdGhFcnJvcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvck1lc3NhZ2VzID0gY29udHJvbHNXaXRoRXJyb3JzLm1hcChcbiAgICAgIGNvbnRyb2wgPT4gY29udHJvbC52YWxpZGF0aW9uRXJyb3JzLFxuICAgICk7XG4gICAgY29uc3QgdW5pcXVlRXJyb3JNZXNzYWdlcyA9IFsuLi5uZXcgU2V0KGVycm9yTWVzc2FnZXMuZmxhdCgpKV07XG5cbiAgICBjb25zdCBlcnJvcnMgPSB1bmlxdWVFcnJvck1lc3NhZ2VzXG4gICAgICAubWFwKG1lc3NhZ2UgPT4ge1xuICAgICAgICBjb25zdCBtYXRjaGluZ0xhYmVscyA9IGNvbnRyb2xzV2l0aEVycm9yc1xuICAgICAgICAgIC5maWx0ZXIoY29udHJvbCA9PiBjb250cm9sLnZhbGlkYXRpb25FcnJvcnM/LmluY2x1ZGVzKG1lc3NhZ2UpKVxuICAgICAgICAgIC5tYXAoY29udHJvbCA9PiBjb250cm9sLmxhYmVsKTtcbiAgICAgICAgcmV0dXJuIFttYXRjaGluZ0xhYmVscywgbWVzc2FnZV07XG4gICAgICB9KVxuICAgICAgLm1hcCgoW2xhYmVscywgbWVzc2FnZV0pID0+IChcbiAgICAgICAgPGRpdiBrZXk9e21lc3NhZ2V9PlxuICAgICAgICAgIHtsYWJlbHMubGVuZ3RoID4gMSA/IHQoJ0NvbnRyb2xzIGxhYmVsZWQgJykgOiB0KCdDb250cm9sIGxhYmVsZWQgJyl9XG4gICAgICAgICAgPHN0cm9uZz57YCAke2xhYmVscy5qb2luKCcsICcpfWB9PC9zdHJvbmc+XG4gICAgICAgICAgPHNwYW4+OiB7bWVzc2FnZX08L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKSk7XG5cbiAgICBsZXQgZXJyb3JNZXNzYWdlO1xuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgZXJyb3JNZXNzYWdlID0gPGRpdiBzdHlsZT17eyB0ZXh0QWxpZ246ICdsZWZ0JyB9fT57ZXJyb3JzfTwvZGl2PjtcbiAgICB9XG4gICAgcmV0dXJuIGVycm9yTWVzc2FnZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlckNoYXJ0Q29udGFpbmVyKCkge1xuICAgIHJldHVybiAoXG4gICAgICA8RXhwbG9yZUNoYXJ0UGFuZWxcbiAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgICBoZWlnaHQ9e2hlaWdodH1cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgICBlcnJvck1lc3NhZ2U9e3JlbmRlckVycm9yTWVzc2FnZSgpfVxuICAgICAgICByZWZyZXNoT3ZlcmxheVZpc2libGU9e2NoYXJ0SXNTdGFsZX1cbiAgICAgICAgYWRkSGlzdG9yeT17YWRkSGlzdG9yeX1cbiAgICAgICAgb25RdWVyeT17b25RdWVyeX1cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFNpZGViYXJXaWR0aHMoa2V5KSB7XG4gICAgcmV0dXJuIGdldEZyb21Mb2NhbFN0b3JhZ2Uoa2V5LCBkZWZhdWx0U2lkZWJhcnNXaWR0aFtrZXldKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFNpZGViYXJXaWR0aHMoa2V5LCBkaW1lbnNpb24pIHtcbiAgICBjb25zdCBuZXdEaW1lbnNpb24gPSBOdW1iZXIoZ2V0U2lkZWJhcldpZHRocyhrZXkpKSArIGRpbWVuc2lvbi53aWR0aDtcbiAgICBzZXRJbkxvY2FsU3RvcmFnZShrZXksIG5ld0RpbWVuc2lvbik7XG4gIH1cblxuICBpZiAocHJvcHMuc3RhbmRhbG9uZSkge1xuICAgIHJldHVybiByZW5kZXJDaGFydENvbnRhaW5lcigpO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8U3R5bGVzIGlkPVwiZXhwbG9yZS1jb250YWluZXJcIiBoZWlnaHQ9e2hlaWdodH0+XG4gICAgICA8R2xvYmFsXG4gICAgICAgIHN0eWxlcz17Y3NzYFxuICAgICAgICAgIC5uYXZiYXIge1xuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYm9keSB7XG4gICAgICAgICAgICBoZWlnaHQ6IDEwMHZoO1xuICAgICAgICAgICAgbWF4LWhlaWdodDogMTAwdmg7XG4gICAgICAgICAgICBvdmVyZmxvdzogaGlkZGVuO1xuICAgICAgICAgIH1cbiAgICAgICAgICAjYXBwLW1lbnUsXG4gICAgICAgICAgI2FwcCB7XG4gICAgICAgICAgICBmbGV4OiAxIDEgYXV0bztcbiAgICAgICAgICB9XG4gICAgICAgICAgI2FwcCB7XG4gICAgICAgICAgICBmbGV4LWJhc2lzOiAxMDAlO1xuICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICAgICAgICAgIGhlaWdodDogMTAwJTtcbiAgICAgICAgICB9XG4gICAgICAgICAgI2FwcC1tZW51IHtcbiAgICAgICAgICAgIGZsZXgtc2hyaW5rOiAwO1xuICAgICAgICAgIH1cbiAgICAgICAgYH1cbiAgICAgIC8+XG4gICAgICB7c2hvd2luZ01vZGFsICYmIChcbiAgICAgICAgPFNhdmVNb2RhbFxuICAgICAgICAgIG9uSGlkZT17dG9nZ2xlTW9kYWx9XG4gICAgICAgICAgYWN0aW9ucz17cHJvcHMuYWN0aW9uc31cbiAgICAgICAgICBmb3JtX2RhdGE9e3Byb3BzLmZvcm1fZGF0YX1cbiAgICAgICAgICBzbGljZU5hbWU9e3Byb3BzLnNsaWNlTmFtZX1cbiAgICAgICAgICBkYXNoYm9hcmRJZD17cHJvcHMuZGFzaGJvYXJkSWR9XG4gICAgICAgIC8+XG4gICAgICApfVxuICAgICAgPFJlc2l6YWJsZVxuICAgICAgICBvblJlc2l6ZVN0b3A9eyhldnQsIGRpcmVjdGlvbiwgcmVmLCBkKSA9PlxuICAgICAgICAgIHNldFNpZGViYXJXaWR0aHMoc3RvcmFnZUtleXMuZGF0YVNvdXJjZVdpZHRoLCBkKVxuICAgICAgICB9XG4gICAgICAgIGRlZmF1bHRTaXplPXt7XG4gICAgICAgICAgd2lkdGg6IGdldFNpZGViYXJXaWR0aHMoc3RvcmFnZUtleXMuZGF0YVNvdXJjZVdpZHRoKSxcbiAgICAgICAgICBoZWlnaHQ6ICcxMDAlJyxcbiAgICAgICAgfX1cbiAgICAgICAgbWluV2lkdGg9e2RlZmF1bHRTaWRlYmFyc1dpZHRoW3N0b3JhZ2VLZXlzLmRhdGFTb3VyY2VXaWR0aF19XG4gICAgICAgIG1heFdpZHRoPVwiMzMlXCJcbiAgICAgICAgZW5hYmxlPXt7IHJpZ2h0OiB0cnVlIH19XG4gICAgICAgIGNsYXNzTmFtZT17XG4gICAgICAgICAgaXNDb2xsYXBzZWQgPyAnbm8tc2hvdycgOiAnZXhwbG9yZS1jb2x1bW4gZGF0YS1zb3VyY2Utc2VsZWN0aW9uJ1xuICAgICAgICB9XG4gICAgICA+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGl0bGUtY29udGFpbmVyXCI+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwiaG9yaXpvbnQgYWwtdGV4dFwiPnt0KCdEYXRhc2V0Jyl9PC9zcGFuPlxuICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICByb2xlPVwiYnV0dG9uXCJcbiAgICAgICAgICAgIHRhYkluZGV4PXswfVxuICAgICAgICAgICAgY2xhc3NOYW1lPVwiYWN0aW9uLWJ1dHRvblwiXG4gICAgICAgICAgICBvbkNsaWNrPXt0b2dnbGVDb2xsYXBzZX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8SWNvbnMuRXhwYW5kXG4gICAgICAgICAgICAgIGNsYXNzTmFtZT1cImNvbGxhcHNlLWljb25cIlxuICAgICAgICAgICAgICBpY29uQ29sb3I9e3RoZW1lLmNvbG9ycy5wcmltYXJ5LmJhc2V9XG4gICAgICAgICAgICAgIGljb25TaXplPVwibFwiXG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxEYXRhU291cmNlUGFuZWxcbiAgICAgICAgICBkYXRhc291cmNlPXtwcm9wcy5kYXRhc291cmNlfVxuICAgICAgICAgIGNvbnRyb2xzPXtwcm9wcy5jb250cm9sc31cbiAgICAgICAgICBhY3Rpb25zPXtwcm9wcy5hY3Rpb25zfVxuICAgICAgICAvPlxuICAgICAgPC9SZXNpemFibGU+XG4gICAgICB7aXNDb2xsYXBzZWQgPyAoXG4gICAgICAgIDxkaXZcbiAgICAgICAgICBjbGFzc05hbWU9XCJzaWRlYmFyXCJcbiAgICAgICAgICBvbkNsaWNrPXt0b2dnbGVDb2xsYXBzZX1cbiAgICAgICAgICBkYXRhLXRlc3Q9XCJvcGVuLWRhdGFzb3VyY2UtdGFiXCJcbiAgICAgICAgICByb2xlPVwiYnV0dG9uXCJcbiAgICAgICAgICB0YWJJbmRleD17MH1cbiAgICAgICAgPlxuICAgICAgICAgIDxzcGFuIHJvbGU9XCJidXR0b25cIiB0YWJJbmRleD17MH0gY2xhc3NOYW1lPVwiYWN0aW9uLWJ1dHRvblwiPlxuICAgICAgICAgICAgPFRvb2x0aXAgdGl0bGU9e3QoJ09wZW4gRGF0YXNvdXJjZSB0YWInKX0+XG4gICAgICAgICAgICAgIDxJY29ucy5Db2xsYXBzZVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT1cImNvbGxhcHNlLWljb25cIlxuICAgICAgICAgICAgICAgIGljb25Db2xvcj17dGhlbWUuY29sb3JzLnByaW1hcnkuYmFzZX1cbiAgICAgICAgICAgICAgICBpY29uU2l6ZT1cImxcIlxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9Ub29sdGlwPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8SWNvbnMuRGF0YXNldFBoeXNpY2FsXG4gICAgICAgICAgICBjc3M9e3sgbWFyZ2luVG9wOiB0aGVtZS5ncmlkVW5pdCAqIDIgfX1cbiAgICAgICAgICAgIGljb25TaXplPVwibFwiXG4gICAgICAgICAgICBpY29uQ29sb3I9e3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUuYmFzZX1cbiAgICAgICAgICAvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICkgOiBudWxsfVxuICAgICAgPFJlc2l6YWJsZVxuICAgICAgICBvblJlc2l6ZVN0b3A9eyhldnQsIGRpcmVjdGlvbiwgcmVmLCBkKSA9PlxuICAgICAgICAgIHNldFNpZGViYXJXaWR0aHMoc3RvcmFnZUtleXMuY29udHJvbHNXaWR0aCwgZClcbiAgICAgICAgfVxuICAgICAgICBkZWZhdWx0U2l6ZT17e1xuICAgICAgICAgIHdpZHRoOiBnZXRTaWRlYmFyV2lkdGhzKHN0b3JhZ2VLZXlzLmNvbnRyb2xzV2lkdGgpLFxuICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICB9fVxuICAgICAgICBtaW5XaWR0aD17ZGVmYXVsdFNpZGViYXJzV2lkdGhbc3RvcmFnZUtleXMuY29udHJvbHNXaWR0aF19XG4gICAgICAgIG1heFdpZHRoPVwiMzMlXCJcbiAgICAgICAgZW5hYmxlPXt7IHJpZ2h0OiB0cnVlIH19XG4gICAgICAgIGNsYXNzTmFtZT1cImNvbC1zbS0zIGV4cGxvcmUtY29sdW1uIGNvbnRyb2xzLWNvbHVtblwiXG4gICAgICA+XG4gICAgICAgIDxRdWVyeUFuZFNhdmVCdG5zXG4gICAgICAgICAgY2FuQWRkPXshIShwcm9wcy5jYW5fYWRkIHx8IHByb3BzLmNhbl9vdmVyd3JpdGUpfVxuICAgICAgICAgIG9uUXVlcnk9e29uUXVlcnl9XG4gICAgICAgICAgb25TYXZlPXt0b2dnbGVNb2RhbH1cbiAgICAgICAgICBvblN0b3A9e29uU3RvcH1cbiAgICAgICAgICBsb2FkaW5nPXtwcm9wcy5jaGFydC5jaGFydFN0YXR1cyA9PT0gJ2xvYWRpbmcnfVxuICAgICAgICAgIGNoYXJ0SXNTdGFsZT17Y2hhcnRJc1N0YWxlfVxuICAgICAgICAgIGVycm9yTWVzc2FnZT17cmVuZGVyRXJyb3JNZXNzYWdlKCl9XG4gICAgICAgICAgZGF0YXNvdXJjZVR5cGU9e3Byb3BzLmRhdGFzb3VyY2VfdHlwZX1cbiAgICAgICAgLz5cbiAgICAgICAgPENvbm5lY3RlZENvbnRyb2xQYW5lbHNDb250YWluZXJcbiAgICAgICAgICBhY3Rpb25zPXtwcm9wcy5hY3Rpb25zfVxuICAgICAgICAgIGZvcm1fZGF0YT17cHJvcHMuZm9ybV9kYXRhfVxuICAgICAgICAgIGNvbnRyb2xzPXtwcm9wcy5jb250cm9sc31cbiAgICAgICAgICBkYXRhc291cmNlX3R5cGU9e3Byb3BzLmRhdGFzb3VyY2VfdHlwZX1cbiAgICAgICAgICBpc0RhdGFzb3VyY2VNZXRhTG9hZGluZz17cHJvcHMuaXNEYXRhc291cmNlTWV0YUxvYWRpbmd9XG4gICAgICAgIC8+XG4gICAgICA8L1Jlc2l6YWJsZT5cbiAgICAgIDxkaXZcbiAgICAgICAgY2xhc3NOYW1lPXtjeChcbiAgICAgICAgICAnbWFpbi1leHBsb3JlLWNvbnRlbnQnLFxuICAgICAgICAgIGlzQ29sbGFwc2VkID8gJ2NvbC1zbS05JyA6ICdjb2wtc20tNycsXG4gICAgICAgICl9XG4gICAgICA+XG4gICAgICAgIHtyZW5kZXJDaGFydENvbnRhaW5lcigpfVxuICAgICAgPC9kaXY+XG4gICAgPC9TdHlsZXM+XG4gICk7XG59XG5cbkV4cGxvcmVWaWV3Q29udGFpbmVyLnByb3BUeXBlcyA9IHByb3BUeXBlcztcblxuZnVuY3Rpb24gbWFwU3RhdGVUb1Byb3BzKHN0YXRlKSB7XG4gIGNvbnN0IHsgZXhwbG9yZSwgY2hhcnRzLCBpbXByZXNzaW9uSWQsIGRhdGFNYXNrLCByZXBvcnRzIH0gPSBzdGF0ZTtcbiAgY29uc3QgZm9ybV9kYXRhID0gZ2V0Rm9ybURhdGFGcm9tQ29udHJvbHMoZXhwbG9yZS5jb250cm9scyk7XG4gIGZvcm1fZGF0YS5leHRyYV9mb3JtX2RhdGEgPSBtZXJnZUV4dHJhRm9ybURhdGEoXG4gICAgeyAuLi5mb3JtX2RhdGEuZXh0cmFfZm9ybV9kYXRhIH0sXG4gICAge1xuICAgICAgLi4uZGF0YU1hc2tbZm9ybV9kYXRhLnNsaWNlX2lkID8/IDBdPy5vd25TdGF0ZSwgLy8gMCAtIHVuc2F2ZWQgY2hhcnRcbiAgICB9LFxuICApO1xuICBjb25zdCBjaGFydEtleSA9IE9iamVjdC5rZXlzKGNoYXJ0cylbMF07XG4gIGNvbnN0IGNoYXJ0ID0gY2hhcnRzW2NoYXJ0S2V5XTtcblxuICByZXR1cm4ge1xuICAgIGlzRGF0YXNvdXJjZU1ldGFMb2FkaW5nOiBleHBsb3JlLmlzRGF0YXNvdXJjZU1ldGFMb2FkaW5nLFxuICAgIGRhdGFzb3VyY2U6IGV4cGxvcmUuZGF0YXNvdXJjZSxcbiAgICBkYXRhc291cmNlX3R5cGU6IGV4cGxvcmUuZGF0YXNvdXJjZS50eXBlLFxuICAgIGRhdGFzb3VyY2VJZDogZXhwbG9yZS5kYXRhc291cmNlX2lkLFxuICAgIGRhc2hib2FyZElkOiBleHBsb3JlLmZvcm1fZGF0YSA/IGV4cGxvcmUuZm9ybV9kYXRhLmRhc2hib2FyZElkIDogdW5kZWZpbmVkLFxuICAgIGNvbnRyb2xzOiBleHBsb3JlLmNvbnRyb2xzLFxuICAgIGNhbl9vdmVyd3JpdGU6ICEhZXhwbG9yZS5jYW5fb3ZlcndyaXRlLFxuICAgIGNhbl9hZGQ6ICEhZXhwbG9yZS5jYW5fYWRkLFxuICAgIGNhbl9kb3dubG9hZDogISFleHBsb3JlLmNhbl9kb3dubG9hZCxcbiAgICBjb2x1bW5fZm9ybWF0czogZXhwbG9yZS5kYXRhc291cmNlXG4gICAgICA/IGV4cGxvcmUuZGF0YXNvdXJjZS5jb2x1bW5fZm9ybWF0c1xuICAgICAgOiBudWxsLFxuICAgIGNvbnRhaW5lcklkOiBleHBsb3JlLnNsaWNlXG4gICAgICA/IGBzbGljZS1jb250YWluZXItJHtleHBsb3JlLnNsaWNlLnNsaWNlX2lkfWBcbiAgICAgIDogJ3NsaWNlLWNvbnRhaW5lcicsXG4gICAgaXNTdGFycmVkOiBleHBsb3JlLmlzU3RhcnJlZCxcbiAgICBzbGljZTogZXhwbG9yZS5zbGljZSxcbiAgICBzbGljZU5hbWU6IGV4cGxvcmUuc2xpY2VOYW1lLFxuICAgIHRyaWdnZXJSZW5kZXI6IGV4cGxvcmUudHJpZ2dlclJlbmRlcixcbiAgICBmb3JtX2RhdGEsXG4gICAgdGFibGVfbmFtZTogZm9ybV9kYXRhLmRhdGFzb3VyY2VfbmFtZSxcbiAgICB2aXpUeXBlOiBmb3JtX2RhdGEudml6X3R5cGUsXG4gICAgc3RhbmRhbG9uZTogZXhwbG9yZS5zdGFuZGFsb25lLFxuICAgIGZvcmNlZEhlaWdodDogZXhwbG9yZS5mb3JjZWRfaGVpZ2h0LFxuICAgIGNoYXJ0LFxuICAgIHRpbWVvdXQ6IGV4cGxvcmUuY29tbW9uLmNvbmYuU1VQRVJTRVRfV0VCU0VSVkVSX1RJTUVPVVQsXG4gICAgb3duU3RhdGU6IGRhdGFNYXNrW2Zvcm1fZGF0YS5zbGljZV9pZCA/PyAwXT8ub3duU3RhdGUsIC8vIDAgLSB1bnNhdmVkIGNoYXJ0XG4gICAgaW1wcmVzc2lvbklkLFxuICAgIHVzZXI6IGV4cGxvcmUudXNlcixcbiAgICByZXBvcnRzLFxuICB9O1xufVxuXG5mdW5jdGlvbiBtYXBEaXNwYXRjaFRvUHJvcHMoZGlzcGF0Y2gpIHtcbiAgY29uc3QgYWN0aW9ucyA9IHtcbiAgICAuLi5leHBsb3JlQWN0aW9ucyxcbiAgICAuLi5zYXZlTW9kYWxBY3Rpb25zLFxuICAgIC4uLmNoYXJ0QWN0aW9ucyxcbiAgICAuLi5sb2dBY3Rpb25zLFxuICB9O1xuICByZXR1cm4ge1xuICAgIGFjdGlvbnM6IGJpbmRBY3Rpb25DcmVhdG9ycyhhY3Rpb25zLCBkaXNwYXRjaCksXG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QoXG4gIG1hcFN0YXRlVG9Qcm9wcyxcbiAgbWFwRGlzcGF0Y2hUb1Byb3BzLFxuKShFeHBsb3JlVmlld0NvbnRhaW5lcik7XG4iXX0= */\"),\n      iconSize: \"l\",\n      iconColor: theme.colors.grayscale.base, __self: this, __source: { fileName: _jsxFileName, lineNumber: 531, columnNumber: 11 } })) :\n\n\n    null,\n    ___EmotionJSX(Resizable, {\n      onResizeStop: (evt, direction, ref, d) =>\n      setSidebarWidths(storageKeys.controlsWidth, d),\n\n      defaultSize: {\n        width: getSidebarWidths(storageKeys.controlsWidth),\n        height: '100%' },\n\n      minWidth: defaultSidebarsWidth[storageKeys.controlsWidth],\n      maxWidth: \"33%\",\n      enable: { right: true },\n      className: \"col-sm-3 explore-column controls-column\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 538, columnNumber: 7 } },\n\n    ___EmotionJSX(QueryAndSaveBtns, {\n      canAdd: !!(props.can_add || props.can_overwrite),\n      onQuery: onQuery,\n      onSave: toggleModal,\n      onStop: onStop,\n      loading: props.chart.chartStatus === 'loading',\n      chartIsStale: chartIsStale,\n      errorMessage: renderErrorMessage(),\n      datasourceType: props.datasource_type, __self: this, __source: { fileName: _jsxFileName, lineNumber: 551, columnNumber: 9 } }),\n\n    ___EmotionJSX(ConnectedControlPanelsContainer, {\n      actions: props.actions,\n      form_data: props.form_data,\n      controls: props.controls,\n      datasource_type: props.datasource_type,\n      isDatasourceMetaLoading: props.isDatasourceMetaLoading, __self: this, __source: { fileName: _jsxFileName, lineNumber: 561, columnNumber: 9 } })),\n\n\n    ___EmotionJSX(\"div\", {\n      className: cx(\n      'main-explore-content',\n      isCollapsed ? 'col-sm-9' : 'col-sm-7'), __self: this, __source: { fileName: _jsxFileName, lineNumber: 569, columnNumber: 7 } },\n\n\n    renderChartContainer())));\n\n\n\n}__signature__(ExploreViewContainer, \"usePluginContext{dynamicPluginContext}\\nusePrevious{wasDynamicPluginLoading}\\nusePrevious{previousControls}\\nuseState{[lastQueriedControls, setLastQueriedControls](props.controls)}\\nuseWindowSize{windowSize}\\nuseState{[showingModal, setShowingModal](false)}\\nuseState{[isCollapsed, setIsCollapsed](false)}\\nuseTheme{theme}\\nuseCallback{addHistory}\\nuseCallback{onQuery}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseMemo{chartIsStale}\\nuseEffect{}\", () => [usePluginContext, usePrevious, usePrevious, useWindowSize, useTheme]);\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {var _dataMask, _form_data$slice_id, _dataMask2, _form_data$slice_id2;\n  const { explore, charts, impressionId, dataMask, reports } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n  { ...form_data.extra_form_data },\n  {\n    ...((_dataMask = dataMask[(_form_data$slice_id = form_data.slice_id) != null ? _form_data$slice_id : 0]) == null ? void 0 : _dataMask.ownState) // 0 - unsaved chart\n  });\n\n  const chartKey = Object.keys(charts)[0];\n  const chart = charts[chartKey];\n\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource ?\n    explore.datasource.column_formats :\n    null,\n    containerId: explore.slice ?\n    `slice-container-${explore.slice.slice_id}` :\n    'slice-container',\n    isStarred: explore.isStarred,\n    slice: explore.slice,\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: (_dataMask2 = dataMask[(_form_data$slice_id2 = form_data.slice_id) != null ? _form_data$slice_id2 : 0]) == null ? void 0 : _dataMask2.ownState, // 0 - unsaved chart\n    impressionId,\n    user: explore.user,\n    reports };\n\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions };\n\n  return {\n    actions: bindActionCreators(actions, dispatch) };\n\n}const _default =\n\nconnect(\nmapStateToProps,\nmapDispatchToProps)(\nExploreViewContainer);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(getWindowSize, \"getWindowSize\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(useWindowSize, \"useWindowSize\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(ExploreViewContainer, \"ExploreViewContainer\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");reactHotLoader.register(_default, \"default\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/ExploreViewContainer.jsx"],"names":["React","useCallback","useEffect","useMemo","useState","PropTypes","bindActionCreators","connect","styled","t","css","useTheme","Resizable","usePluginContext","Global","Tooltip","usePrevious","Icons","getFromLocalStorage","setInLocalStorage","URL_PARAMS","cx","chartActions","fetchDatasourceMetadata","chartPropShape","mergeExtraFormData","ExploreChartPanel","ConnectedControlPanelsContainer","SaveModal","QueryAndSaveBtns","DataSourcePanel","getExploreLongUrl","areObjectsEqual","getFormDataFromControls","exploreActions","saveModalActions","logActions","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","propTypes","height","string","width","actions","object","isRequired","datasource_type","dashboardId","number","isDatasourceMetaLoading","bool","chart","slice","sliceName","controls","forcedHeight","form_data","standalone","timeout","impressionId","vizType","Styles","div","theme","colors","grayscale","light5","light2","gridUnit","light4","light1","typography","sizes","s","primary","base","getWindowSize","window","innerHeight","innerWidth","useWindowSize","delayMs","size","setSize","onWindowResize","addEventListener","removeEventListener","ExploreViewContainer","props","dynamicPluginContext","dynamicPlugin","dynamicPlugins","isDynamicPluginLoading","mounting","wasDynamicPluginLoading","previousControls","lastQueriedControls","setLastQueriedControls","windowSize","showingModal","setShowingModal","isCollapsed","setIsCollapsed","navHeight","storageKeys","controlsWidth","dataSourceWidth","defaultSidebarsWidth","controls_width","datasource_width","addHistory","isReplace","title","payload","longUrl","name","history","replaceState","pushState","e","console","warn","handlePopstate","formData","state","Object","keys","length","setExploreControls","postChartFormData","id","onQuery","triggerQuery","handleKeydown","event","controlOrCommand","ctrlKey","metaKey","isEnter","key","keyCode","isS","saveSlice","action","slice_id","slice_name","add_to_dash","goto_dash","then","data","location","slice_url","onStop","queryController","abort","toggleModal","toggleCollapse","logEvent","document","dynamicPluginControlsReady","hasError","values","some","control","validationErrors","reRenderChart","updateQueryFormData","renderTriggered","Date","getTime","datasource","value","changedControlKeys","filter","hasDisplayControlChanged","renderTrigger","ownState","chartIsStale","dontRefreshOnChange","undefined","renderErrorMessage","controlsWithErrors","errorMessages","map","uniqueErrorMessages","Set","flat","errors","message","matchingLabels","includes","label","labels","join","errorMessage","textAlign","renderChartContainer","getSidebarWidths","setSidebarWidths","dimension","newDimension","Number","evt","direction","ref","d","right","marginTop","can_add","can_overwrite","chartStatus","mapStateToProps","explore","charts","dataMask","reports","extra_form_data","chartKey","type","datasourceId","datasource_id","can_download","column_formats","containerId","isStarred","triggerRender","table_name","datasource_name","viz_type","forced_height","common","conf","SUPERSET_WEBSERVER_TIMEOUT","user","mapDispatchToProps","dispatch"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\nimport { styled, t, css, useTheme } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { Resizable } from 're-resizable';\n\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Global } from '@emotion/react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { usePrevious } from 'src/common/hooks/usePrevious';\nimport Icons from 'src/components/Icons';\nimport {\n  getFromLocalStorage,\n  setInLocalStorage,\n} from 'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport cx from 'classnames';\nimport * as chartActions from 'src/chart/chartAction';\nimport { fetchDatasourceMetadata } from 'src/dashboard/actions/datasources';\nimport { chartPropShape } from 'src/dashboard/util/propShapes';\nimport { mergeExtraFormData } from 'src/dashboard/components/nativeFilters/utils';\nimport ExploreChartPanel from './ExploreChartPanel';\nimport ConnectedControlPanelsContainer from './ControlPanelsContainer';\nimport SaveModal from './SaveModal';\nimport QueryAndSaveBtns from './QueryAndSaveBtns';\nimport DataSourcePanel from './DatasourcePanel';\nimport { getExploreLongUrl } from '../exploreUtils';\nimport { areObjectsEqual } from '../../reduxUtils';\nimport { getFormDataFromControls } from '../controlUtils';\nimport * as exploreActions from '../actions/exploreActions';\nimport * as saveModalActions from '../actions/saveModalActions';\nimport * as logActions from '../../logger/actions';\nimport {\n  LOG_ACTIONS_MOUNT_EXPLORER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n} from '../../logger/LogUtils';\n\nconst propTypes = {\n  ...ExploreChartPanel.propTypes,\n  height: PropTypes.string,\n  width: PropTypes.string,\n  actions: PropTypes.object.isRequired,\n  datasource_type: PropTypes.string.isRequired,\n  dashboardId: PropTypes.number,\n  isDatasourceMetaLoading: PropTypes.bool.isRequired,\n  chart: chartPropShape.isRequired,\n  slice: PropTypes.object,\n  sliceName: PropTypes.string,\n  controls: PropTypes.object.isRequired,\n  forcedHeight: PropTypes.string,\n  form_data: PropTypes.object.isRequired,\n  standalone: PropTypes.number.isRequired,\n  timeout: PropTypes.number,\n  impressionId: PropTypes.string,\n  vizType: PropTypes.string,\n};\n\nconst Styles = styled.div`\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  text-align: left;\n  position: relative;\n  width: 100%;\n  max-height: 100%;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  flex-basis: 100vh;\n  align-items: stretch;\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  .explore-column {\n    display: flex;\n    flex-direction: column;\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    max-height: 100%;\n  }\n  .data-source-selection {\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n    border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .main-explore-content {\n    flex: 1;\n    min-width: ${({ theme }) => theme.gridUnit * 128}px;\n    border-left: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    .panel {\n      margin-bottom: 0;\n    }\n  }\n  .controls-column {\n    align-self: flex-start;\n    padding: 0;\n  }\n  .title-container {\n    position: relative;\n    display: flex;\n    flex-direction: row;\n    padding: 0 ${({ theme }) => 2 * theme.gridUnit}px;\n    justify-content: space-between;\n    .horizontal-text {\n      text-transform: uppercase;\n      color: ${({ theme }) => theme.colors.grayscale.light1};\n      font-size: ${({ theme }) => 4 * theme.typography.sizes.s};\n    }\n  }\n  .no-show {\n    display: none;\n  }\n  .vertical-text {\n    writing-mode: vertical-rl;\n    text-orientation: mixed;\n  }\n  .sidebar {\n    height: 100%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    padding: ${({ theme }) => 2 * theme.gridUnit}px;\n    width: ${({ theme }) => 8 * theme.gridUnit}px;\n  }\n  .callpase-icon > svg {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst getWindowSize = () => ({\n  height: window.innerHeight,\n  width: window.innerWidth,\n});\n\nfunction useWindowSize({ delayMs = 250 } = {}) {\n  const [size, setSize] = useState(getWindowSize());\n\n  useEffect(() => {\n    const onWindowResize = debounce(() => setSize(getWindowSize()), delayMs);\n    window.addEventListener('resize', onWindowResize);\n    return () => window.removeEventListener('resize', onWindowResize);\n  }, []);\n\n  return size;\n}\n\nfunction ExploreViewContainer(props) {\n  const dynamicPluginContext = usePluginContext();\n  const dynamicPlugin = dynamicPluginContext.dynamicPlugins[props.vizType];\n  const isDynamicPluginLoading = dynamicPlugin && dynamicPlugin.mounting;\n  const wasDynamicPluginLoading = usePrevious(isDynamicPluginLoading);\n\n  /** the state of controls in the previous render */\n  const previousControls = usePrevious(props.controls);\n  /** the state of controls last time a query was triggered */\n  const [lastQueriedControls, setLastQueriedControls] = useState(\n    props.controls,\n  );\n  const windowSize = useWindowSize();\n\n  const [showingModal, setShowingModal] = useState(false);\n  const [isCollapsed, setIsCollapsed] = useState(false);\n\n  const theme = useTheme();\n  const width = `${windowSize.width}px`;\n  const navHeight = props.standalone ? 0 : 90;\n  const height = props.forcedHeight\n    ? `${props.forcedHeight}px`\n    : `${windowSize.height - navHeight}px`;\n\n  const storageKeys = {\n    controlsWidth: 'controls_width',\n    dataSourceWidth: 'datasource_width',\n  };\n\n  const defaultSidebarsWidth = {\n    controls_width: 320,\n    datasource_width: 300,\n  };\n\n  const addHistory = useCallback(\n    ({ isReplace = false, title } = {}) => {\n      const payload = { ...props.form_data };\n      const longUrl = getExploreLongUrl(\n        props.form_data,\n        props.standalone ? URL_PARAMS.standalone.name : null,\n        false,\n      );\n      try {\n        if (isReplace) {\n          window.history.replaceState(payload, title, longUrl);\n        } else {\n          window.history.pushState(payload, title, longUrl);\n        }\n      } catch (e) {\n        // eslint-disable-next-line no-console\n        console.warn(\n          'Failed at altering browser history',\n          payload,\n          title,\n          longUrl,\n        );\n      }\n    },\n    [props.form_data, props.standalone],\n  );\n\n  function handlePopstate() {\n    const formData = window.history.state;\n    if (formData && Object.keys(formData).length) {\n      props.actions.setExploreControls(formData);\n      props.actions.postChartFormData(\n        formData,\n        false,\n        props.timeout,\n        props.chart.id,\n      );\n    }\n  }\n  const onQuery = useCallback(() => {\n    props.actions.triggerQuery(true, props.chart.id);\n    addHistory();\n    setLastQueriedControls(props.controls);\n  }, [props.controls, addHistory, props.actions, props.chart.id]);\n\n  function handleKeydown(event) {\n    const controlOrCommand = event.ctrlKey || event.metaKey;\n    if (controlOrCommand) {\n      const isEnter = event.key === 'Enter' || event.keyCode === 13;\n      const isS = event.key === 's' || event.keyCode === 83;\n      if (isEnter) {\n        onQuery();\n      } else if (isS) {\n        if (props.slice) {\n          props.actions\n            .saveSlice(props.form_data, {\n              action: 'overwrite',\n              slice_id: props.slice.slice_id,\n              slice_name: props.slice.slice_name,\n              add_to_dash: 'noSave',\n              goto_dash: false,\n            })\n            .then(({ data }) => {\n              window.location = data.slice.slice_url;\n            });\n        }\n      }\n    }\n  }\n\n  function onStop() {\n    if (props.chart && props.chart.queryController) {\n      props.chart.queryController.abort();\n    }\n  }\n\n  function toggleModal() {\n    setShowingModal(!showingModal);\n  }\n\n  function toggleCollapse() {\n    setIsCollapsed(!isCollapsed);\n  }\n\n  // effect to run on mount\n  useEffect(() => {\n    props.actions.logEvent(LOG_ACTIONS_MOUNT_EXPLORER);\n    addHistory({ isReplace: true });\n    window.addEventListener('popstate', handlePopstate);\n    document.addEventListener('keydown', handleKeydown);\n    return () => {\n      window.removeEventListener('popstate', handlePopstate);\n      document.removeEventListener('keydown', handleKeydown);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (wasDynamicPluginLoading && !isDynamicPluginLoading) {\n      // reload the controls now that we actually have the control config\n      props.actions.dynamicPluginControlsReady();\n    }\n  }, [isDynamicPluginLoading]);\n\n  useEffect(() => {\n    const hasError = Object.values(props.controls).some(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (!hasError) {\n      props.actions.triggerQuery(true, props.chart.id);\n    }\n  }, []);\n\n  const reRenderChart = () => {\n    props.actions.updateQueryFormData(\n      getFormDataFromControls(props.controls),\n      props.chart.id,\n    );\n    props.actions.renderTriggered(new Date().getTime(), props.chart.id);\n    addHistory();\n  };\n\n  // effect to run when controls change\n  useEffect(() => {\n    if (previousControls) {\n      if (\n        props.controls.datasource &&\n        (previousControls.datasource == null ||\n          props.controls.datasource.value !== previousControls.datasource.value)\n      ) {\n        // this should really be handled by actions\n        fetchDatasourceMetadata(props.form_data.datasource, true);\n      }\n\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof previousControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            previousControls[key].value,\n          ),\n      );\n\n      // this should also be handled by the actions that are actually changing the controls\n      const hasDisplayControlChanged = changedControlKeys.some(\n        key => props.controls[key].renderTrigger,\n      );\n      if (hasDisplayControlChanged) {\n        reRenderChart();\n      }\n    }\n  }, [props.controls, props.ownState]);\n\n  const chartIsStale = useMemo(() => {\n    if (lastQueriedControls) {\n      const changedControlKeys = Object.keys(props.controls).filter(\n        key =>\n          typeof lastQueriedControls[key] !== 'undefined' &&\n          !areObjectsEqual(\n            props.controls[key].value,\n            lastQueriedControls[key].value,\n          ),\n      );\n\n      return changedControlKeys.some(\n        key =>\n          !props.controls[key].renderTrigger &&\n          !props.controls[key].dontRefreshOnChange,\n      );\n    }\n    return false;\n  }, [lastQueriedControls, props.controls]);\n\n  useEffect(() => {\n    if (props.ownState !== undefined) {\n      onQuery();\n      reRenderChart();\n    }\n  }, [props.ownState]);\n\n  if (chartIsStale) {\n    props.actions.logEvent(LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS);\n  }\n\n  function renderErrorMessage() {\n    // Returns an error message as a node if any errors are in the store\n    const controlsWithErrors = Object.values(props.controls).filter(\n      control =>\n        control.validationErrors && control.validationErrors.length > 0,\n    );\n    if (controlsWithErrors.length === 0) {\n      return null;\n    }\n\n    const errorMessages = controlsWithErrors.map(\n      control => control.validationErrors,\n    );\n    const uniqueErrorMessages = [...new Set(errorMessages.flat())];\n\n    const errors = uniqueErrorMessages\n      .map(message => {\n        const matchingLabels = controlsWithErrors\n          .filter(control => control.validationErrors?.includes(message))\n          .map(control => control.label);\n        return [matchingLabels, message];\n      })\n      .map(([labels, message]) => (\n        <div key={message}>\n          {labels.length > 1 ? t('Controls labeled ') : t('Control labeled ')}\n          <strong>{` ${labels.join(', ')}`}</strong>\n          <span>: {message}</span>\n        </div>\n      ));\n\n    let errorMessage;\n    if (errors.length > 0) {\n      errorMessage = <div style={{ textAlign: 'left' }}>{errors}</div>;\n    }\n    return errorMessage;\n  }\n\n  function renderChartContainer() {\n    return (\n      <ExploreChartPanel\n        width={width}\n        height={height}\n        {...props}\n        errorMessage={renderErrorMessage()}\n        refreshOverlayVisible={chartIsStale}\n        addHistory={addHistory}\n        onQuery={onQuery}\n      />\n    );\n  }\n\n  function getSidebarWidths(key) {\n    return getFromLocalStorage(key, defaultSidebarsWidth[key]);\n  }\n\n  function setSidebarWidths(key, dimension) {\n    const newDimension = Number(getSidebarWidths(key)) + dimension.width;\n    setInLocalStorage(key, newDimension);\n  }\n\n  if (props.standalone) {\n    return renderChartContainer();\n  }\n\n  return (\n    <Styles id=\"explore-container\" height={height}>\n      <Global\n        styles={css`\n          .navbar {\n            margin-bottom: 0;\n          }\n          body {\n            height: 100vh;\n            max-height: 100vh;\n            overflow: hidden;\n          }\n          #app-menu,\n          #app {\n            flex: 1 1 auto;\n          }\n          #app {\n            flex-basis: 100%;\n            overflow: hidden;\n            height: 100%;\n          }\n          #app-menu {\n            flex-shrink: 0;\n          }\n        `}\n      />\n      {showingModal && (\n        <SaveModal\n          onHide={toggleModal}\n          actions={props.actions}\n          form_data={props.form_data}\n          sliceName={props.sliceName}\n          dashboardId={props.dashboardId}\n        />\n      )}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.dataSourceWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.dataSourceWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.dataSourceWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className={\n          isCollapsed ? 'no-show' : 'explore-column data-source-selection'\n        }\n      >\n        <div className=\"title-container\">\n          <span className=\"horizont al-text\">{t('Dataset')}</span>\n          <span\n            role=\"button\"\n            tabIndex={0}\n            className=\"action-button\"\n            onClick={toggleCollapse}\n          >\n            <Icons.Expand\n              className=\"collapse-icon\"\n              iconColor={theme.colors.primary.base}\n              iconSize=\"l\"\n            />\n          </span>\n        </div>\n        <DataSourcePanel\n          datasource={props.datasource}\n          controls={props.controls}\n          actions={props.actions}\n        />\n      </Resizable>\n      {isCollapsed ? (\n        <div\n          className=\"sidebar\"\n          onClick={toggleCollapse}\n          data-test=\"open-datasource-tab\"\n          role=\"button\"\n          tabIndex={0}\n        >\n          <span role=\"button\" tabIndex={0} className=\"action-button\">\n            <Tooltip title={t('Open Datasource tab')}>\n              <Icons.Collapse\n                className=\"collapse-icon\"\n                iconColor={theme.colors.primary.base}\n                iconSize=\"l\"\n              />\n            </Tooltip>\n          </span>\n          <Icons.DatasetPhysical\n            css={{ marginTop: theme.gridUnit * 2 }}\n            iconSize=\"l\"\n            iconColor={theme.colors.grayscale.base}\n          />\n        </div>\n      ) : null}\n      <Resizable\n        onResizeStop={(evt, direction, ref, d) =>\n          setSidebarWidths(storageKeys.controlsWidth, d)\n        }\n        defaultSize={{\n          width: getSidebarWidths(storageKeys.controlsWidth),\n          height: '100%',\n        }}\n        minWidth={defaultSidebarsWidth[storageKeys.controlsWidth]}\n        maxWidth=\"33%\"\n        enable={{ right: true }}\n        className=\"col-sm-3 explore-column controls-column\"\n      >\n        <QueryAndSaveBtns\n          canAdd={!!(props.can_add || props.can_overwrite)}\n          onQuery={onQuery}\n          onSave={toggleModal}\n          onStop={onStop}\n          loading={props.chart.chartStatus === 'loading'}\n          chartIsStale={chartIsStale}\n          errorMessage={renderErrorMessage()}\n          datasourceType={props.datasource_type}\n        />\n        <ConnectedControlPanelsContainer\n          actions={props.actions}\n          form_data={props.form_data}\n          controls={props.controls}\n          datasource_type={props.datasource_type}\n          isDatasourceMetaLoading={props.isDatasourceMetaLoading}\n        />\n      </Resizable>\n      <div\n        className={cx(\n          'main-explore-content',\n          isCollapsed ? 'col-sm-9' : 'col-sm-7',\n        )}\n      >\n        {renderChartContainer()}\n      </div>\n    </Styles>\n  );\n}\n\nExploreViewContainer.propTypes = propTypes;\n\nfunction mapStateToProps(state) {\n  const { explore, charts, impressionId, dataMask, reports } = state;\n  const form_data = getFormDataFromControls(explore.controls);\n  form_data.extra_form_data = mergeExtraFormData(\n    { ...form_data.extra_form_data },\n    {\n      ...dataMask[form_data.slice_id ?? 0]?.ownState, // 0 - unsaved chart\n    },\n  );\n  const chartKey = Object.keys(charts)[0];\n  const chart = charts[chartKey];\n\n  return {\n    isDatasourceMetaLoading: explore.isDatasourceMetaLoading,\n    datasource: explore.datasource,\n    datasource_type: explore.datasource.type,\n    datasourceId: explore.datasource_id,\n    dashboardId: explore.form_data ? explore.form_data.dashboardId : undefined,\n    controls: explore.controls,\n    can_overwrite: !!explore.can_overwrite,\n    can_add: !!explore.can_add,\n    can_download: !!explore.can_download,\n    column_formats: explore.datasource\n      ? explore.datasource.column_formats\n      : null,\n    containerId: explore.slice\n      ? `slice-container-${explore.slice.slice_id}`\n      : 'slice-container',\n    isStarred: explore.isStarred,\n    slice: explore.slice,\n    sliceName: explore.sliceName,\n    triggerRender: explore.triggerRender,\n    form_data,\n    table_name: form_data.datasource_name,\n    vizType: form_data.viz_type,\n    standalone: explore.standalone,\n    forcedHeight: explore.forced_height,\n    chart,\n    timeout: explore.common.conf.SUPERSET_WEBSERVER_TIMEOUT,\n    ownState: dataMask[form_data.slice_id ?? 0]?.ownState, // 0 - unsaved chart\n    impressionId,\n    user: explore.user,\n    reports,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  const actions = {\n    ...exploreActions,\n    ...saveModalActions,\n    ...chartActions,\n    ...logActions,\n  };\n  return {\n    actions: bindActionCreators(actions, dispatch),\n  };\n}\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(ExploreViewContainer);\n"]},"metadata":{},"sourceType":"module"}