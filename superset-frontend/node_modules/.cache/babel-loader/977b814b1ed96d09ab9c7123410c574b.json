{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport rison from 'rison';\nimport { styled, t, SupersetClient } from '@superset-ui/core';\nimport { Steps } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { FormLabel } from 'src/components/Form';\nimport { Tooltip } from 'src/components/Tooltip';\nimport VizTypeGallery, { MAX_ADVISABLE_VIZ_GALLERY_WIDTH } from 'src/explore/components/controls/VizTypeControl/VizTypeGallery';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst ESTIMATED_NAV_HEIGHT = 56;\nconst ELEMENTS_EXCEPT_VIZ_GALLERY = ESTIMATED_NAV_HEIGHT + 250;\nconst StyledContainer = styled.div`\n  ${({ theme }) => `\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    max-width: ${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px;\n    max-height: calc(100vh - ${ESTIMATED_NAV_HEIGHT}px);\n    border-radius: ${theme.gridUnit}px;\n    background-color: ${theme.colors.grayscale.light5};\n    margin-left: auto;\n    margin-right: auto;\n    padding-left: ${theme.gridUnit * 4}px;\n    padding-right: ${theme.gridUnit * 4}px;\n    padding-bottom: ${theme.gridUnit * 4}px;\n\n    h3 {\n      padding-bottom: ${theme.gridUnit * 3}px;\n    }\n\n    & .dataset {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      margin-bottom: ${theme.gridUnit * 2}px;\n\n      & > div {\n        min-width: 200px;\n        width: 300px;\n      }\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-left: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    & .viz-gallery {\n      border: 1px solid ${theme.colors.grayscale.light2};\n      border-radius: ${theme.gridUnit}px;\n      margin: ${theme.gridUnit}px 0px;\n      max-height: calc(100vh - ${ELEMENTS_EXCEPT_VIZ_GALLERY}px);\n      flex: 1;\n    }\n\n    & .footer {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-right: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    /* The following extra ampersands (&&&&) are used to boost selector specificity */\n\n    &&&& .ant-steps-item-tail {\n      display: none;\n    }\n\n    &&&& .ant-steps-item-icon {\n      margin-right: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 5}px;\n      height: ${theme.gridUnit * 5}px;\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-title {\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-content {\n      overflow: unset;\n\n      .ant-steps-item-description {\n        margin-top: ${theme.gridUnit}px;\n      }\n    }\n\n    &&&& .ant-tooltip-open {\n      display: inline;\n    }\n\n    &&&& .ant-select-selector {\n      padding: 0;\n    }\n\n    &&&& .ant-select-selection-placeholder {\n      padding-left: ${theme.gridUnit * 3}px;\n    }\n  `}\n`;\nconst TooltipContent = styled.div`\n  ${({ theme, hasDescription }) => `\n    .tooltip-header {\n      font-size: ${hasDescription ? theme.typography.sizes.l : theme.typography.sizes.s}px;\n      font-weight: ${hasDescription ?\ntheme.typography.weights.bold :\ntheme.typography.weights.normal};\n    }\n\n    .tooltip-description {\n      margin-top: ${theme.gridUnit * 2}px;\n      display: -webkit-box;\n      -webkit-line-clamp: 20;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}\n`;\nconst StyledLabel = styled.span`\n  ${({ theme }) => `\n    position: absolute;\n    left: ${theme.gridUnit * 3}px;\n    right: ${theme.gridUnit * 3}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  `}\n`;\nexport default class AddSliceContainer extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      visType: null };\n\n    this.changeDatasource = this.changeDatasource.bind(this);\n    this.changeVisType = this.changeVisType.bind(this);\n    this.gotoSlice = this.gotoSlice.bind(this);\n    this.newLabel = this.newLabel.bind(this);\n    this.loadDatasources = this.loadDatasources.bind(this);\n  }\n  exploreUrl() {var _this$state$datasourc;\n    const formData = encodeURIComponent(JSON.stringify({\n      viz_type: this.state.visType,\n      datasource: (_this$state$datasourc = this.state.datasource) == null ? void 0 : _this$state$datasourc.value }));\n\n    return `/superset/explore/?form_data=${formData}`;\n  }\n  gotoSlice() {\n    window.location.href = this.exploreUrl();\n  }\n  changeDatasource(datasource) {\n    this.setState({ datasource });\n  }\n  changeVisType(visType) {\n    this.setState({ visType });\n  }\n  isBtnDisabled() {var _this$state$datasourc2;\n    return !((_this$state$datasourc2 = this.state.datasource) != null && _this$state$datasourc2.value && this.state.visType);\n  }\n  newLabel(item) {\n    return ___EmotionJSX(Tooltip, { mouseEnterDelay: 1, placement: \"right\", title: ___EmotionJSX(TooltipContent, { hasDescription: !!item.description, __self: this, __source: { fileName: _jsxFileName, lineNumber: 187, columnNumber: 71 } },\n      ___EmotionJSX(\"div\", { className: \"tooltip-header\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 188, columnNumber: 13 } }, item.table_name),\n      item.description && ___EmotionJSX(\"div\", { className: \"tooltip-description\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 189, columnNumber: 35 } }, item.description)), __self: this, __source: { fileName: _jsxFileName, lineNumber: 187, columnNumber: 17 } },\n\n    ___EmotionJSX(StyledLabel, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 191, columnNumber: 9 } }, item.table_name));\n\n  }\n  loadDatasources(search, page, pageSize) {\n    const query = rison.encode({\n      columns: ['id', 'table_name', 'description', 'datasource_type'],\n      filters: [{ col: 'table_name', opr: 'ct', value: search }],\n      page,\n      page_size: pageSize,\n      order_column: 'table_name',\n      order_direction: 'asc' });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/dataset/?q=${query}` }).\n    then((response) => {\n      const list = response.json.result.\n      map((item) => ({\n        value: `${item.id}__${item.datasource_type}`,\n        customLabel: this.newLabel(item),\n        label: item.table_name })).\n\n      sort((a, b) => a.label.localeCompare(b.label));\n      return {\n        data: list,\n        totalCount: response.json.count };\n\n    });\n  }\n  render() {var _this$state$datasourc3;\n    const isButtonDisabled = this.isBtnDisabled();\n    return ___EmotionJSX(StyledContainer, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 221, columnNumber: 17 } },\n    ___EmotionJSX(\"h3\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 222, columnNumber: 9 } }, t('Create a new chart')),\n    ___EmotionJSX(Steps, { direction: \"vertical\", size: \"small\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 223, columnNumber: 9 } },\n    ___EmotionJSX(Steps.Step, { title: ___EmotionJSX(FormLabel, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 224, columnNumber: 30 } }, t('Choose a dataset')), status: (_this$state$datasourc3 = this.state.datasource) != null && _this$state$datasourc3.value ? 'finish' : 'process', description: ___EmotionJSX(\"div\", { className: \"dataset\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 224, columnNumber: 152 } },\n      ___EmotionJSX(Select, { autoFocus: true, ariaLabel: t('Dataset'), name: \"select-datasource\", onChange: this.changeDatasource, options: this.loadDatasources, placeholder: t('Choose a dataset'), showSearch: true, value: this.state.datasource, __self: this, __source: { fileName: _jsxFileName, lineNumber: 225, columnNumber: 17 } }),\n      ___EmotionJSX(\"span\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 226, columnNumber: 17 } },\n      t('Instructions to add a dataset are available in the Superset tutorial.'), ' ',\n      ___EmotionJSX(\"a\", { href: \"https://superset.apache.org/docs/creating-charts-dashboards/first-dashboard#adding-a-new-table\", rel: \"noopener noreferrer\", target: \"_blank\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 228, columnNumber: 19 } },\n      ___EmotionJSX(\"i\", { className: \"fa fa-external-link\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 229, columnNumber: 21 } })))), __self: this, __source: { fileName: _jsxFileName, lineNumber: 224, columnNumber: 11 } }),\n\n\n\n    ___EmotionJSX(Steps.Step, { title: ___EmotionJSX(FormLabel, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 233, columnNumber: 30 } }, t('Choose chart type')), status: this.state.visType ? 'finish' : 'process', description: ___EmotionJSX(VizTypeGallery, { className: \"viz-gallery\", onChange: this.changeVisType, selectedViz: this.state.visType, __self: this, __source: { fileName: _jsxFileName, lineNumber: 233, columnNumber: 143 } }), __self: this, __source: { fileName: _jsxFileName, lineNumber: 233, columnNumber: 11 } })),\n\n    ___EmotionJSX(\"div\", { className: \"footer\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 235, columnNumber: 9 } },\n    isButtonDisabled && ___EmotionJSX(\"span\", { __self: this, __source: { fileName: _jsxFileName, lineNumber: 236, columnNumber: 33 } },\n    t('Please select both a Dataset and a Chart type to proceed')),\n\n    ___EmotionJSX(Button, { buttonStyle: \"primary\", disabled: isButtonDisabled, onClick: this.gotoSlice, __self: this, __source: { fileName: _jsxFileName, lineNumber: 239, columnNumber: 11 } },\n    t('Create new chart'))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(ESTIMATED_NAV_HEIGHT, \"ESTIMATED_NAV_HEIGHT\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx\");reactHotLoader.register(ELEMENTS_EXCEPT_VIZ_GALLERY, \"ELEMENTS_EXCEPT_VIZ_GALLERY\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx\");reactHotLoader.register(StyledContainer, \"StyledContainer\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx\");reactHotLoader.register(TooltipContent, \"TooltipContent\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx\");reactHotLoader.register(StyledLabel, \"StyledLabel\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx\");reactHotLoader.register(AddSliceContainer, \"AddSliceContainer\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/addSlice/AddSliceContainer.tsx"],"names":[],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport rison from 'rison';\nimport { styled, t, SupersetClient, JsonResponse } from '@superset-ui/core';\nimport { Steps } from 'src/common/components';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { FormLabel } from 'src/components/Form';\nimport { Tooltip } from 'src/components/Tooltip';\n\nimport VizTypeGallery, {\n  MAX_ADVISABLE_VIZ_GALLERY_WIDTH,\n} from 'src/explore/components/controls/VizTypeControl/VizTypeGallery';\n\ntype Dataset = {\n  id: number;\n  table_name: string;\n  description: string;\n  datasource_type: string;\n};\n\nexport type AddSliceContainerProps = {};\n\nexport type AddSliceContainerState = {\n  datasource?: { label: string; value: string };\n  visType: string | null;\n};\n\nconst ESTIMATED_NAV_HEIGHT = 56;\nconst ELEMENTS_EXCEPT_VIZ_GALLERY = ESTIMATED_NAV_HEIGHT + 250;\n\nconst StyledContainer = styled.div`\n  ${({ theme }) => `\n    flex: 1 1 auto;\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n    width: 100%;\n    max-width: ${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px;\n    max-height: calc(100vh - ${ESTIMATED_NAV_HEIGHT}px);\n    border-radius: ${theme.gridUnit}px;\n    background-color: ${theme.colors.grayscale.light5};\n    margin-left: auto;\n    margin-right: auto;\n    padding-left: ${theme.gridUnit * 4}px;\n    padding-right: ${theme.gridUnit * 4}px;\n    padding-bottom: ${theme.gridUnit * 4}px;\n\n    h3 {\n      padding-bottom: ${theme.gridUnit * 3}px;\n    }\n\n    & .dataset {\n      display: flex;\n      flex-direction: row;\n      align-items: center;\n      margin-bottom: ${theme.gridUnit * 2}px;\n\n      & > div {\n        min-width: 200px;\n        width: 300px;\n      }\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-left: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    & .viz-gallery {\n      border: 1px solid ${theme.colors.grayscale.light2};\n      border-radius: ${theme.gridUnit}px;\n      margin: ${theme.gridUnit}px 0px;\n      max-height: calc(100vh - ${ELEMENTS_EXCEPT_VIZ_GALLERY}px);\n      flex: 1;\n    }\n\n    & .footer {\n      flex: 1;\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-end;\n      align-items: center;\n\n      & > span {\n        color: ${theme.colors.grayscale.light1};\n        margin-right: ${theme.gridUnit * 4}px;\n      }\n    }\n\n    /* The following extra ampersands (&&&&) are used to boost selector specificity */\n\n    &&&& .ant-steps-item-tail {\n      display: none;\n    }\n\n    &&&& .ant-steps-item-icon {\n      margin-right: ${theme.gridUnit * 2}px;\n      width: ${theme.gridUnit * 5}px;\n      height: ${theme.gridUnit * 5}px;\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-title {\n      line-height: ${theme.gridUnit * 5}px;\n    }\n\n    &&&& .ant-steps-item-content {\n      overflow: unset;\n\n      .ant-steps-item-description {\n        margin-top: ${theme.gridUnit}px;\n      }\n    }\n\n    &&&& .ant-tooltip-open {\n      display: inline;\n    }\n\n    &&&& .ant-select-selector {\n      padding: 0;\n    }\n\n    &&&& .ant-select-selection-placeholder {\n      padding-left: ${theme.gridUnit * 3}px;\n    }\n  `}\n`;\n\nconst TooltipContent = styled.div<{ hasDescription: boolean }>`\n  ${({ theme, hasDescription }) => `\n    .tooltip-header {\n      font-size: ${\n        hasDescription ? theme.typography.sizes.l : theme.typography.sizes.s\n      }px;\n      font-weight: ${\n        hasDescription\n          ? theme.typography.weights.bold\n          : theme.typography.weights.normal\n      };\n    }\n\n    .tooltip-description {\n      margin-top: ${theme.gridUnit * 2}px;\n      display: -webkit-box;\n      -webkit-line-clamp: 20;\n      -webkit-box-orient: vertical;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  `}\n`;\n\nconst StyledLabel = styled.span`\n  ${({ theme }) => `\n    position: absolute;\n    left: ${theme.gridUnit * 3}px;\n    right: ${theme.gridUnit * 3}px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  `}\n`;\n\nexport default class AddSliceContainer extends React.PureComponent<\n  AddSliceContainerProps,\n  AddSliceContainerState\n> {\n  constructor(props: AddSliceContainerProps) {\n    super(props);\n    this.state = {\n      visType: null,\n    };\n\n    this.changeDatasource = this.changeDatasource.bind(this);\n    this.changeVisType = this.changeVisType.bind(this);\n    this.gotoSlice = this.gotoSlice.bind(this);\n    this.newLabel = this.newLabel.bind(this);\n    this.loadDatasources = this.loadDatasources.bind(this);\n  }\n\n  exploreUrl() {\n    const formData = encodeURIComponent(\n      JSON.stringify({\n        viz_type: this.state.visType,\n        datasource: this.state.datasource?.value,\n      }),\n    );\n    return `/superset/explore/?form_data=${formData}`;\n  }\n\n  gotoSlice() {\n    window.location.href = this.exploreUrl();\n  }\n\n  changeDatasource(datasource: { label: string; value: string }) {\n    this.setState({ datasource });\n  }\n\n  changeVisType(visType: string | null) {\n    this.setState({ visType });\n  }\n\n  isBtnDisabled() {\n    return !(this.state.datasource?.value && this.state.visType);\n  }\n\n  newLabel(item: Dataset) {\n    return (\n      <Tooltip\n        mouseEnterDelay={1}\n        placement=\"right\"\n        title={\n          <TooltipContent hasDescription={!!item.description}>\n            <div className=\"tooltip-header\">{item.table_name}</div>\n            {item.description && (\n              <div className=\"tooltip-description\">{item.description}</div>\n            )}\n          </TooltipContent>\n        }\n      >\n        <StyledLabel>{item.table_name}</StyledLabel>\n      </Tooltip>\n    );\n  }\n\n  loadDatasources(search: string, page: number, pageSize: number) {\n    const query = rison.encode({\n      columns: ['id', 'table_name', 'description', 'datasource_type'],\n      filters: [{ col: 'table_name', opr: 'ct', value: search }],\n      page,\n      page_size: pageSize,\n      order_column: 'table_name',\n      order_direction: 'asc',\n    });\n    return SupersetClient.get({\n      endpoint: `/api/v1/dataset/?q=${query}`,\n    }).then((response: JsonResponse) => {\n      const list: {\n        customLabel: ReactNode;\n        label: string;\n        value: string;\n      }[] = response.json.result\n        .map((item: Dataset) => ({\n          value: `${item.id}__${item.datasource_type}`,\n          customLabel: this.newLabel(item),\n          label: item.table_name,\n        }))\n        .sort((a: { label: string }, b: { label: string }) =>\n          a.label.localeCompare(b.label),\n        );\n      return {\n        data: list,\n        totalCount: response.json.count,\n      };\n    });\n  }\n\n  render() {\n    const isButtonDisabled = this.isBtnDisabled();\n    return (\n      <StyledContainer>\n        <h3>{t('Create a new chart')}</h3>\n        <Steps direction=\"vertical\" size=\"small\">\n          <Steps.Step\n            title={<FormLabel>{t('Choose a dataset')}</FormLabel>}\n            status={this.state.datasource?.value ? 'finish' : 'process'}\n            description={\n              <div className=\"dataset\">\n                <Select\n                  autoFocus\n                  ariaLabel={t('Dataset')}\n                  name=\"select-datasource\"\n                  onChange={this.changeDatasource}\n                  options={this.loadDatasources}\n                  placeholder={t('Choose a dataset')}\n                  showSearch\n                  value={this.state.datasource}\n                />\n                <span>\n                  {t(\n                    'Instructions to add a dataset are available in the Superset tutorial.',\n                  )}{' '}\n                  <a\n                    href=\"https://superset.apache.org/docs/creating-charts-dashboards/first-dashboard#adding-a-new-table\"\n                    rel=\"noopener noreferrer\"\n                    target=\"_blank\"\n                  >\n                    <i className=\"fa fa-external-link\" />\n                  </a>\n                </span>\n              </div>\n            }\n          />\n          <Steps.Step\n            title={<FormLabel>{t('Choose chart type')}</FormLabel>}\n            status={this.state.visType ? 'finish' : 'process'}\n            description={\n              <VizTypeGallery\n                className=\"viz-gallery\"\n                onChange={this.changeVisType}\n                selectedViz={this.state.visType}\n              />\n            }\n          />\n        </Steps>\n        <div className=\"footer\">\n          {isButtonDisabled && (\n            <span>\n              {t('Please select both a Dataset and a Chart type to proceed')}\n            </span>\n          )}\n          <Button\n            buttonStyle=\"primary\"\n            disabled={isButtonDisabled}\n            onClick={this.gotoSlice}\n          >\n            {t('Create new chart')}\n          </Button>\n        </div>\n      </StyledContainer>\n    );\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}