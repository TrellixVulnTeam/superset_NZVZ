{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectControl.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css, t } from '@superset-ui/core';\nimport { Select } from 'src/components';\nimport ControlHeader from 'src/explore/components/ControlHeader';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  ariaLabel: PropTypes.string,\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.string,\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  value: PropTypes.oneOfType([\n  PropTypes.string,\n  PropTypes.number,\n  PropTypes.array]),\n\n  default: PropTypes.oneOfType([\n  PropTypes.string,\n  PropTypes.number,\n  PropTypes.array]),\n\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  filterOption: PropTypes.func,\n\n  // ControlHeader props\n  label: PropTypes.string,\n  renderTrigger: PropTypes.bool,\n  validationErrors: PropTypes.array,\n  rightNode: PropTypes.node,\n  leftNode: PropTypes.node,\n  onClick: PropTypes.func,\n  hovered: PropTypes.bool,\n  tooltipOnClick: PropTypes.func,\n  warning: PropTypes.string,\n  danger: PropTypes.string };\n\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value' };\n\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: this.getOptions(props) };\n\n    this.onChange = this.onChange.bind(this);\n    this.handleFilterOptions = this.handleFilterOptions.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n    nextProps.choices !== this.props.choices ||\n    nextProps.options !== this.props.options)\n    {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(val) {\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    const { valueKey } = this.props;\n    let onChangeVal = val;\n\n    if (Array.isArray(val)) {\n      const values = val.map((v) => (v == null ? void 0 : v[valueKey]) || v);\n      onChangeVal = values;\n    }\n    if (typeof val === 'object' && val != null && val[valueKey]) {\n      onChangeVal = val[valueKey];\n    }\n    this.props.onChange(onChangeVal, []);\n  }\n\n  getOptions(props) {\n    const { choices, optionRenderer, valueKey } = props;\n    let options = [];\n    if (props.options) {\n      options = props.options.map((o) => ({\n        ...o,\n        value: o[valueKey],\n        label: o.label || o[valueKey],\n        customLabel: optionRenderer ? optionRenderer(o) : undefined }));\n\n    } else if (choices) {\n      // Accepts different formats of input\n      options = choices.map((c) => {\n        if (Array.isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return {\n            value,\n            label };\n\n        }\n        if (Object.is(c)) {\n          return {\n            ...c,\n            value: c[valueKey],\n            label: c.label || c[valueKey] };\n\n        }\n        return { value: c, label: c };\n      });\n    }\n    return options;\n  }\n\n  handleFilterOptions(text, option) {\n    const { filterOption } = this.props;\n    return filterOption({ data: option }, text);\n  }\n\n  render() {\n    const {\n      ariaLabel,\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      freeForm,\n      isLoading,\n      isMulti,\n      label,\n      multi,\n      name,\n      placeholder,\n      onFocus,\n      optionRenderer,\n      showHeader,\n      value,\n      // ControlHeader props\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger } =\n    this.props;\n\n    const headerProps = {\n      name,\n      label,\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger };\n\n\n    const getValue = () => {\n      const currentValue =\n      value || (\n      this.props.default !== undefined ? this.props.default : undefined);\n\n      // safety check - the value is intended to be undefined but null was used\n      if (\n      currentValue === null &&\n      !this.state.options.find((o) => o.value === null))\n      {\n        return undefined;\n      }\n      return currentValue;\n    };\n\n    const selectProps = {\n      allowNewOptions: freeForm,\n      autoFocus,\n      ariaLabel:\n      ariaLabel || (typeof label === 'string' ? label : t('Select ...')),\n      allowClear: clearable,\n      disabled,\n      filterOption:\n      filterOption && typeof filterOption === 'function' ?\n      this.handleFilterOptions :\n      true,\n      header: showHeader && ___EmotionJSX(ControlHeader, _extends({}, headerProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 232, columnNumber: 29 } })),\n      loading: isLoading,\n      mode: isMulti || multi ? 'multiple' : 'single',\n      name: `select-${name}`,\n      onChange: this.onChange,\n      onFocus,\n      optionRenderer,\n      options: this.state.options,\n      placeholder,\n      value: getValue() };\n\n\n    return (\n      ___EmotionJSX(\"div\", {\n        css: (theme) => css`\n          .type-label {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          .Select__multi-value__label > span,\n          .Select__option > span,\n          .Select__single-value > span {\n            display: flex;\n            align-items: center;\n          }\n        `, __self: this, __source: { fileName: _jsxFileName, lineNumber: 245, columnNumber: 7 } },\n\n      ___EmotionJSX(Select, _extends({}, selectProps, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 258, columnNumber: 9 } }))));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectControl.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectControl.jsx\");reactHotLoader.register(SelectControl, \"SelectControl\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectControl.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/explore/components/controls/SelectControl.jsx"],"names":["React","PropTypes","css","t","Select","ControlHeader","propTypes","ariaLabel","string","autoFocus","bool","choices","array","clearable","description","disabled","freeForm","isLoading","multi","isMulti","name","isRequired","onChange","func","onFocus","value","oneOfType","number","default","showHeader","optionRenderer","valueKey","options","placeholder","filterOption","label","renderTrigger","validationErrors","rightNode","node","leftNode","onClick","hovered","tooltipOnClick","warning","danger","defaultProps","SelectControl","PureComponent","constructor","props","state","getOptions","bind","handleFilterOptions","UNSAFE_componentWillReceiveProps","nextProps","setState","val","onChangeVal","Array","isArray","values","map","v","o","customLabel","undefined","c","length","Object","is","text","option","data","render","headerProps","getValue","currentValue","find","selectProps","allowNewOptions","allowClear","header","loading","mode","theme","gridUnit"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css, t } from '@superset-ui/core';\nimport { Select } from 'src/components';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  ariaLabel: PropTypes.string,\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.string,\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  default: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  filterOption: PropTypes.func,\n\n  // ControlHeader props\n  label: PropTypes.string,\n  renderTrigger: PropTypes.bool,\n  validationErrors: PropTypes.array,\n  rightNode: PropTypes.node,\n  leftNode: PropTypes.node,\n  onClick: PropTypes.func,\n  hovered: PropTypes.bool,\n  tooltipOnClick: PropTypes.func,\n  warning: PropTypes.string,\n  danger: PropTypes.string,\n};\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value',\n};\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: this.getOptions(props),\n    };\n    this.onChange = this.onChange.bind(this);\n    this.handleFilterOptions = this.handleFilterOptions.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      nextProps.choices !== this.props.choices ||\n      nextProps.options !== this.props.options\n    ) {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(val) {\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    const { valueKey } = this.props;\n    let onChangeVal = val;\n\n    if (Array.isArray(val)) {\n      const values = val.map(v => v?.[valueKey] || v);\n      onChangeVal = values;\n    }\n    if (typeof val === 'object' && val?.[valueKey]) {\n      onChangeVal = val[valueKey];\n    }\n    this.props.onChange(onChangeVal, []);\n  }\n\n  getOptions(props) {\n    const { choices, optionRenderer, valueKey } = props;\n    let options = [];\n    if (props.options) {\n      options = props.options.map(o => ({\n        ...o,\n        value: o[valueKey],\n        label: o.label || o[valueKey],\n        customLabel: optionRenderer ? optionRenderer(o) : undefined,\n      }));\n    } else if (choices) {\n      // Accepts different formats of input\n      options = choices.map(c => {\n        if (Array.isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return {\n            value,\n            label,\n          };\n        }\n        if (Object.is(c)) {\n          return {\n            ...c,\n            value: c[valueKey],\n            label: c.label || c[valueKey],\n          };\n        }\n        return { value: c, label: c };\n      });\n    }\n    return options;\n  }\n\n  handleFilterOptions(text, option) {\n    const { filterOption } = this.props;\n    return filterOption({ data: option }, text);\n  }\n\n  render() {\n    const {\n      ariaLabel,\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      freeForm,\n      isLoading,\n      isMulti,\n      label,\n      multi,\n      name,\n      placeholder,\n      onFocus,\n      optionRenderer,\n      showHeader,\n      value,\n      // ControlHeader props\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    } = this.props;\n\n    const headerProps = {\n      name,\n      label,\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    };\n\n    const getValue = () => {\n      const currentValue =\n        value ||\n        (this.props.default !== undefined ? this.props.default : undefined);\n\n      // safety check - the value is intended to be undefined but null was used\n      if (\n        currentValue === null &&\n        !this.state.options.find(o => o.value === null)\n      ) {\n        return undefined;\n      }\n      return currentValue;\n    };\n\n    const selectProps = {\n      allowNewOptions: freeForm,\n      autoFocus,\n      ariaLabel:\n        ariaLabel || (typeof label === 'string' ? label : t('Select ...')),\n      allowClear: clearable,\n      disabled,\n      filterOption:\n        filterOption && typeof filterOption === 'function'\n          ? this.handleFilterOptions\n          : true,\n      header: showHeader && <ControlHeader {...headerProps} />,\n      loading: isLoading,\n      mode: isMulti || multi ? 'multiple' : 'single',\n      name: `select-${name}`,\n      onChange: this.onChange,\n      onFocus,\n      optionRenderer,\n      options: this.state.options,\n      placeholder,\n      value: getValue(),\n    };\n\n    return (\n      <div\n        css={theme => css`\n          .type-label {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          .Select__multi-value__label > span,\n          .Select__option > span,\n          .Select__single-value > span {\n            display: flex;\n            align-items: center;\n          }\n        `}\n      >\n        <Select {...selectProps} />\n      </div>\n    );\n  }\n}\n\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;\n"]},"metadata":{},"sourceType":"module"}