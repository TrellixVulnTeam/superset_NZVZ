{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";var _jsxFileName = \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport Alert from 'src/components/Alert';\nimport { styled, logging, t } from '@superset-ui/core';\n\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport { PLACEHOLDER_DATASOURCE } from 'src/dashboard/constants';\nimport Button from 'src/components/Button';\nimport Loading from 'src/components/Loading';\nimport ErrorBoundary from '../components/ErrorBoundary';\nimport ChartRenderer from './ChartRenderer';\nimport { ChartErrorMessage } from './ChartErrorMessage';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from '../logger/LogUtils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  // current chart is included by dashboard\n  dashboardId: PropTypes.number,\n  // original selected values for FilterBox viz\n  // so that FilterBox can pre-populate selected values\n  // only affect UI control\n  initialValues: PropTypes.object,\n  // formData contains chart's own filter parameter\n  // and merged with extra filter that current dashboard applying\n  formData: PropTypes.object.isRequired,\n  labelColors: PropTypes.object,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  setControlValue: PropTypes.func,\n  timeout: PropTypes.number,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  isFiltersInitialized: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartStackTrace: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  errorMessage: PropTypes.node,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onQuery: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object };\n\n\nconst BLANK = {};\nconst NONEXISTENT_DATASET = t(\n'The dataset associated with this chart no longer exists');\n\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n  dashboardId: null,\n  chartStackTrace: null };\n\n\nconst Styles = styled.div`\n  min-height: ${(p) => p.height}px;\n  position: relative;\n\n  .chart-tooltip {\n    opacity: 0.75;\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  }\n`;\n\nconst RefreshOverlayWrapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nclass Chart extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleRenderContainerFailure = this.handleRenderContainerFailure.bind(\n    this);\n\n  }\n\n  componentDidMount() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  runQuery() {\n    if (this.props.chartId > 0 && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)) {\n      // Load saved chart with a GET request\n      this.props.actions.getSavedChart(\n      this.props.formData,\n      false,\n      this.props.timeout,\n      this.props.chartId,\n      this.props.dashboardId,\n      this.props.ownState);\n\n    } else {\n      // Create chart with POST request\n      this.props.actions.postChartFormData(\n      this.props.formData,\n      false,\n      this.props.timeout,\n      this.props.chartId,\n      this.props.dashboardId,\n      this.props.ownState);\n\n    }\n  }\n\n  handleRenderContainerFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n    error.toString(),\n    chartId,\n    info ? info.componentStack : null);\n\n\n    actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n      slice_id: chartId,\n      has_err: true,\n      error_details: error.toString(),\n      start_offset: this.renderStartTime,\n      ts: new Date().getTime(),\n      duration: Logger.getTimestamp() - this.renderStartTime });\n\n  }\n\n  renderErrorMessage(queryResponse) {var _queryResponse$errors;\n    const {\n      chartId,\n      chartAlert,\n      chartStackTrace,\n      datasource,\n      dashboardId,\n      height } =\n    this.props;\n\n    const error = queryResponse == null ? void 0 : (_queryResponse$errors = queryResponse.errors) == null ? void 0 : _queryResponse$errors[0];\n    const message = chartAlert || (queryResponse == null ? void 0 : queryResponse.message);\n\n    // if datasource is still loading, don't render JS errors\n    if (\n    chartAlert !== undefined &&\n    chartAlert !== NONEXISTENT_DATASET &&\n    datasource === PLACEHOLDER_DATASOURCE)\n    {\n      return (\n        ___EmotionJSX(Styles, {\n          \"data-ui-anchor\": \"chart\",\n          className: \"chart-container\",\n          \"data-test\": \"chart-container\",\n          height: height, __self: this, __source: { fileName: _jsxFileName, lineNumber: 191, columnNumber: 9 } },\n\n        ___EmotionJSX(Loading, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 197, columnNumber: 11 } })));\n\n\n    }\n\n    return (\n      ___EmotionJSX(ChartErrorMessage, {\n        chartId: chartId,\n        error: error,\n        subtitle: message,\n        copyText: message,\n        link: queryResponse ? queryResponse.link : null,\n        source: dashboardId ? 'dashboard' : 'explore',\n        stackTrace: chartStackTrace, __self: this, __source: { fileName: _jsxFileName, lineNumber: 203, columnNumber: 7 } }));\n\n\n  }\n\n  render() {\n    const {\n      height,\n      chartAlert,\n      chartStatus,\n      errorMessage,\n      onQuery,\n      refreshOverlayVisible,\n      queriesResponse = [] } =\n    this.props;\n\n    const isLoading = chartStatus === 'loading';\n    const isFaded = refreshOverlayVisible && !errorMessage;\n    this.renderContainerStartTime = Logger.getTimestamp();\n    if (chartStatus === 'failed') {\n      return queriesResponse.map((item) => this.renderErrorMessage(item));\n    }\n\n    if (errorMessage) {\n      return (\n        ___EmotionJSX(Alert, {\n          \"data-test\": \"alert-warning\",\n          message: errorMessage,\n          type: \"warning\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 235, columnNumber: 9 } }));\n\n\n    }\n\n    return (\n      ___EmotionJSX(ErrorBoundary, {\n        onError: this.handleRenderContainerFailure,\n        showMessage: false, __self: this, __source: { fileName: _jsxFileName, lineNumber: 244, columnNumber: 7 } },\n\n      ___EmotionJSX(Styles, {\n        \"data-ui-anchor\": \"chart\",\n        className: \"chart-container\",\n        \"data-test\": \"chart-container\",\n        height: height, __self: this, __source: { fileName: _jsxFileName, lineNumber: 248, columnNumber: 9 } },\n\n      ___EmotionJSX(\"div\", {\n        className: `slice_container ${isFaded ? ' faded' : ''}`,\n        \"data-test\": \"slice-container\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 254, columnNumber: 11 } },\n\n      ___EmotionJSX(ChartRenderer, _extends({}, this.props, { \"data-test\": this.props.vizType, __self: this, __source: { fileName: _jsxFileName, lineNumber: 258, columnNumber: 13 } }))),\n\n\n      !isLoading && !chartAlert && isFaded &&\n      ___EmotionJSX(RefreshOverlayWrapper, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 262, columnNumber: 13 } },\n      ___EmotionJSX(Button, { onClick: onQuery, buttonStyle: \"primary\", __self: this, __source: { fileName: _jsxFileName, lineNumber: 263, columnNumber: 15 } },\n      t('Run query'))),\n\n\n\n\n      isLoading && ___EmotionJSX(Loading, { __self: this, __source: { fileName: _jsxFileName, lineNumber: 269, columnNumber: 25 } }))));\n\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nChart.propTypes = propTypes;\nChart.defaultProps = defaultProps;const _default =\n\nChart;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(BLANK, \"BLANK\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(NONEXISTENT_DATASET, \"NONEXISTENT_DATASET\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(Styles, \"Styles\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(RefreshOverlayWrapper, \"RefreshOverlayWrapper\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(Chart, \"Chart\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");reactHotLoader.register(_default, \"default\", \"/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"sources":["/home/ubuntu/my_plugin/superset/superset-frontend/src/chart/Chart.jsx"],"names":["PropTypes","React","Alert","styled","logging","t","isFeatureEnabled","FeatureFlag","PLACEHOLDER_DATASOURCE","Button","Loading","ErrorBoundary","ChartRenderer","ChartErrorMessage","Logger","LOG_ACTIONS_RENDER_CHART","propTypes","annotationData","object","actions","chartId","number","isRequired","datasource","dashboardId","initialValues","formData","labelColors","width","height","setControlValue","func","timeout","vizType","string","triggerRender","bool","isFiltersInitialized","chartAlert","chartStatus","chartStackTrace","queriesResponse","arrayOf","triggerQuery","refreshOverlayVisible","errorMessage","node","addFilter","onQuery","onFilterMenuOpen","onFilterMenuClose","ownState","BLANK","NONEXISTENT_DATASET","defaultProps","Styles","div","p","theme","typography","sizes","s","RefreshOverlayWrapper","Chart","PureComponent","constructor","props","handleRenderContainerFailure","bind","componentDidMount","runQuery","componentDidUpdate","CLIENT_CACHE","getSavedChart","postChartFormData","error","info","warn","chartRenderingFailed","toString","componentStack","logEvent","slice_id","has_err","error_details","start_offset","renderStartTime","ts","Date","getTime","duration","getTimestamp","renderErrorMessage","queryResponse","errors","message","undefined","link","render","isLoading","isFaded","renderContainerStartTime","map","item"],"mappings":"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","sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport Alert from 'src/components/Alert';\nimport { styled, logging, t } from '@superset-ui/core';\n\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport { PLACEHOLDER_DATASOURCE } from 'src/dashboard/constants';\nimport Button from 'src/components/Button';\nimport Loading from 'src/components/Loading';\nimport ErrorBoundary from '../components/ErrorBoundary';\nimport ChartRenderer from './ChartRenderer';\nimport { ChartErrorMessage } from './ChartErrorMessage';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from '../logger/LogUtils';\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  // current chart is included by dashboard\n  dashboardId: PropTypes.number,\n  // original selected values for FilterBox viz\n  // so that FilterBox can pre-populate selected values\n  // only affect UI control\n  initialValues: PropTypes.object,\n  // formData contains chart's own filter parameter\n  // and merged with extra filter that current dashboard applying\n  formData: PropTypes.object.isRequired,\n  labelColors: PropTypes.object,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  setControlValue: PropTypes.func,\n  timeout: PropTypes.number,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  isFiltersInitialized: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartStackTrace: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  refreshOverlayVisible: PropTypes.bool,\n  errorMessage: PropTypes.node,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onQuery: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object,\n};\n\nconst BLANK = {};\nconst NONEXISTENT_DATASET = t(\n  'The dataset associated with this chart no longer exists',\n);\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n  dashboardId: null,\n  chartStackTrace: null,\n};\n\nconst Styles = styled.div`\n  min-height: ${p => p.height}px;\n  position: relative;\n\n  .chart-tooltip {\n    opacity: 0.75;\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  }\n`;\n\nconst RefreshOverlayWrapper = styled.div`\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`;\n\nclass Chart extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleRenderContainerFailure = this.handleRenderContainerFailure.bind(\n      this,\n    );\n  }\n\n  componentDidMount() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  componentDidUpdate() {\n    if (this.props.triggerQuery) {\n      this.runQuery();\n    }\n  }\n\n  runQuery() {\n    if (this.props.chartId > 0 && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)) {\n      // Load saved chart with a GET request\n      this.props.actions.getSavedChart(\n        this.props.formData,\n        false,\n        this.props.timeout,\n        this.props.chartId,\n        this.props.dashboardId,\n        this.props.ownState,\n      );\n    } else {\n      // Create chart with POST request\n      this.props.actions.postChartFormData(\n        this.props.formData,\n        false,\n        this.props.timeout,\n        this.props.chartId,\n        this.props.dashboardId,\n        this.props.ownState,\n      );\n    }\n  }\n\n  handleRenderContainerFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n      error.toString(),\n      chartId,\n      info ? info.componentStack : null,\n    );\n\n    actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n      slice_id: chartId,\n      has_err: true,\n      error_details: error.toString(),\n      start_offset: this.renderStartTime,\n      ts: new Date().getTime(),\n      duration: Logger.getTimestamp() - this.renderStartTime,\n    });\n  }\n\n  renderErrorMessage(queryResponse) {\n    const {\n      chartId,\n      chartAlert,\n      chartStackTrace,\n      datasource,\n      dashboardId,\n      height,\n    } = this.props;\n\n    const error = queryResponse?.errors?.[0];\n    const message = chartAlert || queryResponse?.message;\n\n    // if datasource is still loading, don't render JS errors\n    if (\n      chartAlert !== undefined &&\n      chartAlert !== NONEXISTENT_DATASET &&\n      datasource === PLACEHOLDER_DATASOURCE\n    ) {\n      return (\n        <Styles\n          data-ui-anchor=\"chart\"\n          className=\"chart-container\"\n          data-test=\"chart-container\"\n          height={height}\n        >\n          <Loading />\n        </Styles>\n      );\n    }\n\n    return (\n      <ChartErrorMessage\n        chartId={chartId}\n        error={error}\n        subtitle={message}\n        copyText={message}\n        link={queryResponse ? queryResponse.link : null}\n        source={dashboardId ? 'dashboard' : 'explore'}\n        stackTrace={chartStackTrace}\n      />\n    );\n  }\n\n  render() {\n    const {\n      height,\n      chartAlert,\n      chartStatus,\n      errorMessage,\n      onQuery,\n      refreshOverlayVisible,\n      queriesResponse = [],\n    } = this.props;\n\n    const isLoading = chartStatus === 'loading';\n    const isFaded = refreshOverlayVisible && !errorMessage;\n    this.renderContainerStartTime = Logger.getTimestamp();\n    if (chartStatus === 'failed') {\n      return queriesResponse.map(item => this.renderErrorMessage(item));\n    }\n\n    if (errorMessage) {\n      return (\n        <Alert\n          data-test=\"alert-warning\"\n          message={errorMessage}\n          type=\"warning\"\n        />\n      );\n    }\n\n    return (\n      <ErrorBoundary\n        onError={this.handleRenderContainerFailure}\n        showMessage={false}\n      >\n        <Styles\n          data-ui-anchor=\"chart\"\n          className=\"chart-container\"\n          data-test=\"chart-container\"\n          height={height}\n        >\n          <div\n            className={`slice_container ${isFaded ? ' faded' : ''}`}\n            data-test=\"slice-container\"\n          >\n            <ChartRenderer {...this.props} data-test={this.props.vizType} />\n          </div>\n\n          {!isLoading && !chartAlert && isFaded && (\n            <RefreshOverlayWrapper>\n              <Button onClick={onQuery} buttonStyle=\"primary\">\n                {t('Run query')}\n              </Button>\n            </RefreshOverlayWrapper>\n          )}\n\n          {isLoading && <Loading />}\n        </Styles>\n      </ErrorBoundary>\n    );\n  }\n}\n\nChart.propTypes = propTypes;\nChart.defaultProps = defaultProps;\n\nexport default Chart;\n"]},"metadata":{},"sourceType":"module"}